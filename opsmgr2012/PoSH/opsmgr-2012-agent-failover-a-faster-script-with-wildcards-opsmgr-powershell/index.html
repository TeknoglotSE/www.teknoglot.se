<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>OpsMgr 2012 Agent Failover – A Faster Script with Wildcards [#opsmgr, #powershell] | stegenfeldt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="OpsMgr,PoSH,Script,Fail-over" />
    
    <meta name="description" content="Now we’re gonna make things even faster! In the previous post on the subject of Agent Fail-over in Operations Manager 2012 we created a script that will go through a selection of agents and make sure">
<meta property="og:type" content="article">
<meta property="og:title" content="OpsMgr 2012 Agent Failover – A Faster Script with Wildcards [#opsmgr, #powershell]">
<meta property="og:url" content="http://stegenfeldt.github.io/opsmgr2012/PoSH/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/index.html">
<meta property="og:site_name" content="stegenfeldt">
<meta property="og:description" content="Now we’re gonna make things even faster! In the previous post on the subject of Agent Fail-over in Operations Manager 2012 we created a script that will go through a selection of agents and make sure">
<meta property="og:updated_time" content="2016-05-19T09:11:09.330Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpsMgr 2012 Agent Failover – A Faster Script with Wildcards [#opsmgr, #powershell]">
<meta name="twitter:description" content="Now we’re gonna make things even faster! In the previous post on the subject of Agent Fail-over in Operations Manager 2012 we created a script that will go through a selection of agents and make sure">
    

    

    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/titillium-web/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">Static. Nothing but static.</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/hyperv/">Hyper-V</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/hyperv/rhes/">RedHat ES</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Linux/">Linux</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/">Microsoft</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/win2008/">Windows 2008</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/mikrotik/">Mikrotik</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2007/">OpsMgr 2007</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2007/opsmgr2012/">OpsMgr 2012</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2007/PoSH/">PoSH</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2007/sles/">SLES</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2007/sql2005/">SQL 2005</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2012/">OpsMgr 2012</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/opsmgr2012/PoSH/">PoSH</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/PoSH/">PoSH</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/sql2008/">SQL 2008</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/tb/">Technobabble</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ubuntu/">Ubuntu</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/vbs/">VBS</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/winvista/">Windows Vista</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/winxp/">Windows XP</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/topics/opsmgr2012/">OpsMgr 2012</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/topics/opsmgr2012/PoSH/">PoSH</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        OpsMgr 2012 Agent Failover – A Faster Script with Wildcards [#opsmgr, #powershell]
        </h1>
    

            </header>
        
        <div class="article-subtitle">
            <a href="/opsmgr2012/PoSH/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/" class="article-date">
    <time datetime="2012-06-28T12:28:36.000Z" itemprop="datePublished">2012-06-28</time>
</a>
            
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Fail-over/">Fail-over</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/OpsMgr/">OpsMgr</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/PoSH/">PoSH</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Script/">Script</a></li></ul>

        </div>
        <div class="article-entry" itemprop="articleBody">
            <p>Now we’re gonna make things even faster! In the <a href="http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" title="OpsMgr 2012 Agent Failover – Simple Script with Wildcards [#opsmgr, #powershell]" target="_blank" rel="external">previous post</a> on the subject of <a href="http://www.teknoglot.se/series/om2012-failover-mgmt/" target="_blank" rel="external">Agent Fail-over in Operations Manager 2012</a> we created a script that will go through a selection of agents and make sure that they all have up-to-date fail-over settings. We are doing the same thing in this one, but making it go faster. In my lab, it’s about five times faster in fact and I only have about 20 agents to play with. Not really a big deal, but scale it up a bit and add a few thousand agents and the pay-off will be very significant.</p>
<p>As usual, the script will work as is, but it really is more to show the concept. You would have to add filtering to make sure you don’t mix agents behind gateway servers and agents behind management servers. Giving an agent behind a gateway a management servers as it’s fail-over server will likely not help you in any way.</p>
<p>We will pretty quickly go “advanced” this time, so buckle up. ;)</p>
<a id="more"></a>
<p>Being a slight modification of the script in the last post I am not going to go through those details. Use that post if you need references to the Inputs, the OpsMgr 2012 Modules, Management Group connection and gathering your agents and management servers.</p>
<h3 id="Why-Is-It-Faster"><a href="#Why-Is-It-Faster" class="headerlink" title="Why Is It Faster?"></a>Why Is It Faster?</h3><p>We are doing the same thing, on the same agents and with the same servers. And we already did some optimization by loading them all into memory and working from there. How do you make it faster? Basically, I’m cutting the over-head of the cmdlets and how they work. You may have noticed that in the “Do Stuff” section, we are actually calling the <em>Set-SCOMParentManagementServer</em> cmdlet twice! Once for the primary Management Server and once for the fail-over Management Servers. In effect, we connect, fire a command, wait for result, and disconnect two times for each agent. And pretty much only because the cmdlet does not offer support to set primary and fail-over management servers at the same time. Any attempt to do so will return an ambiguous parameter error.</p>
<p>I don’t like that. A brief look at the agent object class, <a href="http://msdn.microsoft.com/en-us/library/microsoft.enterprisemanagement.administration.agentmanagedcomputer.aspx" target="_blank" rel="external">Microsoft.EnterpriseManagement.Administration.AgentManagedComputer</a>, revealed a method called <a href="http://msdn.microsoft.com/en-us/library/microsoft.enterprisemanagement.administration.agentmanagedcomputer.setmanagementservers" title="AgentManagedComputer.SetManagementServers Method" target="_blank" rel="external">SetManagementServers</a>. This method takes, or actually “requires”, two parameters. One for primary and one for fail-over management servers. Yay!</p>
<p>Using this method saves us a bunch of over-head and a couple of round-trips to the SDK-service.</p>
<h3 id="The-Challenge"><a href="#The-Challenge" class="headerlink" title="The Challenge"></a>The Challenge</h3><p>Unfortunately, you cannot simply toss an array of management servers at the SetManagementServers method. With a bit of knowledge or keen eyes you will spot the problem right away. I didn’t and was pulling my hair for a while until I realized what caused the errors. Looking closer at how the method is defined we see this:</p>
<p>[csharp]public void SetManagementServers (<br> ManagementServer managementServer,<br> IList failoverManagementServers<br> )[/csharp]</p>
<p>You see that <em>IList&lt;ManagementServer&gt;</em> part?<br>That’s the problem. When you run <em>Get-SCOMManagementServer</em> and save the result to a powershell variable, you will get a powershell “Enumerable”. In C#, that would be a class that implements the <em>IEnumerable</em> interface. Sad part is, it does not also implement <em>IList</em>. If you are thinking “IList… IEnumerable… Interface… Whaaaaa…???” right now, don’t worry. You don’t have to understand this to read the script later on, just think of it as different types of data.</p>
<p>To get around this, we create a new object based on the dotNET List type and populate it with the management servers in our $scomFailOverMS array.</p>
<p>[powershell]$scomMSList = New-Object ‘Collections.Generic.List[Microsoft.EnterpriseManagement.Administration.ManagementServer]’<br>foreach ($scomMS in $scomFailOverMS) {</p>
<h1 id="Loop-through-the-array-and-add-your-failover-MSs-to-the-list"><a href="#Loop-through-the-array-and-add-your-failover-MSs-to-the-list" class="headerlink" title="Loop through the array and add your failover MSs to the list"></a>Loop through the array and add your failover MSs to the list</h1><p> $scomMSList.Add($scomMS)<br>}[/powershell]</p>
<blockquote>
<p>Note:We have to do that foreach loop since our $scomMSList object do not implement IEnumerable<br>Still with me?</p>
</blockquote>
<h3 id="Configuring-the-Agent"><a href="#Configuring-the-Agent" class="headerlink" title="Configuring the Agent"></a>Configuring the Agent</h3><p>As the method exist on that <em>AgentManagedComputer</em> class we will call it on our $scomAgent object, like this:</p>
<p>[powershell]$scomAgent.SetManagementServers($scomPrimaryMS,$scomMSList)[/powershell]</p>
<p>And we’re done!</p>
<p>I had some doubt that this would be an improvement at first since we have to create our own objects and run an extra foreach-loop, but as we only work on objects in memory and only speak to the SDK service once per agent, we cut a lot of over-head and delays from our execution. On 20-ish agents in a lab, I’ve measured the execution time drop to barely a fifth.</p>
<h3 id="The-Copy-Paste-Part"><a href="#The-Copy-Paste-Part" class="headerlink" title="The Copy/Paste Part"></a>The Copy/Paste Part</h3><p>And here’s the entire script with a few added comments for clarity. Read, adapt and try it. In a lab, preferably.</p>
<p>[powershell]# Input SCOM Management Server to connect to in this session<br>[string]$inputScomMS = &quot;scomms02.domain.local&quot;</p>
<h1 id="Input-an-existing-agent-you-want-to-modify"><a href="#Input-an-existing-agent-you-want-to-modify" class="headerlink" title="Input an existing agent you want to modify"></a>Input an existing agent you want to modify</h1><p>[string]$inputTargetAgent = &quot;*.domain.local&quot;</p>
<h3 id="Connect-to-SCOM-2012-Management-Group"><a href="#Connect-to-SCOM-2012-Management-Group" class="headerlink" title="Connect to SCOM 2012 Management Group"></a>Connect to SCOM 2012 Management Group</h3><p>If (Get-Module -Name &quot;OperationsManager&quot;) {<br>    try {<br>        Import-Module -Name &quot;OperationsManager&quot;<br>    } catch {<br>        echo &quot;Could not load Operations Manager module&quot;<br>        exit<br>    }<br>}<br>New-SCOMManagementGroupConnection -ComputerName $inputScomMS</p>
<h3 id="END"><a href="#END" class="headerlink" title="END"></a>END</h3><p>$scomAgents = Get-SCOMAgent -DNSHostName $inputTargetAgent | Where {$_.ManuallyInstalled -ne $true}</p>
<h1 id="Get-all-of-the-management-servers"><a href="#Get-all-of-the-management-servers" class="headerlink" title="Get all of the management servers"></a>Get all of the management servers</h1><h1 id="It-is-ofcourse-possible-to-search-by-hostname-and-wildcards-using-selected"><a href="#It-is-ofcourse-possible-to-search-by-hostname-and-wildcards-using-selected" class="headerlink" title="It is ofcourse possible to search by hostname and wildcards using selected"></a>It is ofcourse possible to search by hostname and wildcards using selected</h1><h1 id="parameters-to-the-cmdlet"><a href="#parameters-to-the-cmdlet" class="headerlink" title="parameters to the cmdlet."></a>parameters to the cmdlet.</h1><p>$scomManagementServers = Get-SCOMManagementServer</p>
<h1 id="Switch-to-the-following-line-to-only-get-Gateway-Servers"><a href="#Switch-to-the-following-line-to-only-get-Gateway-Servers" class="headerlink" title="Switch to the following line to only get Gateway Servers"></a>Switch to the following line to only get Gateway Servers</h1><p>#$scomManagementServers = Get-SCOMGatewayManagementServer<br>foreach ($scomAgent in $scomAgents) {</p>
<pre><code># Get the primary management server for the agent
$scomPrimaryMS = $scomManagementServers | where {$_.Name -eq $scomAgent.PrimaryManagementServerName}
# Remove the primary MS from &amp;quot;all MS&amp;quot; array to use it for FailOver servers
$scomFailOverMS = $scomManagementServers | where {$_.Name -ne $scomPrimaryMS.Name}

# Create a new IList derived object for the failover MSs
# You have to do this because the SetManagementServers() method requires an
# IList and the MS-array is an IEnumerable type. So we basically create
# a new IList object och the ManagementServer type.
$scomMSList = New-Object &apos;Collections.Generic.List[Microsoft.EnterpriseManagement.Administration.ManagementServer]&apos;
foreach ($scomMS in $scomFailOverMS) {
    # Loop through the array and add your failover MSs to the list
    $scomMSList.Add($scomMS)
}
$scomAgent.SetManagementServers($scomPrimaryMS,$scomMSList)
</code></pre><p>}<br>[/powershell]</p>
<p>GLHF!</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://stegenfeldt.github.io/opsmgr2012/PoSH/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/" data-id="cioe580tt0028rggj2bswd0sv" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/teknoglot" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="https://plus.google.com/+teknoglot" target="_blank">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="/" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/opsmgr2007/opsmgr2012/quick-demo-add-windows-performance-collection-rule-opsmgr-mpauthoring/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Quick Demo - Add Windows Performance Collection Rule [#opsmgr, #mpauthoring]
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/opsmgr2012/PoSH/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell]</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/opsmgr2012/">OpsMgr 2012</a></p>
                            <p class="item-title"><a href="/opsmgr2012/opsmgr-2012-r2-ur4-field-notes/" class="title">OpsMgr 2012 R2 UR4 - Field Notes [#opsmgr]</a></p>
                            <p class="item-date"><time datetime="2014-10-30T10:41:47.000Z" itemprop="datePublished">2014-10-30</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/opsmgr2012/">OpsMgr 2012</a></p>
                            <p class="item-title"><a href="/opsmgr2012/squaredup-installation/" class="title">SquaredUp Installation - Manual? Pfffft! [#opsmgr #squaredup]</a></p>
                            <p class="item-date"><time datetime="2014-09-09T14:38:36.000Z" itemprop="datePublished">2014-09-09</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/opsmgr2012/">OpsMgr 2012</a></p>
                            <p class="item-title"><a href="/opsmgr2012/opsmgr2012r2ur3-field-notes/" class="title">OpsMgr 2012 R2 UR3 - Field Notes [#opsmgr]</a></p>
                            <p class="item-date"><time datetime="2014-09-02T09:30:18.000Z" itemprop="datePublished">2014-09-02</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/mikrotik/">Mikrotik</a></p>
                            <p class="item-title"><a href="/mikrotik/cloudflare-dynamic-dns-mikrotik/" class="title">Cloudflare as Dynamic DNS [#cloudflare #mikrotik #script]</a></p>
                            <p class="item-date"><time datetime="2014-08-25T11:37:36.000Z" itemprop="datePublished">2014-08-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/opsmgr2007/">OpsMgr 2007</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/opsmgr2007/opsmgr2012/">OpsMgr 2012</a></p>
                            <p class="item-title"><a href="/opsmgr2007/opsmgr2012/quick-demo-add-windows-performance-collection-rule-opsmgr-mpauthoring/" class="title">Quick Demo - Add Windows Performance Collection Rule [#opsmgr, #mpauthoring]</a></p>
                            <p class="item-date"><time datetime="2013-02-21T08:25:39.000Z" itemprop="datePublished">2013-02-21</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/topics/hyperv/">Hyper-V</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/hyperv/rhes/">RedHat ES</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/Linux/">Linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/">Microsoft</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/win2008/">Windows 2008</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/win2008/winvista/">Windows Vista</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/win2008/winvista/winxp/">Windows XP</a><span class="category-list-count">1</span></li></ul></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/mikrotik/">Mikrotik</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2007/">OpsMgr 2007</a><span class="category-list-count">26</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2007/opsmgr2012/">OpsMgr 2012</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2007/PoSH/">PoSH</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2007/sles/">SLES</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2007/sql2005/">SQL 2005</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2007/sql2005/sql2008/">SQL 2008</a><span class="category-list-count">2</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2012/">OpsMgr 2012</a><span class="category-list-count">7</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/opsmgr2012/PoSH/">PoSH</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/PoSH/">PoSH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/sql2008/">SQL 2008</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/tb/">Technobabble</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ubuntu/">Ubuntu</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/vbs/">VBS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/winvista/">Windows Vista</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/winxp/">Windows XP</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tag/ACS/">ACS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Checklist/">Checklist</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Conference/">Conference</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/DNS/">DNS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Drivers/">Drivers</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Errors/">Errors</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Exchange/">Exchange</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Fail-over/">Fail-over</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Field-Notes/">Field Notes</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Fixed/">Fixed</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/GSM/">GSM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Highly-Available/">Highly-Available</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/How-To/">How-To</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Hyper-V/">Hyper-V</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/IIS7/">IIS7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Invoke-RestMethod/">Invoke-RestMethod</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/KB/">KB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Linux/">Linux</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/MP-Development/">MP Development</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/MSMQ/">MSMQ</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Management-Pack/">Management Pack</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Mikrotik/">Mikrotik</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/NLB/">NLB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/NVidia/">NVidia</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/OpenVPN/">OpenVPN</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/OpsMgr/">OpsMgr</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/PoSH/">PoSH</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Quick-Reference/">Quick Reference</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Quick-fix/">Quick-fix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Quick-hack/">Quick-hack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/RHES5/">RHES5</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Rant/">Rant</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/RedHat/">RedHat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Reporting-Services/">Reporting Services</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/RouterOS/">RouterOS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SMS/">SMS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SQL-Express-2005/">SQL Express 2005</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SQL-Express-2008/">SQL Express 2008</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SQL-Server/">SQL Server</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SQL-Server-2005/">SQL Server 2005</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SQL-Server-2008/">SQL Server 2008</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SUSE-11/">SUSE 11</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Script/">Script</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Scripts/">Scripts</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Sillyness/">Sillyness</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/SquaredUp/">SquaredUp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Teach-a-Man-to-Fish/">Teach a Man to Fish</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/TechNet/">TechNet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Teknoglot/">Teknoglot</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/TroubleShooting/">TroubleShooting</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Tutorial/">Tutorial</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Unix/">Unix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Update-Rollup/">Update Rollup</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Video/">Video</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Virtual-Appliance/">Virtual Appliance</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/WMI/">WMI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Windows/">Windows</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/Windows-Installer/">Windows Installer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/X-Plat/">X-Plat</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tag/x64/">x64</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.teknoglot.se/">teknoglot</a>
                    </li>
                
                    <li>
                        <a href="http://www.atea.se/">Atea</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2016 Samuel Tegenfeldt</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'teknoglot';
    
    
    var disqus_url = 'http://stegenfeldt.github.io/opsmgr2012/PoSH/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    

    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
