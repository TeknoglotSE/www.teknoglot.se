<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell] | teknoglot:</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="OpsMgr,PoSH,Fail-over" />
    
    <meta name="description" content="In the last post, OpsMgr 2012 Agent &amp;amp; Gateway Failover – The Basics, we looked at the basics of the Agent and Gateway fail-over configuration cmdlets and how to use them in a direct and interactiv">
<meta property="og:type" content="article">
<meta property="og:title" content="OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell]">
<meta property="og:url" content="https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/index.html">
<meta property="og:site_name" content="teknoglot:">
<meta property="og:description" content="In the last post, OpsMgr 2012 Agent &amp;amp; Gateway Failover – The Basics, we looked at the basics of the Agent and Gateway fail-over configuration cmdlets and how to use them in a direct and interactiv">
<meta property="og:updated_time" content="2017-09-28T15:57:00.393Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell]">
<meta name="twitter:description" content="In the last post, OpsMgr 2012 Agent &amp;amp; Gateway Failover – The Basics, we looked at the basics of the Agent and Gateway fail-over configuration cmdlets and how to use them in a direct and interactiv">
    

    

    
        <link rel="icon" href="/favicon.png" />
    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/titillium-web/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-382656-8', 'auto');
ga('send', 'pageview');

</script>
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/code/">Code</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/code/posh/">PoSH</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/code/vbs/">VBS</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Events/">Events</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Linux/">Linux</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Linux/rhes/">RedHat ES</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Linux/sles/">SLES</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/Linux/ubuntu/">Ubuntu</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/">Microsoft</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr2007/">OpsMgr 2007</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/sql/">SQL Server</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/windows/">Windows</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/ms/winvista/">Windows Vista</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/mikrotik/">Mikrotik</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/topics/tb/">Technobabble</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/About/">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/topics/ms/">Microsoft</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell]
        </h1>
    

            </header>
        
        <div class="article-subtitle">
            <a href="/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" class="article-date">
    <time datetime="2012-06-21T08:58:13.000Z" itemprop="datePublished">2012-06-21</time>
</a>
            
    <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/Fail-over/">Fail-over</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/OpsMgr/">OpsMgr</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tag/PoSH/">PoSH</a></li></ul>

        </div>
        <div class="article-entry" itemprop="articleBody">
            <ol class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }"><li class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-item function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-level-3"><a class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-link" href="#Inputs"><span class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-text">Inputs</span></a></li><li class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-item function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-level-3"><a class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-link" href="#Connect-to-Your-Management-Group"><span class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-text">Connect to Your Management Group</span></a></li><li class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-item function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-level-3"><a class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-link" href="#Rally-Your-Agents-and-Management-Servers"><span class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-text">Rally Your Agents (and Management Servers)</span></a></li><li class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-item function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-level-3"><a class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-link" href="#Do-Stuff"><span class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-text">Do Stuff</span></a></li><li class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-item function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-level-3"><a class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-link" href="#The-Copy-Paste-Part"><span class="function wrapper() {
        var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
        return fn.apply(isBind ? thisArg : this, arguments);
      }-text">The Copy/Paste Part</span></a></li></ol>
            <p>In the last post, <a href="http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-gateway-failover-the-basics/" title="OpsMgr 2012 Agent &amp; Gateway Failover – The Basics [#opsmgr, #powershell]">OpsMgr 2012 Agent &amp; Gateway Failover – The Basics</a>, we looked at the basics of the Agent and Gateway fail-over configuration cmdlets and how to use them in a direct and interactive setting. This is absolutely useful when you got this specific agent that you need to configure with a specific fail-over management server.</p>
<p>To spice it up a little, we are going to add a little intelligence to it and enable wild-card selections while at it. The scenario we are building this script for is that now and then you want to make sure that certain agents have fail-over management servers configured. You also want to make sure that all management servers that are not the primary management server of any selected agent will be in that list of fail-over servers. This would include any new management servers as well as exclude any removed ones. In short, make sure your agent fail-over settings are up-to-date with the current environment.</p>
<a id="more"></a>
<h3 id="Inputs"><a href="#Inputs" class="headerlink" title="Inputs"></a>Inputs</h3><p>To use this script you need to know which management server you should connect your powershell session to and which agent, or agents, you want to check and configure.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line"><span class="comment"># Input SCOM Management Server to connect to in this session</span></div><div class="line">[string]<span class="variable">$inputScomMS</span> = <span class="string">"scomms01.domain.local"</span></div><div class="line"><span class="comment"># Input an existing agent you want to modify</span></div><div class="line">[string]<span class="variable">$inputTargetAgent</span> = <span class="string">"*.domain.local"</span></div></pre></td></tr></table></figure>
<blockquote>
<p>Note: If you are using load-balanced SDK-services, or “Data Access Services”, pointing <code>$inputScomMS</code> to that virtual host-name will work perfectly fine.<br>This example uses a wild-card for the agent selection and I guess it’s the most likely scenario for this script, but a single host-name obviously works fine as well. Supported wildcard selections are <a href="http://technet.microsoft.com/en-us/library/ee692793.aspx" target="_blank" rel="external">documented at TechNet</a>. An array of computer-names or a comma-separated list, however, will not work. You could easily add that functionality but it’s out of scope for this example.</p>
</blockquote>
<h3 id="Connect-to-Your-Management-Group"><a href="#Connect-to-Your-Management-Group" class="headerlink" title="Connect to Your Management Group"></a>Connect to Your Management Group</h3><p>To run any script against an Operations Manager 2012 Management Group we need a connection to one. To connect to a management group we have to load the OperationsManager module. Lets check for a loaded module, load it if necessary and connect to the Management Server from the <code>$inputScomMS</code> setting. If loading the module fails–maybe it is not installed–we will exit the script.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line"><span class="comment"># Check if OperationsManager module is loaded</span></div><div class="line"><span class="keyword">If</span> (<span class="built_in">Get-Module</span> -Name <span class="string">"OperationsManager"</span>) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment"># Try to load the module</span></div><div class="line">        <span class="built_in">Import-Module</span> -Name <span class="string">"OperationsManager"</span></div><div class="line">    &#125; <span class="keyword">catch</span> &#123;</div><div class="line">        <span class="comment"># Did not work, exit the script</span></div><div class="line">        <span class="built_in">Write-Output</span> <span class="string">"Could not load Operations Manager module"</span></div><div class="line">        <span class="keyword">exit</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment"># Module is loaded, connect to Management Group/Server</span></div><div class="line">New-SCOMManagementGroupConnection -ComputerName <span class="variable">$inputScomMS</span></div></pre></td></tr></table></figure>
<p>A good idea would, of course, be to first check if we already have an existing management group connection before creating a new one. But that’s up to you.</p>
<h3 id="Rally-Your-Agents-and-Management-Servers"><a href="#Rally-Your-Agents-and-Management-Servers" class="headerlink" title="Rally Your Agents (and Management Servers)"></a>Rally Your Agents (and Management Servers)</h3><p>Since we cannot manage manually installed agents–that would be AD-integrated or installed locally using Configuration Manager or maybe the wizard–through powershell we don’t even want to try. So we’ll exclude them.</p>
<p>We also need all the available management servers. <del>This will not handle Gateway servers as they have their own cmdlet, <code>Get-SCOMGatewayManagementServer</code>, in Operations Manager 2012.</del> Strike that! There is a specific cmdlet for Gateway Servers in OpsMgr 2012, but the regular <code>Get-SCOMManagementServer</code> actually don’t care whether it’s a normal Management Server or a Gateway Server. The <code>Get-SCOMGatewayManagementServer</code>, however, only return real Gateway Servers. That means that this script will not care if it is a Management Server or a Gateway Server, so be sure to add some kind of filtering before running it in a Management Group containing management servers.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line"><span class="comment"># Select matching remotely manageable agents</span></div><div class="line"><span class="variable">$scomAgents</span> = Get-SCOMAgent -DNSHostName <span class="variable">$inputTargetAgent</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.ManuallyInstalled <span class="nomarkup">-ne</span> <span class="literal">$true</span>&#125;</div><div class="line"><span class="comment"># Get all management servers</span></div><div class="line"><span class="variable">$scomManagementServers</span> = Get-SCOMManagementServer</div></pre></td></tr></table></figure>
<p>The reason I like to store all matching agents in a variable is that we will save ourselves a lot of trips to the Data Access Service later on, and we also get a nice collection to run our foreach-loop on. This method is much faster than running <code>Get-SCOMAgent</code> inline as we did in “The Basics”.</p>
<blockquote>
<p>Note: It would probably be a good idea to check that <code>$scomAgents</code> actually contains anything; checking for <code>$null</code> with a simple <code>if()</code>would be enough.</p>
</blockquote>
<h3 id="Do-Stuff"><a href="#Do-Stuff" class="headerlink" title="Do Stuff"></a>Do Stuff</h3><p>We have our connection to the management group, we have collected our agents, and we have our management servers. It’s time to loop through the agents and set their Primary and Fail-over management servers.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line"><span class="keyword">foreach</span> (<span class="variable">$scomAgent</span> <span class="keyword">in</span> <span class="variable">$scomAgents</span>) &#123;</div><div class="line">    <span class="comment"># Get the primary management server for the agent</span></div><div class="line">    <span class="variable">$scomPrimaryMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$scomAgent</span>.PrimaryManagementServerName&#125;</div><div class="line">    <span class="comment"># Remove the primary MS from "all MS" array to use it for FailOver servers</span></div><div class="line">    <span class="variable">$scomFailOverMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-ne</span> <span class="variable">$scomPrimaryMS</span>.Name&#125;</div><div class="line">    <span class="comment"># Set Primary Management Server</span></div><div class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -PrimaryServer <span class="variable">$scomPrimaryMS</span></div><div class="line">    <span class="comment"># Set Fail-over Management Server</span></div><div class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -FailoverServer <span class="variable">$scomFailOverMS</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The nice thing about loading the agents and the management servers into variables is that all the information you need for this script is pre-cached in memory. You don’t have to connect to the management group to find out which management server happens is the primary for each agent. And you don’t have to run <code>Get-SCOMManagementServer</code> for each agent to select which ones that will be fail-over management servers. All that information is in memory, and memory is fast.</p>
<h3 id="The-Copy-Paste-Part"><a href="#The-Copy-Paste-Part" class="headerlink" title="The Copy/Paste Part"></a>The Copy/Paste Part</h3><p>As usual, here’s the entire script for you to copy. Read it, try it, adapt it…</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><div class="line"><span class="comment"># Input SCOM Management Server to connect to in this session</span></div><div class="line">[string]<span class="variable">$inputScomMS</span> = <span class="string">"scomms02.domain.local"</span></div><div class="line"><span class="comment"># Input an existing agent you want to modify</span></div><div class="line">[string]<span class="variable">$inputTargetAgent</span> = <span class="string">"*.domain.local"</span></div><div class="line"></div><div class="line"><span class="comment">### Connect to SCOM 2012 Management Group ###</span></div><div class="line"><span class="comment"># Check if OperationsManager module is loaded</span></div><div class="line"><span class="keyword">If</span> (<span class="built_in">Get-Module</span> -Name <span class="string">"OperationsManager"</span>) &#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment"># Try to load the module</span></div><div class="line">        <span class="built_in">Import-Module</span> -Name <span class="string">"OperationsManager"</span></div><div class="line">    &#125; <span class="keyword">catch</span> &#123;</div><div class="line">        <span class="comment"># Did not work, exit the script</span></div><div class="line">        <span class="built_in">Write-Output</span> <span class="string">"Could not load Operations Manager module"</span></div><div class="line">        <span class="keyword">exit</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment"># Module is loaded, connect to Management Group/Server</span></div><div class="line">New-SCOMManagementGroupConnection -ComputerName <span class="variable">$inputScomMS</span></div><div class="line"><span class="comment">### END ###</span></div><div class="line"></div><div class="line"><span class="comment"># Select matching remotely manageable agents</span></div><div class="line"><span class="variable">$scomAgents</span> = Get-SCOMAgent -DNSHostName <span class="variable">$inputTargetAgent</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.ManuallyInstalled <span class="nomarkup">-ne</span> <span class="literal">$true</span>&#125;</div><div class="line"><span class="comment"># Get all management servers</span></div><div class="line"><span class="variable">$scomManagementServers</span> = Get-SCOMManagementServer</div><div class="line"><span class="keyword">foreach</span> (<span class="variable">$scomAgent</span> <span class="keyword">in</span> <span class="variable">$scomAgents</span>) &#123;</div><div class="line">    <span class="comment"># Get the primary management server for the agent</span></div><div class="line">    <span class="variable">$scomPrimaryMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$scomAgent</span>.PrimaryManagementServerName&#125;</div><div class="line">    <span class="comment"># Remove the primary MS from "all MS" array to use it for FailOver servers</span></div><div class="line">    <span class="variable">$scomFailOverMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-ne</span> <span class="variable">$scomPrimaryMS</span>.Name&#125;</div><div class="line">    <span class="comment"># Set Primary Management Server</span></div><div class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -PrimaryServer <span class="variable">$scomPrimaryMS</span></div><div class="line">    <span class="comment"># Set Fail-over Management Server</span></div><div class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -FailoverServer <span class="variable">$scomFailOverMS</span></div><div class="line">&#125;</div><div class="line"><span class="comment">### Done!</span></div></pre></td></tr></table></figure>
<p>GLHF!</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" data-id="cj84poxjy002noogio71dyerd" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/teknoglot" target="_blank">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="https://plus.google.com/+teknoglotse" target="_blank">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="bitbucket" href="https://bitbucket.org/stegenfeldt" target="_blank">
                        <i class="icon fa fa-bitbucket"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/stegenfeldt" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/rss.xml" target="_blank">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            OpsMgr 2012 Agent Failover – A Faster Script with Wildcards [#opsmgr, #powershell]
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/tb/menu-problems/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">Menu Problems!</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/Events/">Events</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></p>
                            <p class="item-title"><a href="/Events/MSIgnite-2017/MSIgnite-2017-GS01-Microsoft-for-the-Modern-Data-Estate/" class="title">#MSIgnite 2017: GS01 - Microsoft for the Modern Data Estate</a></p>
                            <p class="item-date"><time datetime="2017-09-25T13:34:36.000Z" itemprop="datePublished">2017-09-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/Events/">Events</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a></p>
                            <p class="item-title"><a href="/Events/MSIgnite-2017/MSIgnite-2017-KEY01-Vision-Keynote/" class="title">#MSIgnite 2017: KEY01 - Vision Keynote</a></p>
                            <p class="item-date"><time datetime="2017-09-25T08:05:33.000Z" itemprop="datePublished">2017-09-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/ms/">Microsoft</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a></p>
                            <p class="item-title"><a href="/ms/opsmgr2012/Set-SCOMMaintenanceModeDeluxe/" class="title">Set-SCOMMaintenanceMode Deluxe ed. [#opsmgr #powershell]</a></p>
                            <p class="item-date"><time datetime="2016-10-12T22:21:03.000Z" itemprop="datePublished">2016-10-13</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/code/">Code</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/code/vbs/">VBS</a></p>
                            <p class="item-title"><a href="/code/vbs/Resize-all-images-in-a-Word-document-with-vbs-macro/" class="title">Resize all images in a Word document with #vbs #macro</a></p>
                            <p class="item-date"><time datetime="2016-07-05T20:08:26.000Z" itemprop="datePublished">2016-07-05</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/topics/ms/">Microsoft</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a></p>
                            <p class="item-title"><a href="/ms/opsmgr2012/PoSH-Grid-Dashboard-for-RDSH/" class="title">PoSH Grid Dashboard for RDSH [#opsmgr]</a></p>
                            <p class="item-date"><time datetime="2016-06-13T22:01:27.000Z" itemprop="datePublished">2016-06-14</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/topics/code/">Code</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/code/posh/">PoSH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/code/vbs/">VBS</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/Events/">Events</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/Events/MSIgnite-2017/">MSIgnite 2017</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/Linux/">Linux</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/Linux/rhes/">RedHat ES</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/Linux/sles/">SLES</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/Linux/ubuntu/">Ubuntu</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/">Microsoft</a><span class="category-list-count">39</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr2007/">OpsMgr 2007</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/opsmgr2012/">OpsMgr 2012</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/sql/">SQL Server</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/windows/">Windows</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/topics/ms/windows/winxp/">Windows XP</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/ms/winvista/">Windows Vista</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/topics/mikrotik/">Mikrotik</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/topics/tb/">Technobabble</a><span class="category-list-count">9</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tag/ACS/" style="font-size: 10px;">ACS</a> <a href="/tag/Checklist/" style="font-size: 10px;">Checklist</a> <a href="/tag/Conference/" style="font-size: 10px;">Conference</a> <a href="/tag/DNS/" style="font-size: 10px;">DNS</a> <a href="/tag/Drivers/" style="font-size: 12.5px;">Drivers</a> <a href="/tag/Errors/" style="font-size: 15px;">Errors</a> <a href="/tag/Exchange/" style="font-size: 10px;">Exchange</a> <a href="/tag/Fail-over/" style="font-size: 12.5px;">Fail-over</a> <a href="/tag/Field-Notes/" style="font-size: 12.5px;">Field Notes</a> <a href="/tag/Fixed/" style="font-size: 10px;">Fixed</a> <a href="/tag/GSM/" style="font-size: 10px;">GSM</a> <a href="/tag/Gist/" style="font-size: 10px;">Gist</a> <a href="/tag/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tag/Highly-Available/" style="font-size: 10px;">Highly-Available</a> <a href="/tag/How-To/" style="font-size: 17.5px;">How-To</a> <a href="/tag/HowTo/" style="font-size: 10px;">HowTo</a> <a href="/tag/Hyper-V/" style="font-size: 10px;">Hyper-V</a> <a href="/tag/IIS7/" style="font-size: 10px;">IIS7</a> <a href="/tag/Invoke-RestMethod/" style="font-size: 10px;">Invoke-RestMethod</a> <a href="/tag/KB/" style="font-size: 11.25px;">KB</a> <a href="/tag/Linux/" style="font-size: 13.75px;">Linux</a> <a href="/tag/MP-Development/" style="font-size: 12.5px;">MP Development</a> <a href="/tag/MSIgnite/" style="font-size: 11.25px;">MSIgnite</a> <a href="/tag/MSMQ/" style="font-size: 13.75px;">MSMQ</a> <a href="/tag/Machine-Learning/" style="font-size: 10px;">Machine Learning</a> <a href="/tag/Macro/" style="font-size: 10px;">Macro</a> <a href="/tag/Management-Pack/" style="font-size: 18.75px;">Management Pack</a> <a href="/tag/Mikrotik/" style="font-size: 10px;">Mikrotik</a> <a href="/tag/NLB/" style="font-size: 10px;">NLB</a> <a href="/tag/NVidia/" style="font-size: 10px;">NVidia</a> <a href="/tag/Office/" style="font-size: 10px;">Office</a> <a href="/tag/OpenVPN/" style="font-size: 10px;">OpenVPN</a> <a href="/tag/OpsMgr/" style="font-size: 20px;">OpsMgr</a> <a href="/tag/OpsMgr-2007/" style="font-size: 10px;">OpsMgr 2007</a> <a href="/tag/OpsMgr-2012-R2/" style="font-size: 11.25px;">OpsMgr 2012 R2</a> <a href="/tag/PoSH/" style="font-size: 16.25px;">PoSH</a> <a href="/tag/Powershell/" style="font-size: 11.25px;">Powershell</a> <a href="/tag/Presentation-Notes/" style="font-size: 11.25px;">Presentation Notes</a> <a href="/tag/Quick-Reference/" style="font-size: 10px;">Quick Reference</a> <a href="/tag/Quick-fix/" style="font-size: 10px;">Quick-fix</a> <a href="/tag/Quick-hack/" style="font-size: 10px;">Quick-hack</a> <a href="/tag/RHES5/" style="font-size: 10px;">RHES5</a> <a href="/tag/Rant/" style="font-size: 12.5px;">Rant</a> <a href="/tag/RedHat/" style="font-size: 10px;">RedHat</a> <a href="/tag/Reporting-Services/" style="font-size: 10px;">Reporting Services</a> <a href="/tag/RouterOS/" style="font-size: 10px;">RouterOS</a> <a href="/tag/SMS/" style="font-size: 10px;">SMS</a> <a href="/tag/SQL-2017/" style="font-size: 10px;">SQL 2017</a> <a href="/tag/SQL-Express-2005/" style="font-size: 10px;">SQL Express 2005</a> <a href="/tag/SQL-Express-2008/" style="font-size: 10px;">SQL Express 2008</a> <a href="/tag/SQL-Server/" style="font-size: 11.25px;">SQL Server</a> <a href="/tag/SQL-Server-2005/" style="font-size: 10px;">SQL Server 2005</a> <a href="/tag/SQL-Server-2008/" style="font-size: 10px;">SQL Server 2008</a> <a href="/tag/SQL-on-Linux/" style="font-size: 10px;">SQL on Linux</a> <a href="/tag/SUSE-11/" style="font-size: 10px;">SUSE 11</a> <a href="/tag/Script/" style="font-size: 16.25px;">Script</a> <a href="/tag/Scripts/" style="font-size: 10px;">Scripts</a> <a href="/tag/Sillyness/" style="font-size: 10px;">Sillyness</a> <a href="/tag/SquaredUp/" style="font-size: 10px;">SquaredUp</a> <a href="/tag/Teach-a-Man-to-Fish/" style="font-size: 10px;">Teach a Man to Fish</a> <a href="/tag/TechNet/" style="font-size: 10px;">TechNet</a> <a href="/tag/Teknoglot/" style="font-size: 12.5px;">Teknoglot</a> <a href="/tag/TroubleShooting/" style="font-size: 11.25px;">TroubleShooting</a> <a href="/tag/Tutorial/" style="font-size: 10px;">Tutorial</a> <a href="/tag/Unix/" style="font-size: 10px;">Unix</a> <a href="/tag/Update-Rollup/" style="font-size: 11.25px;">Update Rollup</a> <a href="/tag/VBScript/" style="font-size: 10px;">VBScript</a> <a href="/tag/Video/" style="font-size: 10px;">Video</a> <a href="/tag/Virtual-Appliance/" style="font-size: 10px;">Virtual Appliance</a> <a href="/tag/WMI/" style="font-size: 10px;">WMI</a> <a href="/tag/Windows/" style="font-size: 11.25px;">Windows</a> <a href="/tag/Windows-2008/" style="font-size: 10px;">Windows 2008</a> <a href="/tag/Windows-Installer/" style="font-size: 10px;">Windows Installer</a> <a href="/tag/Windows-Vista/" style="font-size: 10px;">Windows Vista</a> <a href="/tag/Windows-XP/" style="font-size: 10px;">Windows XP</a> <a href="/tag/Word/" style="font-size: 10px;">Word</a> <a href="/tag/Wordpress/" style="font-size: 10px;">Wordpress</a> <a href="/tag/X-Plat/" style="font-size: 11.25px;">X-Plat</a> <a href="/tag/x64/" style="font-size: 11.25px;">x64</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.atea.se/">Atea</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2017 Samuel Tegenfeldt</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'teknoglotse';
    
    
    var disqus_url = 'https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    

    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
