<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>teknoglot:</title>
    <link>https://www.teknoglot.se/</link>
    <atom:link href="/rss.xml" rel="self" type="application/rss+xml"/>
    
    <description>Techspeak for the socially diminished.</description>
    <pubDate>Mon, 03 Sep 2018 08:37:51 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>#OpsMgr 1801 Upgrade - The Fail Anthology</title>
      <link>https://www.teknoglot.se/ms/opsmgr2016/om1801-upgrade-gotchas/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2016/om1801-upgrade-gotchas/</guid>
      <pubDate>Mon, 27 Aug 2018 13:42:17 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;a-collection-of-opsmgr-upgrade-fails&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#a-collection-of-opsmgr-upgrade-fails&quot;&gt;&lt;/a&gt; A Collection of
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="a-collection-of-opsmgr-upgrade-fails"><a class="markdownIt-Anchor" href="#a-collection-of-opsmgr-upgrade-fails"></a> A Collection of OpsMgr Upgrade Fails</h1><p>I’ll be frank on this one; Microsoft really dropped the ball on the 1801 setup program.<br>No upgrade or update has been this ridden with faults and obscure errors, not even the infamous SCOM 2007 SP1 setup. And this is not only errors that will abort the installation, they will actively remove your existing SCOM Components and cause a restore, either from snapshot/checkpoint or from backup.</p><p><strong>MAKE SURE YOUR BACKUPS ARE WORKING!!!</strong></p><p>Rollbacks don’t work in 1801, at all. You have been warned.</p><p>Here’s my list of the issues I’ve seen and wrestled so far.</p><h2 id="net-35-pre-requisites"><a class="markdownIt-Anchor" href="#net-35-pre-requisites"></a> .NET 3.5 Pre-requisites</h2><p>Although neither SCOM 2016 nor 1801 actually has a .NET 3.5 requirement, the setup think it does.<br>The Prerequisute checker isn’t aware though, meaning it will happily try to upgrade and then fail. And, boy, does it fail spectacularly!<br>When the upgrade failes, it’s supposed to perform a rollback, and reading the setup log it actually do try.<br>Unfortunatly, the “rollback” will remove any existing SCOM Roles in the server. O_o</p><p>Yes, thats right. Your Management Server is <strong>no longer a Management Server</strong>!</p><h3 id="workaround"><a class="markdownIt-Anchor" href="#workaround"></a> Workaround</h3><p>Make sure all SCOM Management Servers have .NET Framework 3.5 installed before attempting an upgrade.</p><h2 id="up-to-date-linuxunix-management-packs-or-worse-newer"><a class="markdownIt-Anchor" href="#up-to-date-linuxunix-management-packs-or-worse-newer"></a> Up-to-date Linux/Unix Management Packs (or worse, newer)</h2><p>Oh, yes. If you have Linux management packs that are newer than what’s included in the 1801 setup, this will fail the setup. Causing the same defunct “roll-back” that will <strong>uninstall your Management Server</strong>, but only after it mucks about in your databases for a bit. You’ll need to <strong>restore databases from backup</strong> after this.</p><h3 id="workaround-2"><a class="markdownIt-Anchor" href="#workaround-2"></a> Workaround</h3><p>There’s a few ways to get around this, all done before attempting the upgrade:</p><ul><li>Downgrade your cross-platform management packs (yuck!)</li><li>Import the version shipped with the setup (in the ManagementPack subfolder).</li><li>Remove all Cross-platform management packs.</li></ul><h2 id="updated-oms-management-pack-72120260-released-2018-07-25"><a class="markdownIt-Anchor" href="#updated-oms-management-pack-72120260-released-2018-07-25"></a> Updated OMS Management Pack (7.2.12026.0, released 2018-07-25)</h2><p>This is really the same fault as with the cross-platform management packs, but since this is announced without any other notices other than “import if you need to” I decided to put this in a separate part.</p><p>Here’s the <a href="https://blogs.technet.microsoft.com/momteam/2018/07/25/microsoft-system-center-operations-manager-management-pack-to-configure-operations-management-suite/" target="_blank" rel="noopener">release blog</a> and the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=57172" target="_blank" rel="noopener">SCOM 2016 version</a> of the updated OMS MP.</p><p>Once again, the setup is unable to handle that already existing management packs is newer than what’s provided with the 1801 setup. Instead of skipping, it will fail the installation with a, you guessed it, <strong>uninstalled Management Server</strong> and <strong>semi-upgraded databases</strong> as the result.<br>Hello backup, old friend.</p><p>In the OpsMgrSetupWizard.log file you’ll spot something similar to this:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[11:27:09]:Info::Info:FirstManagementServer: Importing Management Pack: Microsoft System Center Advisor</span><br><span class="line">[11:27:09]:Always::ImportManagementPack: Loading management pack C:\<span class="keyword">install</span>\OM1801\Setup\AMD64\..\..\ManagementPacks\Microsoft.SystemCenter.Advisor.mpb. <span class="number">11</span>:<span class="number">27</span>:<span class="number">09</span></span><br><span class="line">[<span class="number">11</span>:<span class="number">27</span>:<span class="number">10</span>]:<span class="keyword">Error</span>::ImportManagementPack: <span class="keyword">Error</span>: Unable <span class="keyword">to</span> <span class="keyword">load</span> <span class="keyword">management</span> pack C:\<span class="keyword">install</span>\OM1801\Setup\AMD64\..\..\ManagementPacks\Microsoft.SystemCenter.Advisor.mpb</span><br><span class="line">[<span class="number">11</span>:<span class="number">27</span>:<span class="number">10</span>]:<span class="keyword">Error</span>::: Verification <span class="keyword">failed</span> <span class="keyword">with</span> <span class="number">3</span> <span class="keyword">errors</span>:</span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line"><span class="keyword">Error</span> <span class="number">1</span>:</span><br><span class="line"><span class="keyword">Found</span> <span class="keyword">error</span> <span class="keyword">in</span> <span class="number">2</span>|Microsoft.SystemCenter.Advisor|<span class="number">7.2</span><span class="number">.12026</span><span class="number">.0</span>|Microsoft.SystemCenter.Advisor|| <span class="keyword">with</span> message:</span><br><span class="line"><span class="keyword">Version</span> <span class="number">7.3</span><span class="number">.13142</span><span class="number">.0</span> <span class="keyword">of</span> the <span class="keyword">management</span> pack <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">upgrade</span> compatible <span class="keyword">with</span> older <span class="keyword">version</span> <span class="number">7.2</span><span class="number">.12026</span><span class="number">.0</span>. <span class="keyword">Compatibility</span> <span class="keyword">check</span> <span class="keyword">failed</span> <span class="keyword">with</span> <span class="number">2</span> <span class="keyword">errors</span>:</span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line"><span class="keyword">Error</span> <span class="number">2</span>:</span><br><span class="line"><span class="keyword">Found</span> <span class="keyword">error</span> <span class="keyword">in</span> <span class="number">1</span>|Microsoft.SystemCenter.Advisor/<span class="number">31</span>bf3856ad364e35|<span class="number">1.0</span><span class="number">.0</span><span class="number">.0</span>|Microsoft.SystemCenter.Advisor.Settings|| <span class="keyword">with</span> message:</span><br><span class="line">Publicly <span class="keyword">accessible</span> ClassProperty (PortalLink) has been removed <span class="keyword">in</span> the newer <span class="keyword">version</span> <span class="keyword">of</span> this <span class="keyword">management</span> pack.</span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line"><span class="keyword">Error</span> <span class="number">3</span>:</span><br><span class="line"><span class="keyword">Found</span> <span class="keyword">error</span> <span class="keyword">in</span> <span class="number">1</span>|Microsoft.SystemCenter.Advisor/<span class="number">31</span>bf3856ad364e35|<span class="number">1.0</span><span class="number">.0</span><span class="number">.0</span>|Microsoft.SystemCenter.Advisor.Settings|| <span class="keyword">with</span> message:</span><br><span class="line">Publicly <span class="keyword">accessible</span> ClassProperty (OmsBladeLink) has been removed <span class="keyword">in</span> the newer <span class="keyword">version</span> <span class="keyword">of</span> this <span class="keyword">management</span> pack.</span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="number">11</span>:<span class="number">27</span>:<span class="number">10</span>]:<span class="keyword">Error</span>::ImportManagementPack: <span class="keyword">Unknown</span> Error. System.ArgumentException : The requested <span class="keyword">management</span> pack <span class="keyword">is</span> <span class="keyword">not</span> valid. See <span class="keyword">inner</span> <span class="keyword">exception</span> <span class="keyword">for</span> details.</span><br><span class="line">Parameter <span class="keyword">name</span>: managementPack</span><br><span class="line">[<span class="number">11</span>:<span class="number">27</span>:<span class="number">10</span>]:<span class="keyword">Always</span>::FirstManagementServer: <span class="keyword">Failed</span> <span class="keyword">to</span> <span class="keyword">load</span> MP C:\<span class="keyword">install</span>\OM1801\Setup\AMD64\..\..\ManagementPacks\Microsoft.SystemCenter.Advisor.mpb.  We will retry.</span><br></pre></td></tr></table></figure><h3 id="workaround-3"><a class="markdownIt-Anchor" href="#workaround-3"></a> Workaround</h3><p>As with the cross-platform management packs, you basically have two options:</p><ul><li>Downgrade to the setup-provided version of the management pack</li><li><a href="https://blogs.technet.microsoft.com/kevinholman/2016/03/26/how-to-remove-oms-and-advisor-management-packs/" target="_blank" rel="noopener">Remove the OMS/Advisor management packs</a> alltogether.</li></ul><h2 id="operations-manager-reporting-upgrade"><a class="markdownIt-Anchor" href="#operations-manager-reporting-upgrade"></a> Operations Manager Reporting Upgrade</h2><p>When the setup checks for existing products to upgrade, it successfully finds your Operations Manager Reporting (OMRS) installation. Great, you are now able to tick that checkbox that allow you to continue the upgrade.<br>Unfortunately, the actual upgrade seems to be utterly unable to spot it, fails on upgrade and will “roll back” the installation. Since setup believes that there never was an OMRS on the server, it will return to that state.</p><p>Meaning, <strong>you no longer have an Operations Manager Reporting Server!</strong><br>(yay)</p><p>This one is not as critical as the others as you can simply install OMRS again, using the 1801 setup.</p><h3 id="workaround-4"><a class="markdownIt-Anchor" href="#workaround-4"></a> Workaround</h3><p>Install the SCOM 2016 console on the OMRS before attempting your upgrade.<br>Yeah, I know, this is stupid.</p><h2 id="final-thoughts"><a class="markdownIt-Anchor" href="#final-thoughts"></a> Final thoughts</h2><p>What the 💩❗️❓<br>What the hell is going on at Microsoft right now?</p><p>I’ve been a strong supporter of System Center Operations Manager as one of, if not <em>the</em>, best and solid Infrastructure and application monitoring solution currently available. Especially on Windows and Microsoft-heavy platforms. The upgrades and installations have been getting more and more solid and easy to perform. It’s often been a case of “verify backups, hit play, wait”.<br>Up until 1801, that is. And it’s not like in the old days, where an upgrade failure resulted in a slight headache and a bit of troubleshooting to find that little bit of config the documentation failed to mention. No, this one actively corrupts and removes your existing SCOM components, leaving you with the only option to restore from backups or start from scratch.</p><p>Ugh!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2016/om1801-upgrade-gotchas/#disqus_thread</comments>
    </item>
    
    <item>
      <title>#MSIgnite 2017: BRK1039 - Windows Server Software Defined</title>
      <link>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-BRK1039-Windows-Server-Software-Defined/</link>
      <guid>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-BRK1039-Windows-Server-Software-Defined/</guid>
      <pubDate>Tue, 26 Sep 2017 08:23:13 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;BRK1039-Windows-Server-Software-Defined&quot;&gt;&lt;a href=&quot;#BRK1039-Windows-Server-Software-Defined&quot; class=&quot;headerlink&quot; title=&quot;BRK1039 - Wind
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="BRK1039-Windows-Server-Software-Defined"><a href="#BRK1039-Windows-Server-Software-Defined" class="headerlink" title="BRK1039 - Windows Server Software Defined"></a>BRK1039 - Windows Server Software Defined</h1><p><code>The fastest route to the benefits of hyper-converged infrastructure</code></p><p>WinSrv 2016, “Most cloud ready OS”, “Security” etc</p><p>Talking about how WS2016 makes it possible to define Network, Compute and Storage in software, as virtual machines/Applicances.</p><h2 id="WSSD"><a href="#WSSD" class="headerlink" title="WSSD"></a>WSSD</h2><p>Microsoft defines reference architecture, Solution vendors make and certify hardware packages, customers use and get rekommendations from Microsoft and vendors.</p><h3 id="Benefits"><a href="#Benefits" class="headerlink" title="Benefits"></a>Benefits</h3><ul><li>Pre-validated<ul><li>Partner validated against reference architecture</li></ul></li><li>Time to value<ul><li>Up and running quickly</li></ul></li><li>Optimized OOB<ul><li>Less guesswork</li><li>Tuned for the hardware solution</li></ul></li><li>Hardware Choice<ul><li>Select best match from vendors</li></ul></li></ul><h3 id="Converged-Storage"><a href="#Converged-Storage" class="headerlink" title="Converged Storage"></a>Converged Storage</h3><p>VMs on SMB3 on S2D on SOFS Cluster</p><h3 id="Hyper-Converged"><a href="#Hyper-Converged" class="headerlink" title="Hyper-Converged"></a>Hyper-Converged</h3><p>VM on S2D SOFS Cluster<br>Simpler management and deployment, all contained in each “box”. </p><h3 id="Cloud-Inspored-Infrastructure"><a href="#Cloud-Inspored-Infrastructure" class="headerlink" title="Cloud-Inspored Infrastructure"></a>Cloud-Inspored Infrastructure</h3><table><thead><tr><th>Functionality</th><th>Hyper-Converged Standard</th><th>Hyper-Converged Premium</th><th>Converged SDS</th></tr></thead><tbody><tr><td>Security</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>SDN</td><td>N</td><td>Y</td><td>N</td></tr><tr><td>Networking</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Compute</td><td>Y</td><td>Y</td><td>N</td></tr><tr><td>Storage</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>Server</td><td>Y</td><td>Y</td><td>Y</td></tr></tbody></table><h3 id="Key-Use-Cases"><a href="#Key-Use-Cases" class="headerlink" title="Key Use Cases"></a>Key Use Cases</h3><ul><li>Low-cost high-performance storage<ul><li>FileServer, Hyper-V, Databases, Media streaming, High-throughput data ingestion</li></ul></li><li>Infrastructure for VM<ul><li>Enterprise Apps, VDI, Hosting, IT Infrastructure aka Fabric</li></ul></li><li>SQL Server Databases</li><li>Backup/Archive</li></ul><blockquote><p>Some of the examples given in this section looks less like Hyper-Converged and more like a tad smarter file clusters.</p></blockquote><h3 id="WSSD-reference-architecture"><a href="#WSSD-reference-architecture" class="headerlink" title="WSSD reference architecture"></a>WSSD reference architecture</h3><ul><li>Design Overview<ul><li>Hardware Requirements</li><li>Expansion</li></ul></li><li>Server Hardware</li><li>Server and Cluster Configuration</li><li>Net Configuration</li><li>Storage Configuration</li><li>Security Configuration</li></ul><p>Then, from requested or required workload, decide what offering (Hyper-Converged Infrastructure or Converged) and design to use.</p><h3 id="Quality-Assurance-End-to-End"><a href="#Quality-Assurance-End-to-End" class="headerlink" title="Quality-Assurance - End to End"></a>Quality-Assurance - End to End</h3><ul><li>Comp and System Certification<ul><li>IHV &amp; Server Vendor</li><li>Win2016 Logo + SDDC Qualifiers</li></ul></li><li>Solution Validation<ul><li>Solution Vendor<ul><li>reference architecture</li><li>Stress</li><li>Quality-Assurance</li></ul></li></ul></li></ul><h3 id="PCS-Private-Cloud-Simulator"><a href="#PCS-Private-Cloud-Simulator" class="headerlink" title="PCS - Private Cloud Simulator"></a>PCS - Private Cloud Simulator</h3><p>Cool, but can I run it myself?</p><p>It is a public tool, but it might need a partner login to access, speaker was unsure. Speaker also suggested that, while it is possible for us to use the tool, it is not developed as a load-tester for any other than the WSSD solution developers. </p><p><em>It would probably be better for us to stick to tools like <a href="https://github.com/Microsoft/diskspd/tree/master/Frameworks/VMFleet" target="_blank" rel="noopener">VMFleet</a>.</em></p><h3 id="Automated-Deployment"><a href="#Automated-Deployment" class="headerlink" title="Automated Deployment"></a>Automated Deployment</h3><p>This is offered by WSSD Partner, although Microsoft has a DSC-kit prepared.</p><h3 id="Customer-“demo”"><a href="#Customer-“demo”" class="headerlink" title="Customer “demo”"></a>Customer “demo”</h3><ul><li>Moving from Server Cluster + iSCSI</li><li>Mostly File Servers and SQL</li><li>Maxed out at 15000 IOPS</li><li>Latency spikes of 50-100ms (ouch)</li></ul><p>Went to:</p><ul><li>S2D<ul><li>Hyper-Converged Infrastructure</li><li>Hyper-V + Storage on the same node</li></ul></li><li>Simple</li><li>Fault tolerant</li><li>Good performance</li><li>Lower costs</li></ul><p>Opted for DataOn S2d-3216</p><p>Tested with VMFleet</p><ul><li>2225479 IOPS</li><li>6,6MB/s throughput</li><li>0.99 Microsoft latency</li></ul><p>These tested numbers have held true when in production as well.</p><h2 id="Personal-Reflections"><a href="#Personal-Reflections" class="headerlink" title="Personal Reflections"></a>Personal Reflections</h2><p>Again, very little real world talk. It’s all happy-sunshine-candyland.</p><p>I have customers that are testing HCI, and from them I know that there is some things you really have to think about to succeed. It would be nice to hear what parts of the WSSD-rollout was super easy and a little on what popped up as “gotchas”.</p><p>All these IOPS gains; are they from the S2D clusters or mainly from going from SAS/SATA to SSD? Not sure what kind of disks they had before and what performance the could have gotten from simply upgrading their storage. </p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-BRK1039-Windows-Server-Software-Defined/#disqus_thread</comments>
    </item>
    
    <item>
      <title>#MSIgnite 2017: GS01 - Microsoft for the Modern Data Estate</title>
      <link>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-GS01-Microsoft-for-the-Modern-Data-Estate/</link>
      <guid>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-GS01-Microsoft-for-the-Modern-Data-Estate/</guid>
      <pubDate>Mon, 25 Sep 2017 13:34:36 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;GS01-Microsoft-for-the-modern-data-estate&quot;&gt;&lt;a href=&quot;#GS01-Microsoft-for-the-modern-data-estate&quot; class=&quot;headerlink&quot; title=&quot;GS01 - Mic
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="GS01-Microsoft-for-the-modern-data-estate"><a href="#GS01-Microsoft-for-the-modern-data-estate" class="headerlink" title="GS01 - Microsoft for the modern data estate"></a>GS01 - Microsoft for the modern data estate</h1><p>Sep 25, 2:15 pm – 3:30 pm</p><h2 id="Quick-Notes"><a href="#Quick-Notes" class="headerlink" title="Quick Notes"></a>Quick Notes</h2><ul><li>Massive and growing amounts of data.</li><li>Companies that out-develop themselves.</li><li>Some companies have learned to leverage and gain from the data, like Honeywell, DocuSign and Jet. </li><li>Hybrid is the way to go. Quick hands-up: <ul><li>Almost no companies believe all-public is even possible</li><li>Almost all see a hybrid solution is the thing.</li></ul></li></ul><h3 id="SQL-2017-GA-2017-10-02"><a href="#SQL-2017-GA-2017-10-02" class="headerlink" title="SQL 2017 GA 2017-10-02:"></a>SQL 2017 GA 2017-10-02:</h3><ul><li>Available on:<ul><li>Windows</li><li>Linux</li><li>Docker</li><li>Kubernetes…</li></ul></li></ul><p><code>*applause*</code></p><ul><li>Gives superb compatibility over many platforms and distributions.</li><li>2+ million docker pulls.</li><li>Lots of focus on performance and security. has the smallest amount of vulnerabilities. </li><li>Only commercial dB with AI built in. </li><li>R and Python support OOB. </li><li>BI included in license; web, desktop and mobile.</li><li>Support for graph data and queries.</li><li>Advanced machine learning with R + Python.</li><li>Native TSQL scoring.</li><li>Adaptive query processing and Automatic plan correction.</li><li>Special pricing (30%) for SQL on Red hat</li><li>Azure SQL Managed Instance<ul><li>Like a SQL instance on premise, in the cloud. without the server.</li><li>Easy to migrate as it’s the same thing.</li><li>Management using the same tools as always.</li></ul></li><li>SQL SA customers get discounts on Azure SQL.</li></ul><h3 id="Other-stuff"><a href="#Other-stuff" class="headerlink" title="Other stuff"></a>Other stuff</h3><ul><li>Vulnerability assessment for GDPR.</li><li>Intelligent insights into performance.</li></ul><blockquote><p>DEMO: Patient intake, millisecond calculation of estimated stay based on history of patient and similar cases.</p></blockquote><ul><li>Azure DB for MySQL and PostgreSQL.<ul><li>Supports HA etc.</li></ul></li></ul>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-GS01-Microsoft-for-the-Modern-Data-Estate/#disqus_thread</comments>
    </item>
    
    <item>
      <title>#MSIgnite 2017: TK01 - Create a Modern Workplace with Microsoft 365</title>
      <link>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-TK01-Create-a-Modern-Workplace-with-Microsoft-365/</link>
      <guid>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-TK01-Create-a-Modern-Workplace-with-Microsoft-365/</guid>
      <pubDate>Mon, 25 Sep 2017 10:17:15 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;TK01-Create-a-modern-workplace-with-Microsoft-365&quot;&gt;&lt;a href=&quot;#TK01-Create-a-modern-workplace-with-Microsoft-365&quot; class=&quot;headerlink&quot; t
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="TK01-Create-a-modern-workplace-with-Microsoft-365"><a href="#TK01-Create-a-modern-workplace-with-Microsoft-365" class="headerlink" title="TK01 - Create a modern workplace with Microsoft 365"></a>TK01 - Create a modern workplace with Microsoft 365</h1><p>Sep 25, 10:45 am – 12:15 pm</p><blockquote><p>UNSTRUCTURED NOTES AWARENESS NOTICE!<br>Also written on phone, will come back and refine</p><p>Arrived late due to escalators being bottlenecks.<br>Something about 3d objects in office, PowerPoint.<br>Showing a photo with mixed reality, rotating 3d-space. </p></blockquote><h2 id="Office"><a href="#Office" class="headerlink" title="Office"></a>Office</h2><h3 id="Windows-Ink"><a href="#Windows-Ink" class="headerlink" title="Windows Ink"></a>Windows Ink</h3><p>deleting stuff with pen, highlights etc<br>Seems fairly intuitive. Would like to test soon.</p><h3 id="Word"><a href="#Word" class="headerlink" title="Word"></a>Word</h3><p>accessibility, colour blindness, proofing with patterns.<br>language improvements. suggestions about better wordings. </p><h2 id="Excel"><a href="#Excel" class="headerlink" title="Excel"></a>Excel</h2><p>Connects to external data sources, trying to figure out context and provide help.</p><h2 id="Teamwork"><a href="#Teamwork" class="headerlink" title="Teamwork"></a>Teamwork</h2><h3 id="Teams-and-Groups"><a href="#Teams-and-Groups" class="headerlink" title="Teams and Groups"></a>Teams and Groups</h3><ul><li>Seen as the starting point for teams</li><li>New back end for Skype<ul><li>Teams become the core client, eventually replacing Skype for business client.</li></ul></li></ul><h3 id="SharePoint-and-OneDrive"><a href="#SharePoint-and-OneDrive" class="headerlink" title="SharePoint and OneDrive"></a>SharePoint and OneDrive</h3><ul><li>Mobile-ready, responsive, webpages from SharePoint</li><li>Integrates with PowerApps and Flow</li><li>Files on demand, access files without the need for local space.</li></ul><h2 id="Mobile-outlook"><a href="#Mobile-outlook" class="headerlink" title="Mobile outlook"></a>Mobile outlook</h2><ul><li>some sort of “help” to flag messages that might be fraudulent</li><li>Cortana intelligence to find stuff, like good times for meetings</li><li>@mentions in office comments</li></ul><h2 id="Surface-hub"><a href="#Surface-hub" class="headerlink" title="Surface hub"></a>Surface hub</h2><ul><li>whiteboard with intelligent canvas</li><li>recognizes shapes, convert rectangles to tables, edit columns and rows, multiple editors realtime</li></ul><h1 id="Teams"><a href="#Teams" class="headerlink" title="Teams"></a>Teams</h1><ul><li>Now with guest access!</li><li>Access control and MFA</li><li>Team meetings, recorded and replayable</li></ul><h2 id="OneDrive"><a href="#OneDrive" class="headerlink" title="OneDrive"></a>OneDrive</h2><ul><li>OneDrive integrated into Windows kernel</li><li>Status icons provide information about online status of files</li></ul><h2 id="Yammer"><a href="#Yammer" class="headerlink" title="Yammer"></a>Yammer</h2><ul><li>With stream, realtime translations etc</li><li>Yammer comments within stream with analytics</li></ul><h2 id="Windows-Auto-Pilot"><a href="#Windows-Auto-Pilot" class="headerlink" title="Windows Auto Pilot"></a>Windows Auto Pilot</h2><ul><li>configures security profiles, networks, settings, profiles etc</li><li>Better Windows analytics, AI backed. improves categorization and troubleshooting</li><li>Cloud based, no need for corporate network connection</li><li>Upgrade analysis, Windows, apps, and office plugins.</li></ul><h2 id="Other-notes"><a href="#Other-notes" class="headerlink" title="Other notes"></a>Other notes</h2><ul><li>simpler migration of programs to Azure apps</li><li>Windows desktop bridge for backwards compatibility</li><li>MS Security graph</li><li>GDPR Compliance Manager<ul><li>analyses and gives a compliance score based on policies.</li></ul></li><li>Also, New features Azure Advanced Threat Protection</li></ul>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-TK01-Create-a-Modern-Workplace-with-Microsoft-365/#disqus_thread</comments>
    </item>
    
    <item>
      <title>#MSIgnite 2017: KEY01 - Vision Keynote</title>
      <link>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-KEY01-Vision-Keynote/</link>
      <guid>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-KEY01-Vision-Keynote/</guid>
      <pubDate>Mon, 25 Sep 2017 08:05:33 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;KEY01-Vision-Keynote&quot;&gt;&lt;a href=&quot;#KEY01-Vision-Keynote&quot; class=&quot;headerlink&quot; title=&quot;KEY01 - Vision Keynote&quot;&gt;&lt;/a&gt;KEY01 - Vision Keynote&lt;/
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="KEY01-Vision-Keynote"><a href="#KEY01-Vision-Keynote" class="headerlink" title="KEY01 - Vision Keynote"></a>KEY01 - Vision Keynote</h1><p>Sep 25, 9:00 am – 10:00 am</p><blockquote><p>UNSTRUCTURED NOTES! Also, mixed Swedish and English, sorry for that.<br>Will update at a later time</p></blockquote><p>O365, all in one place…<br>Live sändning med AI översättning.<br>What’s the actual purpose of technology, why do we do this? How can we use it to do better. how to ensure privacy while at it.<br>how do we give the power of technology to everyone?<br>Assume everything will be multi device.<br>serverless computing, edge distribution, management.<br>Empower, Engage, Optimize, Transform.</p><p>Microsoft 365 (not Office).<br>Mixed reality. Holo lens, Oasis Headsets.<br>Holo lens cameras for presentation, on github.<br>Notes saved with spatial information for review.<br>Microsoft mixed reality headsets.<br>Conversations can be replayed and reviewed in teams.</p><p>Microsoft graph is extensible, for example with LinkedIn.<br>Outlook connected LimkedIn, better searches for… everything?<br>Bing for business, can search graph as well.<br>Nice integration with any applications extending graph. Pairs well with machine learning and AI/Fuzzy Search to parse both data and meta data on context. Admin portal gives insight and analytics into what’s searched for further optimization. Also connects with Cortana.</p><p>Business applications<br>Dynamics 365. Also extends graph.<br>AI First. Virtual Agent demo.</p><p>App&amp;Infra / AI<br>Azure. Intelligent Cloud, intelligent creativity.<br>Machine reading and comprehension.</p><p>Quantum computing… ?<br>MS seems to be trying hard to build one.<br>VS gets tools for developing and debugging and testing qbits.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Events/MSIgnite-2017/MSIgnite-2017-KEY01-Vision-Keynote/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Set-SCOMMaintenanceMode Deluxe ed. [#opsmgr #powershell]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/Set-SCOMMaintenanceModeDeluxe/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/Set-SCOMMaintenanceModeDeluxe/</guid>
      <pubDate>Wed, 12 Oct 2016 22:21:03 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;Untimely-perhaps&quot;&gt;&lt;a href=&quot;#Untimely-perhaps&quot; class=&quot;headerlink&quot; title=&quot;Untimely, perhaps&quot;&gt;&lt;/a&gt;Untimely, perhaps&lt;/h1&gt;&lt;p&gt;While most o
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Untimely-perhaps"><a href="#Untimely-perhaps" class="headerlink" title="Untimely, perhaps"></a>Untimely, perhaps</h1><p>While most of us are waiting for SCOM 2016 RTM to be generally available i’ve completely forgot to blog about my little <code>Set-SCOMMaintenanceModeDeluxe.ps1</code> script I wrote a while ago.</p><p>It is pretty much a small extension to the regular <code>Set-SCOMMaintenanceMode</code> cmdlet that allows you to set Computers, Groups or specific Windows Services into maintenance mode.<br>I have yet to make it a proper module (although I have promised myself to do so) so you’d still have to manually download the script and execute it the old-fashioned way.</p><p>I’ve uploaded it as a public gist on github, so feel free to add adapt it to your needs.</p><h1 id="Here’s-the-gist"><a href="#Here’s-the-gist" class="headerlink" title="Here’s the gist"></a>Here’s the gist</h1><script src="//gist.github.com/b3f044aa77894ed80d82f8849a48035b.js?file=Set-SCOMMaintenanceModeDeluxe.ps1"></script>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/Set-SCOMMaintenanceModeDeluxe/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Resize all images in a Word document with #vbs #macro</title>
      <link>https://www.teknoglot.se/code/vbs/Resize-all-images-in-a-Word-document-with-vbs-macro/</link>
      <guid>https://www.teknoglot.se/code/vbs/Resize-all-images-in-a-Word-document-with-vbs-macro/</guid>
      <pubDate>Tue, 05 Jul 2016 20:08:26 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;TLDR&quot;&gt;&lt;a href=&quot;#TLDR&quot; class=&quot;headerlink&quot; title=&quot;TLDR&quot;&gt;&lt;/a&gt;TLDR&lt;/h1&gt;&lt;p&gt;Quick and dirty macro to resize all images in a word document 
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a>TLDR</h1><p>Quick and dirty macro to resize all images in a word document to 145 mm. I am lazy like that.</p><p>Get the gist of it <a href="https://gist.github.com/stegenfeldt/5d81ab5c57a3d20397a6b04a75b882e0" target="_blank" rel="noopener">here</a>.</p><h1 id="The-“Why”"><a href="#The-“Why”" class="headerlink" title="The “Why”"></a>The “Why”</h1><p>Ok, so. I am a consultant, as you may know. And as a consultant, people pay me to do stuff and expect me to be efficient and deliver with high quality.<br>Part of that entails writing documentation containing how I do stuff, where I do it and often why I do it.<br>This documentation is expected to be detailed enough to make sure my customers will be able to follow the steps and produce a copy of my work. Most of the time<br>these document are a big part of the disaster recovery processes and might have to be executed by the on-call staff with no previous knowledge of the product.</p><p>This means screenshots. Lots of screenshots.<br>And while templates are nice and help me out a lot, the screenshots have to be from the actual installation and not some copy-pasta from a previous assignment.<br>To help me out, I use the excellent free program <a href="http://getgreenshot.org/" target="_blank" rel="noopener">Greenshot</a> to quickly generate screenshots into a WIP-folder (or directly into Word if that is appropriate) and that makes it possible to<br>grab snapshots of the process without having to pause all the time to <code>PrtScn-Alt+Tab-Ctrl+V-Crop-Ctrl+C-Alt+Tab-Ctrl+C</code>. I simply press <code>PrtScn</code> and go on with the installation.</p><p>Being a bit pedantic, doesn’t help me out here though as I find myself selecting and resizing all the images in the Word document I have produced. This is a <em>very</em> time-consuming process and not the most exact one either.<br>I want all images to be of scaled, if necessary, to an equal maximum width that fits comfortably withing the margins of the document template my company has prepared for me. </p><p>So I created a fairly simple macro to do it for me.</p><h1 id="The-“How”"><a href="#The-“How”" class="headerlink" title="The “How”"></a>The “How”</h1><p>If you are un-familiar with macros in Word, you will find them under the “View” tab.<br>Clicking on “Macros” will give you the option to execute the ones you have, or you can create your own using VBA (Visual Basic for Applications).<br>To create one, select where you want it saved (normal.dotx in my case, as I want it readily available) and enter a name for it.<br>This will bring up the Visual Basic for Applications IDE, where you can write your own fun stuff.</p><p>This little macro of mine is saved as a .bas file, which means I can import it into VBA by right-clicking the navigation and selecting “Import file…”.<br>By doing that, and saving my changes, it is now available to me in any other word document, given that I saved it into the global template.</p><h1 id="The-Macro"><a href="#The-Macro" class="headerlink" title="The Macro"></a>The Macro</h1><p>I’ve put it up on a <a href="https://gist.github.com/stegenfeldt/5d81ab5c57a3d20397a6b04a75b882e0" target="_blank" rel="noopener">public gist</a> for anyone interested.<br>It is, currently, very specific for my templates but it’s very easy to modify it to set images to a different size than 145 mm wide.<br>Give it a little love, and we could add options for width as well, but I dont need that right now.</p><p>And for those who don’t want to travel all the way to Github, here’s the script in it’s current form.</p><script src="https://gist.github.com/stegenfeldt/5d81ab5c57a3d20397a6b04a75b882e0.js"></script>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/code/vbs/Resize-all-images-in-a-Word-document-with-vbs-macro/#disqus_thread</comments>
    </item>
    
    <item>
      <title>PoSH Grid Dashboard for RDSH [#opsmgr]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/PoSH-Grid-Dashboard-for-RDSH/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/PoSH-Grid-Dashboard-for-RDSH/</guid>
      <pubDate>Mon, 13 Jun 2016 22:01:27 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;TLDR&quot;&gt;&lt;a href=&quot;#TLDR&quot; class=&quot;headerlink&quot; title=&quot;TLDR&quot;&gt;&lt;/a&gt;TLDR&lt;/h1&gt;&lt;p&gt;Customer wanted to see all RDS Host servers in a view with the
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="TLDR"><a href="#TLDR" class="headerlink" title="TLDR"></a>TLDR</h1><p>Customer wanted to see all RDS Host servers in a view with their current total session count.</p><p>Decided to use a powershell grid dashboard, and share the script.</p><p>Here’s the gist of it: <a href="https://gist.github.com/stegenfeldt/112c6d3dd513f9659298d1321c98ebd1" target="_blank" rel="noopener">SCOM_RDSH_TotalSession_PoSHWidget.ps1</a></p><h1 id="How-To"><a href="#How-To" class="headerlink" title="How To"></a>How To</h1><p>Keeping it fairly short this time.</p><p>Pre-requisites are:</p><ul><li>System Center 2012 R2 with UR2 or later</li><li>Microsoft RDS Management Pack</li><li>Microsoft Windows Core OS Management Pack</li></ul><h2 id="Create-a-dashboard"><a href="#Create-a-dashboard" class="headerlink" title="Create a dashboard"></a>Create a dashboard</h2><ol><li>Rightclick and create a new view somewhere, make it a Dashboard View</li><li>Enter Name and Description</li><li>Select Grid type, and layout</li></ol><h2 id="Add-a-widget"><a href="#Add-a-widget" class="headerlink" title="Add a widget"></a>Add a widget</h2><ol><li>Click cog on grid view</li><li>Select Powershell Grid Widget</li><li>Set Name and Description</li><li>Paste your <a href="#The-Script">script</a> into the script box</li><li>Save</li></ol><h2 id="The-Script"><a href="#The-Script" class="headerlink" title="The Script"></a>The Script</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Based on https://gallery.technet.microsoft.com/Retrieve-Performance-Data-c4595e2a#content</span></span><br><span class="line"><span class="keyword">function</span> Add-Criteria()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">param</span>(<span class="variable">$criteria</span>,<span class="variable">$clause</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$criteria</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>)</span><br><span class="line">        &#123;<span class="variable">$criteria</span> += <span class="string">" AND <span class="variable">$clause</span>"</span>&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;<span class="variable">$criteria</span> = <span class="variable">$clause</span>&#125;</span><br><span class="line">    <span class="keyword">return</span>(<span class="variable">$criteria</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$rdsClass</span> = Get-SCOMClass -Name <span class="string">"Microsoft.Windows.Server.2012.R2.RemoteDesktopServicesRole.Service.RDSessionHost"</span></span><br><span class="line"><span class="variable">$rdsHosts</span> = Get-SCOMMonitoringObject -Class <span class="variable">$rdsClass</span> | <span class="built_in">Sort-Object</span> -Property <span class="string">'[Microsoft.Windows.Computer].PrincipalName'</span></span><br><span class="line"><span class="variable">$rdsTotalSessionRule</span> = Get-SCOMRule -Name <span class="string">"Microsoft.Windows.Server.2012.R2.RemoteDesktopServicesRole.Service.RDSessionHost.PerformanceCollection.TotalSessions"</span></span><br><span class="line"><span class="variable">$objectName</span> = <span class="string">"Terminal Services"</span></span><br><span class="line"><span class="variable">$counterName</span> = <span class="string">"Total Sessions"</span></span><br><span class="line"><span class="variable">$InstanceName</span> = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$i</span>=<span class="number">0</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$rdsHost</span> <span class="keyword">in</span> <span class="variable">$rdsHosts</span>) &#123;</span><br><span class="line">    <span class="comment"># Build performance criteria</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$rdsClass</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>) &#123; <span class="variable">$criteria</span> = Add-Criteria -criteria <span class="variable">$criteria</span> -clause <span class="string">"MonitoringClassId = '&#123;$(<span class="variable">$rdsClass</span>.Id)&#125;'"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$rdsHost</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>) &#123; <span class="variable">$criteria</span> = Add-Criteria -criteria <span class="variable">$criteria</span> -clause <span class="string">"MonitoringObjectFullName = '$(<span class="variable">$rdsHost</span>.FullName)'"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$objectName</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>) &#123; <span class="variable">$criteria</span> = Add-Criteria -criteria <span class="variable">$criteria</span> -clause <span class="string">"ObjectName = '<span class="variable">$objectName</span>'"</span> &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$counterName</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>) &#123; <span class="variable">$criteria</span> = Add-Criteria -criteria <span class="variable">$criteria</span> -clause <span class="string">"CounterName = '<span class="variable">$counterName</span>'"</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#$criteria</span></span><br><span class="line">    <span class="comment"># Get Performance reader object.</span></span><br><span class="line">    <span class="variable">$perfReader</span> = (Get-SCOMManagementGroup).GetMonitoringPerformanceDataReader(<span class="variable">$criteria</span>)</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$perfReader</span>.Read()) &#123;</span><br><span class="line">        <span class="variable">$perfData</span> = <span class="variable">$perfReader</span>.GetMonitoringPerformanceData()</span><br><span class="line">        <span class="variable">$perfValueReader</span> = <span class="variable">$perfData</span>.GetValueReader(((<span class="built_in">Get-Date</span>).AddMinutes(-<span class="number">180</span>)),(<span class="built_in">Get-Date</span>))</span><br><span class="line"></span><br><span class="line">        <span class="variable">$perfValues</span> = @()</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$perfValueReader</span>.Read()) &#123;</span><br><span class="line">            <span class="variable">$perfValues</span> += <span class="variable">$perfValueReader</span>.GetMonitoringPerformanceDataValue()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$perfValue</span> = <span class="variable">$perfValues</span> | <span class="built_in">Sort-Object</span> -Property TimeSampled | select -Last <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$dataObject</span> = <span class="variable">$ScriptContext</span>.CreateInstance(<span class="string">"xsd://stegenfeldt/nullschema"</span>)</span><br><span class="line">        <span class="variable">$dataObject</span> = <span class="variable">$ScriptContext</span>.CreateFromObject(<span class="variable">$rdsHost</span>, <span class="string">"Id=Id,Health=HealthState,Host=Path"</span>, <span class="literal">$null</span>)</span><br><span class="line">        <span class="variable">$dataObject</span>[<span class="string">"Time Sampled"</span>] = <span class="variable">$perfValue</span>.TimeSampled</span><br><span class="line">        <span class="variable">$dataObject</span>[<span class="string">"Total Sessions"</span>] = <span class="variable">$perfValue</span>.SampleValue</span><br><span class="line">        <span class="variable">$ScriptContext</span>.ReturnCollection.Add(<span class="variable">$dataObject</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$criteria</span> = <span class="literal">$null</span></span><br><span class="line">    ++<span class="variable">$i</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/PoSH-Grid-Dashboard-for-RDSH/#disqus_thread</comments>
    </item>
    
    <item>
      <title>In transit, again</title>
      <link>https://www.teknoglot.se/tb/in-transit-again/</link>
      <guid>https://www.teknoglot.se/tb/in-transit-again/</guid>
      <pubDate>Wed, 01 Jun 2016 19:03:35 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;We’re-moving&quot;&gt;&lt;a href=&quot;#We’re-moving&quot; class=&quot;headerlink&quot; title=&quot;We’re moving!&quot;&gt;&lt;/a&gt;We’re moving!&lt;/h1&gt;&lt;p&gt;Yep. Again. Although, it’s b
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="We’re-moving"><a href="#We’re-moving" class="headerlink" title="We’re moving!"></a>We’re moving!</h1><p>Yep. Again. Although, it’s been a year or two since the last time.</p><h2 id="The-reason-s"><a href="#The-reason-s" class="headerlink" title="The reason(s)"></a>The reason(s)</h2><p>Ok, so I’ve using <a href="https://www.wordpress.org" target="_blank" rel="noopener">Wordpress</a> for quite a long time now and it’s been good. Mostly.<br>It’s a fairly solid platform and has a whole slew of feautures that work nicely.</p><p>Before Wordpress I used Textpattern, a very slimmed, minimalistic authoring experience and my first contact with <a href="https://en.wikipedia.org/wiki/Textile_(markup_language)" target="_blank" rel="noopener">textile</a> and<br>similar markup/writing/notation languages. For those unaware, textile is not unlike <a href="https://en.wikipedia.org/wiki/Markdown" target="_blank" rel="noopener">markdown</a>.<br>Or should we say that markdown is not unlike textile? Considering that textile was invented by Dean Allen two years before markdown.<br>Anyhow. Both work pretty much as good as the other, allowing the author to write in any text-editor, using easily readable and fairly logical formatting.</p><p>Before that I used Movable Type, and prior to that either Dreamweaver or… well, notepad or vim.</p><p>Problem with all of those platforms, however, is that they require dynamically generated webpages and technologies like PHP, Perl, .NET, Java and whatnot.<br>That, in itself, has been a very minor issue until lately. Sure, it requires servers with logics, engines, add-ons, execution rights to the local filesystem etc, but<br>still a minor nuisance. Mostly a financial nuisance really as active servers tend to cost money while finding static hosting for free is still pretty easy.<br>Hell! I could put a webserver on a RaspberryPi and get good performance for a small-ish blog like mine if all I am using is static content.</p><p>But, again. Not a major problem in itself. The main instigating factors to move away from Wordpress are the increasing size of the package, the lack of personal control,<br>the lack of ease to extend my platform due to ever-expanding APIs and the fact that it is so popular that every “hacker” and it’s mother knows how to find exploits on it.<br>My webhost, <a href="https://www.nearlyfreespeech.net/" target="_blank" rel="noopener">NFSN</a> has been very good at detecting probing and brute-force attempts and automatically block public access to stuff like the login-pages and XML-RPC interfaces when that happens.<br>I am just so sick and tired of having to constantly be on top of it with software updates, plugin updates, theme updates, security updates, spam-filtering, re-enabling the login page…</p><h2 id="Back-to-the-basics"><a href="#Back-to-the-basics" class="headerlink" title="Back to the basics"></a>Back to the basics</h2><p>Teknoglot.se will be served statically from now on, and it will be hosted for free on <a href="https://pages.github.com/" target="_blank" rel="noopener">Github Pages</a>.<br>Using <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo.io</a> I can write my posts using markdown, then with a simple <code>hexo generate --deploy</code> generate and update the static files and publish them.<br>No login pages to hack, no dynamic pages to exploit, no server security to worry about.</p><p>Hexo is built using node.js, which I have installed for other reasons anyway, and since the actual website is build from a git repository I obviously have proper versioning on everything I do per default.</p><p>There’s obviously not as many plugins, helpers, themes and features available as in Wordpress. And blogging will require some command-line stuff.<br>But I am totally fine with that. I means I can write offline, generate offline to preview. And when finished, push to the public repo.</p><h2 id="But-comments"><a href="#But-comments" class="headerlink" title="But, comments?"></a>But, comments?</h2><p>Using Disqus. All client-side.<br>You need javascript, obviously, but I don’t see me losing many readers for that to be frank. ;)</p><h2 id="The-kinks"><a href="#The-kinks" class="headerlink" title="The kinks"></a>The kinks</h2><p>No, not <a href="https://en.wikipedia.org/wiki/The_Kinks" target="_blank" rel="noopener">the band</a>. The stuff I have missed while migrating the posts from Wordpress to Hexo.<br>Here’s what to expect.</p><h3 id="Permalinks-may-not-work"><a href="#Permalinks-may-not-work" class="headerlink" title="Permalinks may not work"></a>Permalinks may not work</h3><p>I have done my best to ensure that my old permalink structure from the old site is intact.<br>Hexo have some limitations to categories though, meaning that I cannot yet have two main categories on the same post.<br>This do affect those articles that were available through both /code/posh/my-post, /ms/scom2012/my-post.<br>For those, I have had to pick one to be main and rely on tags to group stuff more freely. </p><h3 id="Code-highlight-artefacts"><a href="#Code-highlight-artefacts" class="headerlink" title="Code-highlight artefacts"></a>Code-highlight artefacts</h3><p>Wordpress highlight plugins and markdown have different syntax, and the migration plugin did not handle that.<br>This means that you might find a few <code>[powershell]</code>, <code>[sql]</code> or <code>[plain]</code> tags littered throughout the post for a while.<br>If you spot one, do comment to let me know. But I will try to convert them all as I find them.</p><h3 id="Images-and-galleries"><a href="#Images-and-galleries" class="headerlink" title="Images and galleries"></a>Images and galleries</h3><p>Not sure I ever used a gallery, but some images may be missing as I have to migrate them manually and I am absolutely certain that I have missed at least one. Maybe two. ^That’s ^a ^joke.</p><p>Once again, if you find a missing one you are welcome to post a comment to let me know.</p><h3 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h3><p>Nope, no such thing in Hexo at the moment.<br>May be able to use some other structure, but for now it will be normal posts with links. Probably missing a few there as well.</p><h3 id="Post-tabs"><a href="#Post-tabs" class="headerlink" title="Post tabs"></a>Post tabs</h3><p>Also not available in Hexo.<br>I have converted those posts to regular posts. I am working on a proper TOC to make them easier to browse.</p><h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><p>As with the images, links I have created manually may point to old wordpress folders and have to be redirected.<br>I know for a fact that I have missed a few.</p><h3 id="Graphics"><a href="#Graphics" class="headerlink" title="Graphics"></a>Graphics</h3><p>Using a new theme will take a few adaptations to logos and other graphics.<br>This will change over time, so don’t laugh too hard. </p><h1 id="The-Last-Word"><a href="#The-Last-Word" class="headerlink" title="The Last Word"></a>The Last Word</h1><p>Things be wonky. Have patience. Thanks!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/in-transit-again/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Event Id 4001 – “Cannot Add Type” in [#SQL] MP 6.6.4.0 for [#OpsMgr2012]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/Event-Id-4001-%E2%80%93-%E2%80%9CCannot-Add-Type%E2%80%9D-in-SQL-MP-6-6-4-0-for-OpsMgr2012/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/Event-Id-4001-%E2%80%93-%E2%80%9CCannot-Add-Type%E2%80%9D-in-SQL-MP-6-6-4-0-for-OpsMgr2012/</guid>
      <pubDate>Mon, 15 Feb 2016 11:22:28 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Was troubleshooting this little error message for a customer after deploying the SQL Server Management Pack version 6.6.4.0.&lt;/p&gt;
&lt;p&gt;The e
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Was troubleshooting this little error message for a customer after deploying the SQL Server Management Pack version 6.6.4.0.</p><p>The event is the generic “Health Service Script” with id 4001.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Management Group: REDACTED. Script: Main Module: CPUUsagePercentDataSource.ps1 :</span><br><span class="line">Computer Name = &quot;REDACTED.redacted.com&quot; WMI = &quot;ComputerManagement11&quot; Service Name = &quot;MSSQLSERVER&quot; SQL Instance Name = &quot;MSSQLSERVER&quot;</span><br><span class="line">Error occured during CPU Usage for SQL Instances data source executing.</span><br><span class="line">Computer: REDACTED</span><br><span class="line">Reason: Cannot add type. Compilation errors occurred.</span><br><span class="line">Position:256</span><br><span class="line">Offset:21</span><br><span class="line">Detailed error output: Cannot add type. Compilation errors occurred.</span><br><span class="line">--------</span><br><span class="line">(0) : No source files specified</span><br><span class="line"></span><br><span class="line">(1) : using System;</span><br><span class="line"></span><br><span class="line">--------</span><br><span class="line">(0) : Source file &quot;C:\Windows\TEMP\njdqtgfb.0.cs&quot; could not be found</span><br><span class="line"></span><br><span class="line">(1) : using System;</span><br></pre></td></tr></table></figure><p>There are some known errors to the 6.6.4.0 version of the SQL management packs, and one of them does mention <em>“Cannot add type. Compilation errors occured.”</em><br>In a <a href="https://social.technet.microsoft.com/Forums/en-US/operationsmanagergeneral/thread/92796ead-739d-4128-9afb-1e6f770099d6/#3004a2fc-88ad-4c74-936a-8ed3c8aa70fa" target="_blank" rel="noopener">thread on the Technet Forums</a> it was suggested that it has to do with rights, but focusing mainly on the SQL instance. What caught our eyes, however, was the fact that the script is using the <code>C:\Windows\TEMP</code> folder instead of its private one. And this seems to be because it is using a few .Net components that do some sort of JIT compilation.<br>We took a quick look using <em>procmon</em>, filtered on C:\Windows\TEMP\ and yes indeed. The monitoring account used is trying to create and delete its temporary files in that very folder.</p><h1 id="A-wild-work-around-appears"><a href="#A-wild-work-around-appears" class="headerlink" title="A wild work-around appears!"></a>A wild work-around appears!</h1><p>The work-around is simple, but cumbersome. Just make sure that the assigned RunAs account have read/write/delete rights on C:\Windows\TEMP.<br>Now you just have to manage this on all your SQL-servers! (yaaaay)</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/Event-Id-4001-%E2%80%93-%E2%80%9CCannot-Add-Type%E2%80%9D-in-SQL-MP-6-6-4-0-for-OpsMgr2012/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2012 R2 UR4 - Field Notes [#opsmgr]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-r2-ur4-field-notes/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-r2-ur4-field-notes/</guid>
      <pubDate>Thu, 30 Oct 2014 10:41:47 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;&lt;em&gt;Quick and unrefined notes on Update Roll-up 4 for System Center 2012 R2 -&lt;br&gt;Operations Manager&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;Preparation&quot;&gt;&lt;a href
        
      
      </description>
      
      <content:encoded><![CDATA[<p><em>Quick and unrefined notes on Update Roll-up 4 for System Center 2012 R2 -<br>Operations Manager</em></p><h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>The usual routine applies. Check the <a href="http://support.microsoft.com/kb/2992020" target="_blank" rel="noopener">KB</a> for instructions and take not of<br>known issues. Check if <a href="http://blogs.technet.com/b/kevinholman/" target="_blank" rel="noopener">Kevin Holman</a> has written something about it. As this<br>is an update <em>roll up</em>, I pre-emptively expect that <a href="http://www.teknoglot.se/ms/opsmgr2012/opsmgr2012r2ur3-field-notes/">gotchas in UR3</a> may<br>apply. Remember to open the update catalog in IE as the downloader is not<br>working in other browsers.</p><p>Download, unpack, toss what languages that does not apply to your organization.</p><p>It is advised to disable any mail-generating alert subscriptions during the<br>upgrade process to avoid unnecessary spammage.</p><h2 id="Issues-So-Far"><a href="#Issues-So-Far" class="headerlink" title="Issues - So Far"></a>Issues - So Far</h2><p>[updated: 2014-11-03]</p><ul><li>Got a few problems with cross-platform monitoring templates not working after the update. This was due to <a href="https://social.technet.microsoft.com/Forums/en-US/e2378c57-02fb-43ac-b263-f28f26e21161/2012-r2-ur4-missing-files" target="_blank" rel="noopener">missing files</a> in the update package. Make sure you download the <a href="http://www.microsoft.com/en-us/download/details.aspx?id=29696" target="_blank" rel="noopener">updated version</a>!</li></ul><p>Have not updated a customer using gateways yet, so unless they<br>have fixed the issues in UR3, expect an update to this section soon.</p><h2 id="Planning"><a href="#Planning" class="headerlink" title="Planning"></a>Planning</h2><p>As with all update roll-ups, you’ve got a number of MSP files to install on<br>the different server roles, some SQL-scripts for the OpsDB and OpsDW and a few<br>updated management packs. I’ve updated the components in the following order.</p><ul><li>Management Servers (and consoles installed on them)</li><li>SQL-Scripts</li><li>Management Packs (might need an updated console for this)</li><li>Consoles</li><li>Gateway Servers</li><li>Web Console</li><li>Agents</li></ul><p>As usual, the first management server update takes the longest as that’s<br>when the process is updating the databases. You absolutely <em>must</em> wait for it to<br>complete before updating anything else. Feel free to prepare the other<br>management servers by copying installations files, logging in and starting up<br>your command prompts as admin. I never update more than one management server at<br>the time anyway. Less to worry about that way.</p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><h3 id="Management-Servers"><a href="#Management-Servers" class="headerlink" title="Management Servers"></a>Management Servers</h3><p>Open a command prompt (powershell will work just fine) as Administrator and<br>execute the MSP-file. First management server will take some time, so be<br>patient. If a management server has multiple roles, you can update those while<br>logged in as well.</p><h3 id="SQL-Scripts"><a href="#SQL-Scripts" class="headerlink" title="SQL-Scripts"></a>SQL-Scripts</h3><p>The installation package will unpack these scripts under <code>%SystemDrive%\ProgramFiles\System Center 2012 R2\Operations Manager\Server\SQL Script for UpdateRollups</code>. Run the <code>UR_Datawarehouse.sql</code> one on the OpsDW first, then the<br><code>Update_rollup_mom_db.sql</code> on OpsDB. If you’re getting deadlocks, try again. If<br>that don’t help, stop the management server services and try again. <em>Do not<br>continue with the next script ​until you’ve succeeded with the first.</em></p><p>If you’ve installed UR3, the OpsDW-script is pretty quick (not sure if<br>it’s changed at all) and the OpsDB is a bit less prone to deadlocks.</p><h3 id="Management-Packs"><a href="#Management-Packs" class="headerlink" title="Management Packs"></a>Management Packs</h3><p>Just import the management packs from the %SystemDrive%\Program Files\System<br>Center 2012 R2\Operations Manager\Server\Management Packs for Update Rollups<br>folder. Might have to retry as the console can do a little poor job of<br>calculating the dependencies.</p><h3 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h3><p>The easiest one, just install the MSP-file.</p><h3 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h3><p>Installation is a breeze. Make sure to check <code>%SystemDrive%\Program Files\SystemCenter Operations Manager\Gateway\AgentManagement\&lt;architecture&gt;</code> for updated<br>agent files. If not, copy from same folder on any management server.</p><h3 id="Web-Console"><a href="#Web-Console" class="headerlink" title="Web Console"></a>Web Console</h3><p>Installation is very simple. Install the MSP from an administrative command<br>prompt. If you’re affected by <a href="http://support.microsoft.com/kb/911722" target="_blank" rel="noopener">KB911722</a> and need the web console fixes, you<br>need to edit <code>%windir%\Microsoft.NET\Framework64\v2.0.50727\CONFIG\web.config</code><br>by adding the following line:</p><p><code>&lt;machineKey validationKey=&quot;AutoGenerate,IsolateApps&quot;decryptionKey=&quot;AutoGenerate,IsolateApps&quot; validation=&quot;3DES&quot; decryption=&quot;3DES&quot;/&gt;</code></p><h3 id="Agents"><a href="#Agents" class="headerlink" title="Agents"></a>Agents</h3><p>Normal update procedure applies. Use “Pending Management”, SCCM, manual<br>installations or whatever method you’d like.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>If you already have UR3, this one is very quick. If you are updating a fresh<br>installation, wait a day or your management group may end up uninitialized for<br>reasons. Remember to enable your subscriptions when done.</p><p>GLHF!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-r2-ur4-field-notes/#disqus_thread</comments>
    </item>
    
    <item>
      <title>SquaredUp Installation - Manual? Pfffft! [#opsmgr #squaredup]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/squaredup-installation/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/squaredup-installation/</guid>
      <pubDate>Tue, 09 Sep 2014 14:38:36 GMT</pubDate>
      <description>
      
        &lt;h1 id=&quot;Story-time&quot;&gt;&lt;a href=&quot;#Story-time&quot; class=&quot;headerlink&quot; title=&quot;Story-time&quot;&gt;&lt;/a&gt;Story-time&lt;/h1&gt;&lt;p&gt;I saw &lt;a href=&quot;http://www.squaredup.com/&quot; title=&quot;SquaredUp&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SquaredUp&lt;/a&gt; some year or two ago while googling about on behalf of a customer looking for a dashboard kind of thingy. It looked good and fairly simple, but for some reason it never clicked with the customer and we ended up going for some custom-made dashboards with a little scripting and some &lt;abbr title=&quot;Database&quot;&gt;DB&lt;/abbr&gt;-queries. I kind of liked the look of their product though and have kept an eye on them now and then.&lt;br&gt;Fast-forward to may 21st this year and the &lt;a href=&quot;http://www.squaredup.com/blog/proudly-announcing-squared-v18&quot; title=&quot;Proudly Announcing v1.8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;release of version 1.8&lt;/a&gt; and a whole slew of &lt;a href=&quot;http://www.squaredup.com/blog/squared-v18-new-features&quot; title=&quot;New Features in v1.8&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;nifty little features&lt;/a&gt;. What specifically piqued my interest was the linked dashboards, SharePoint integration and the included SLA and Map plugins. This basically ticked a lot of boxes many of my customers have looked for and something we’ve normally been looking into… err… &lt;em&gt;other products&lt;/em&gt; for. That, coupled with some new videos on their &lt;a href=&quot;https://www.youtube.com/user/SquaredUpLtd&quot; title=&quot;SquaredUp YouTube Channel&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Youtube-channel&lt;/a&gt;, a few well-placed tweets and a little mail-correspondence had me setting it up in my portable little lab.&lt;/p&gt;
&lt;p&gt;One of the interesting points is how, supposedly easy, it is to set the portal up. So I reset my lab – &lt;abbr title=&quot;Powershell Deployment Toolkit&quot;&gt;PDT&lt;/abbr&gt; is just wonderful – and decided to go for the hail-dummy approach. No manual, no preparations, no check-lists… Next-next-next then hopefully a working portal.&lt;br&gt;
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Story-time"><a href="#Story-time" class="headerlink" title="Story-time"></a>Story-time</h1><p>I saw <a href="http://www.squaredup.com/" title="SquaredUp" target="_blank" rel="noopener">SquaredUp</a> some year or two ago while googling about on behalf of a customer looking for a dashboard kind of thingy. It looked good and fairly simple, but for some reason it never clicked with the customer and we ended up going for some custom-made dashboards with a little scripting and some <abbr title="Database">DB</abbr>-queries. I kind of liked the look of their product though and have kept an eye on them now and then.<br>Fast-forward to may 21st this year and the <a href="http://www.squaredup.com/blog/proudly-announcing-squared-v18" title="Proudly Announcing v1.8" target="_blank" rel="noopener">release of version 1.8</a> and a whole slew of <a href="http://www.squaredup.com/blog/squared-v18-new-features" title="New Features in v1.8" target="_blank" rel="noopener">nifty little features</a>. What specifically piqued my interest was the linked dashboards, SharePoint integration and the included SLA and Map plugins. This basically ticked a lot of boxes many of my customers have looked for and something we’ve normally been looking into… err… <em>other products</em> for. That, coupled with some new videos on their <a href="https://www.youtube.com/user/SquaredUpLtd" title="SquaredUp YouTube Channel" target="_blank" rel="noopener">Youtube-channel</a>, a few well-placed tweets and a little mail-correspondence had me setting it up in my portable little lab.</p><p>One of the interesting points is how, supposedly easy, it is to set the portal up. So I reset my lab – <abbr title="Powershell Deployment Toolkit">PDT</abbr> is just wonderful – and decided to go for the hail-dummy approach. No manual, no preparations, no check-lists… Next-next-next then hopefully a working portal.<br><a id="more"></a></p><h1 id="The-Installation"><a href="#The-Installation" class="headerlink" title="The Installation"></a>The Installation</h1><p>First, download the installation file (yes, singular) through the link you’ve got in your email and save it somewhere proper.<br><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152402_0001.png" alt="SquaredUp - Installation Package" title="SquaredUp - Installation Package"></p><p>Doubleclicked the installation packaged and it now tells me it will install a few pre-requisites and configure the website for me. Next!</p><p><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152428_0002.png" alt="Installation Information" title="SquaredUp - Something something components"></p><p>The <abbr title="End User License Agreement">EULA</abbr> I am sure each one of you are reading. Next!<br><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152447_0003.png" alt="EULA" title="SquaredUp - Yeah, mhm... Read it."></p><p>Installing, or rather configuring, <abbr title="Internet Information Services">IIS</abbr> and pre-requisites for me. Very nice. Next!</p><p><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152506_0004.png" alt="Installing/Configuring IIS" title="SquaredUp - installing IIS for me... nice."></p><p>Quick summary before actual installation. Next!</p><p><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152525_0005.png" alt="Installation Summary" title="SquaredUp - Webroot... ok, sure."></p><p>This step actually requires a little action on your part. In this installation, the default setting “localhost” would actually work but I prefer to actually configure these things properly. I only have a single Management Server in this lab, so testing a load-balanced highly available scenario was not possible. Enter Management Server name, then Next!</p><p><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152612_0006.png" alt="Configuring the Management Server" title="SquaredUp - Configure Management Server"></p><p>After a slight case of progress-bar the installation is now complete. Click link and exit the installer. Time spent so far is less than ten minutes, probably closer to five.<br>Now it’s time to login using your normal <abbr title="System Center 2012 - Operations Manager">SCOM</abbr> credentials.</p><p><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/152750_0008.png" alt="Login Screen" title="SquaredUp - Login Screen"></p><p>First login will bring you to the Activation Screen. Simply paste the activation key from the email and Activate. This requires a working internet connection.</p><p><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/153833_0010.png" alt="Activation Screen" title="SquaredUp - Activation Screen"></p><p>That’s it! Well… not really. Navigating the portal I noticed that the spark-lines aren’t showing, and hitting the “View Performance” link on an object view gives me a “Login failed for user…” error. I know I saw something about configuring the Data Warehouse in the email, so I check the blissfully simple Settings panel.<br><img src="http://www.teknoglot.se/wp-content/uploads/2014/09/154502_0012.png" alt="Settings Panel - DW Configuration" title="SquaredUp - Configure DW Help"></p><p>Followed the <a href="http://support.squaredup.com/support/solutions/articles/27999" title="Squared Up - Configuring Data Warehouse Permissions" target="_blank" rel="noopener">instructions</a> to configure the security of the OperationsManagerDW database for the SquaredUp web application, and that’s really it. Portal is up and running, spark-lines working. Ready to go.</p><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>I wish more products and “add-ons” to <abbr title="System Center 2012 - Operations Manager">SCOM</abbr> were this easy to install. No extra databases, no extra permissions, no extra infrastructure. I would like to try it out in a larger environment and see what the load on the website, the databases and the data access service will be. It would also be necessary to verify that it works properly when the management servers are behind a load balancer and maybe even putting the SquaredUp portal behind one itself. Since there is not a lot of configuration to be done and no database, it <em>should</em> work. We’ll see.</p><p>Next up will be fiddling about with custom dashboards, maps, and generally figuring out what else we can do.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/squaredup-installation/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2012 R2 UR3 - Field Notes [#opsmgr]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/opsmgr2012r2ur3-field-notes/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/opsmgr2012r2ur3-field-notes/</guid>
      <pubDate>Tue, 02 Sep 2014 09:30:18 GMT</pubDate>
      <description>
      
        &lt;p&gt;&lt;em&gt;Quick and unrefined notes on Update Roll-up 3 for System Center 2012 R2 - Operations Manager.&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&quot;Preparation&quot;&gt;&lt;a href=&quot;#Preparation&quot; class=&quot;headerlink&quot; title=&quot;Preparation&quot;&gt;&lt;/a&gt;Preparation&lt;/h2&gt;&lt;p&gt;Usual routine, check the &lt;a href=&quot;http://support.microsoft.com/kb/2965445&quot; title=&quot;Update Roll-up 3 for System Center 2012 R2 Operations Manager&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;KB&lt;/a&gt; for instructions and known issues. Double-check with &lt;a href=&quot;http://blogs.technet.com/b/kevinholman/archive/2014/08/07/ur3-for-scom-2012-r2-step-by-step.aspx&quot; title=&quot;UR3 for SCOM 2012 R2 – Step by Step&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Holman’s&lt;/a&gt; blog and take note of any irregularities.&lt;br&gt;&lt;a href=&quot;http://catalog.update.microsoft.com/v7/site/Search.aspx?q=2965445&quot; title=&quot;Hell-spawn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Download&lt;/a&gt;, curse your favourite deity and re-try in IE. Unpack the CAB-files (why do you keep putting them in CAB-files?) and throw away all the unnecessary language-specific console patches.&lt;/p&gt;
&lt;p&gt;Notify affected parts of the organisation, I’ve had the benefit to work with good release managers at all clients so far, so no biggie. Then try to close as many consoles as possible to avoid any blocks in database.&lt;/p&gt;
&lt;p&gt;Make sure you have the credentials for the Data Access service account at hand.&lt;/p&gt;
&lt;h3 id=&quot;Issues-So-Far&quot;&gt;&lt;a href=&quot;#Issues-So-Far&quot; class=&quot;headerlink&quot; title=&quot;Issues - So Far&quot;&gt;&lt;/a&gt;Issues - So Far&lt;/h3&gt;&lt;p&gt;&lt;em&gt;(updated 2014-09-02)&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The SQL Script for the OpsDW was deadlocked at all sites and customers without exception. It’s easily fixed by stopping the management server services.&lt;p&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;A few dashboards (the 2012 versions) went blank. Self-healed after some aggregation job over night. From what I’ve noticed, only the SLA Dashboards are affected but never all of them.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Agents behind daisy-chained Gateways is not identified as in need of an update. “Repairing” them from the Console is one work-around that seems to work consistently.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;A few agents that was updated using Windows Update did not report as updated. Repair fixed that nuisance.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Had to flush the cache on a few Gateways to avoid heartbeat failures from their agents. Only daisy-chained ones if I recall correctly.&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p><em>Quick and unrefined notes on Update Roll-up 3 for System Center 2012 R2 - Operations Manager.</em></p><h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>Usual routine, check the <a href="http://support.microsoft.com/kb/2965445" title="Update Roll-up 3 for System Center 2012 R2 Operations Manager" target="_blank" rel="noopener">KB</a> for instructions and known issues. Double-check with <a href="http://blogs.technet.com/b/kevinholman/archive/2014/08/07/ur3-for-scom-2012-r2-step-by-step.aspx" title="UR3 for SCOM 2012 R2 – Step by Step" target="_blank" rel="noopener">Holman’s</a> blog and take note of any irregularities.<br><a href="http://catalog.update.microsoft.com/v7/site/Search.aspx?q=2965445" title="Hell-spawn" target="_blank" rel="noopener">Download</a>, curse your favourite deity and re-try in IE. Unpack the CAB-files (why do you keep putting them in CAB-files?) and throw away all the unnecessary language-specific console patches.</p><p>Notify affected parts of the organisation, I’ve had the benefit to work with good release managers at all clients so far, so no biggie. Then try to close as many consoles as possible to avoid any blocks in database.</p><p>Make sure you have the credentials for the Data Access service account at hand.</p><h3 id="Issues-So-Far"><a href="#Issues-So-Far" class="headerlink" title="Issues - So Far"></a>Issues - So Far</h3><p><em>(updated 2014-09-02)</em></p><ul><li>The SQL Script for the OpsDW was deadlocked at all sites and customers without exception. It’s easily fixed by stopping the management server services.<p></p></li><li><p>A few dashboards (the 2012 versions) went blank. Self-healed after some aggregation job over night. From what I’ve noticed, only the SLA Dashboards are affected but never all of them.</p></li><li><p>Agents behind daisy-chained Gateways is not identified as in need of an update. “Repairing” them from the Console is one work-around that seems to work consistently.</p></li><li><p>A few agents that was updated using Windows Update did not report as updated. Repair fixed that nuisance.</p></li><li><p>Had to flush the cache on a few Gateways to avoid heartbeat failures from their agents. Only daisy-chained ones if I recall correctly.</p><a id="more"></a></li></ul><h2 id="Planning"><a href="#Planning" class="headerlink" title="Planning"></a>Planning</h2><p></p><p>UR3 is like most update roll-ups you’ve seen so far. There’s a bunch of <abbr title="Microsoft Patch">msp</abbr> files you install on the different server roles, a few SQL-scripts for the OpsDB and the OpsDW and some updated core management packs. I have used the following order and that has worked quite nicely.</p><ul><li>Management Servers (and locally installed consoles)</li><li>SQL-Scripts</li><li>Management Packs<sup id="fnref-818-2"><a href="#fn-818-2">1</a></sup></li><li>Consoles<sup id="fnref-818-1"><a href="#fn-818-1">2</a></sup></li><li>Gateway Servers<sup id="fnref2:818-1"><a href="#fn-818-1">2</a></sup></li><li>Web Console<sup id="fnref3:818-1"><a href="#fn-818-1">2</a></sup></li><li>Agents<sup id="fnref4:818-1"><a href="#fn-818-1">2</a></sup></li></ul><p>The first management server takes the longest time as it will update the databases as well and you <em>must</em> wait for it to complete before hitting any extra management servers. Otherwise the databases isn’t marked as updated and multiple installations will try to update the same stuff at the same time, and that’s generally bad. I’d recommend to never update more than one management server at the same time, although it is possible.</p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><h3 id="Management-Servers"><a href="#Management-Servers" class="headerlink" title="Management Servers"></a>Management Servers</h3><p>Fairly straight-forward. Run the <abbr title="Microsoft Patch">msp</abbr>-file for the server update in an administrative command prompt and follow the wizard. First server takes a while (anything from 10-40 minutes depending on management group size and load in my experience). When that’s done, move on to the next management server. If your management servers have multiple roles, like Console, Web Console or Reporting, go ahead and update those at once.</p><h3 id="SQL-Scripts"><a href="#SQL-Scripts" class="headerlink" title="SQL-Scripts"></a>SQL-Scripts</h3><p>The scripts are unpacked by the setup. You will find them under <code>%SystemDrive%\Program Files\System Center 2012 R2\Operations Manager\Server\SQL Script for Update Rollups</code>. Do OpsDW first using the <code>UR_Datawarehouse.sql</code> script, then go for OpsDB using <code>Update_rollup_mom_db.sql</code>. I’ve gotten the deadlock error on all installations so far and the best way to avoid that is to stop the management server services for this part. It’s <em>absolutely crucial</em> to have the scripts run to successful completion before running the next or moving on to any other server roles.</p><h3 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h3><p>Nothing out of the ordinary here, make sure you run the Console <abbr title="Microsoft Patch">msp</abbr> in an administrative command prompt.</p><h3 id="Management-Packs"><a href="#Management-Packs" class="headerlink" title="Management Packs"></a>Management Packs</h3><p>The updated core management packs are unpacked into <code>%SystemDrive%\Program Files\System Center 2012 R2\Operations Manager\Server\Management Packs for Update Rollups</code>. Import them using one of the updated consoles.</p><h3 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h3><p>Next-next-next if running as administrator. Take effort to verify that the agent updates has been distributed into the <code>%SystemDrive%\Program Files\System Center Operations Manager\Gateway\AgentManagement\&lt;architecture&gt;</code> folder. If not, copy them from the same folder from any of the management servers.</p><h3 id="Web-Console"><a href="#Web-Console" class="headerlink" title="Web Console"></a>Web Console</h3><p>No problems so far as long as you run the Web Console <abbr title="Microsoft Patch">msp</abbr> as administrator.</p><h3 id="Agents"><a href="#Agents" class="headerlink" title="Agents"></a>Agents</h3><p>Update them as usual, using “Pending Management”, windows update, manual installation, <abbr title="System Center Configurations Manager">SCCM</abbr> or whatever method you usually employ. Agent version will not be updated in the Console, but it will be visible under <code>Monitoring/Operations Manager/Agent Management/Agents by Version</code>.</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Fairly simple update, the SQL Scripts can catch your off-guard if you do not know about them. Had some issues with Gateways, but it’s a pretty quick update in most environments. Have not experienced any reboots or service outages on updated systems.</p><p>GLHF!</p><div class="footnotes"><br><br><em> </em> *<br><br>1.  You’re going to need at least one updated console to import the MP-updates. <a href="#fnref-818-2">↩</a><br><br>2.  These can all be executed in parallel, agents behind Gateways will obviously need to be updated <em>after</em> the gateway. <a href="#fnref-818-1">↩</a> <a href="#fnref2:818-1">↩</a> <a href="#fnref3:818-1">↩</a> <a href="#fnref4:818-1">↩</a><br></div>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/opsmgr2012r2ur3-field-notes/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Cloudflare as Dynamic DNS [#cloudflare #mikrotik #script]</title>
      <link>https://www.teknoglot.se/mikrotik/cloudflare-dynamic-dns-mikrotik/</link>
      <guid>https://www.teknoglot.se/mikrotik/cloudflare-dynamic-dns-mikrotik/</guid>
      <pubDate>Mon, 25 Aug 2014 11:37:36 GMT</pubDate>
      <description>
      
        &lt;h1 id=&quot;Background&quot;&gt;&lt;a href=&quot;#Background&quot; class=&quot;headerlink&quot; title=&quot;Background&quot;&gt;&lt;/a&gt;Background&lt;/h1&gt;&lt;p&gt;I have, for a time, been using &lt;a href=&quot;http://www.cloudflare.com&quot; title=&quot;CloudFlare Website&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CloudFlare&lt;/a&gt; for CDN, Optimizations and DNS Management for this and a few other domains. At the same time, I’ve been using &lt;a href=&quot;http://www.dyn.com&quot; title=&quot;Dyn DNS&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DynDNS&lt;/a&gt; to provide name resolution to my home network/lab. Browsing around the &lt;a href=&quot;https://www.cloudflare.com/docs/client-api.html&quot; title=&quot;CloudFlare Client Api&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;CloudFlare JSON API&lt;/a&gt; I noticed that I can update DNS records through some fairly simple HTTP GET requests, and since the RouterOS (the operating system used by &lt;a href=&quot;http://www.mikrotik.com/&quot; title=&quot;Mikrotik Website&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Mikrotik’s&lt;/a&gt; routerboards) has support for some pretty decent scripting I decided to let my router update CloudFlare for some custom and free dynamic DNS resolution.&lt;/p&gt;
&lt;h1 id=&quot;Attribution&quot;&gt;&lt;a href=&quot;#Attribution&quot; class=&quot;headerlink&quot; title=&quot;Attribution&quot;&gt;&lt;/a&gt;Attribution&lt;/h1&gt;&lt;p&gt;My current script is a modified version of a script developed by Konstantin Antselovich.&lt;/p&gt;
&lt;p&gt;Original script: &lt;a href=&quot;http://konstant1n.livejournal.com/9759.html&quot; title=&quot;Random Journal&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://konstant1n.livejournal.com/9759.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Original Author website: &lt;a href=&quot;http://konstantin.antselovich.com/&quot; title=&quot;Konstantin Antselovich&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://konstantin.antselovich.com/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;
&lt;h1 id=&quot;How-you-do-it&quot;&gt;&lt;a href=&quot;#How-you-do-it&quot; class=&quot;headerlink&quot; title=&quot;How you do it&quot;&gt;&lt;/a&gt;How you do it&lt;/h1&gt;&lt;h2 id=&quot;What-you-need&quot;&gt;&lt;a href=&quot;#What-you-need&quot; class=&quot;headerlink&quot; title=&quot;What you need&quot;&gt;&lt;/a&gt;What you need&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;RouterOS v6+ for HTTPS support&lt;/li&gt;
&lt;li&gt;Cloudflare API key, aka “Token”, found at the &lt;a href=&quot;https://www.cloudflare.com/my-account&quot; title=&quot;CloudFlare Account Page&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;account page&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Cloudflare DNS Zone name&lt;/li&gt;
&lt;li&gt;Cloudflare Record Id (more on that later)&lt;/li&gt;
&lt;li&gt;Cloudflare subdomain name&lt;/li&gt;
&lt;li&gt;Name of the external router interface&lt;/li&gt;
&lt;/ul&gt;
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>I have, for a time, been using <a href="http://www.cloudflare.com" title="CloudFlare Website" target="_blank" rel="noopener">CloudFlare</a> for CDN, Optimizations and DNS Management for this and a few other domains. At the same time, I’ve been using <a href="http://www.dyn.com" title="Dyn DNS" target="_blank" rel="noopener">DynDNS</a> to provide name resolution to my home network/lab. Browsing around the <a href="https://www.cloudflare.com/docs/client-api.html" title="CloudFlare Client Api" target="_blank" rel="noopener">CloudFlare JSON API</a> I noticed that I can update DNS records through some fairly simple HTTP GET requests, and since the RouterOS (the operating system used by <a href="http://www.mikrotik.com/" title="Mikrotik Website" target="_blank" rel="noopener">Mikrotik’s</a> routerboards) has support for some pretty decent scripting I decided to let my router update CloudFlare for some custom and free dynamic DNS resolution.</p><h1 id="Attribution"><a href="#Attribution" class="headerlink" title="Attribution"></a>Attribution</h1><p>My current script is a modified version of a script developed by Konstantin Antselovich.</p><p>Original script: <a href="http://konstant1n.livejournal.com/9759.html" title="Random Journal" target="_blank" rel="noopener">http://konstant1n.livejournal.com/9759.html</a></p><p>Original Author website: <a href="http://konstantin.antselovich.com/" title="Konstantin Antselovich" target="_blank" rel="noopener">http://konstantin.antselovich.com/</a></p><p>Thanks!</p><h1 id="How-you-do-it"><a href="#How-you-do-it" class="headerlink" title="How you do it"></a>How you do it</h1><h2 id="What-you-need"><a href="#What-you-need" class="headerlink" title="What you need"></a>What you need</h2><ul><li>RouterOS v6+ for HTTPS support</li><li>Cloudflare API key, aka “Token”, found at the <a href="https://www.cloudflare.com/my-account" title="CloudFlare Account Page" target="_blank" rel="noopener">account page</a></li><li>Cloudflare DNS Zone name</li><li>Cloudflare Record Id (more on that later)</li><li>Cloudflare subdomain name</li><li>Name of the external router interface</li></ul><a id="more"></a><h2 id="Getting-the-Record-Id"><a href="#Getting-the-Record-Id" class="headerlink" title="Getting the Record Id"></a>Getting the Record Id</h2><p>To get the record id of the DNS record you want to update, I used the _<a href="https://www.cloudflare.com/docs/client-api.html#s3.3" title="rec_load_all - Get all DNS Records" target="_blank" rel="noopener">rec_load_all</a>_ function of the API. And since I’m a windows admin, I use powershell for that.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cfDomain</span> = <span class="string">"homelab"</span></span><br><span class="line"><span class="variable">$cfToken</span> = <span class="string">"&lt;your API Key/Token&gt;"</span></span><br><span class="line"><span class="variable">$cfZone</span> = <span class="string">"example.com"</span></span><br><span class="line"><span class="variable">$cfEmail</span> = <span class="string">"&lt;your CF email address&gt;"</span></span><br><span class="line"><span class="variable">$apiLoadAllRecordsURI</span> = <span class="string">"https://www.cloudflare.com/api_json.html?a=rec_load_all&amp;tkn=<span class="variable">$cfToken</span>&amp;email=<span class="variable">$cfEmail</span>&amp;z=<span class="variable">$cfZone</span>"</span></span><br><span class="line"><span class="variable">$restRequest</span> = <span class="built_in">Invoke-RestMethod</span> -Uri <span class="variable">$apiLoadAllRecordsURI</span></span><br><span class="line"><span class="variable">$restRequest</span>.response.recs.objs | ?&#123;<span class="variable">$_</span>.display_name <span class="nomarkup">-eq</span> <span class="variable">$cfDomain</span>&#125; | fl -Property rec_id,name,display_name,type,ttl,service_mode</span><br></pre></td></tr></table></figure><p>That should, given that you’ve replaced all the example variables produce something like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rec_id : 16606003</span><br><span class="line">name : homelab.example.com</span><br><span class="line">display_name : homelab</span><br><span class="line">type : A</span><br><span class="line">ttl : 1</span><br><span class="line">service_mode : 0</span><br></pre></td></tr></table></figure><p>And with that done, you should have everything necessary for the RouterOS script.</p><h2 id="Building-the-Script"><a href="#Building-the-Script" class="headerlink" title="Building the Script"></a>Building the Script</h2><p>I’m not going to go into the <a href="http://wiki.mikrotik.com/wiki/Manual:Scripting" title="RouterOS Scripting Manual" target="_blank" rel="noopener">syntax of ros scripts</a>, but I’ll try to explain the different building block to some degree.</p><h3 id="Defining-our-variables"><a href="#Defining-our-variables" class="headerlink" title="Defining our variables"></a>Defining our variables</h3><p>First, we’ll define out variables used for the script. The global <em>$hostname</em> variable is actually redundant as I could derive the FQDN from  <em>$CFDomain</em> and <em>$CFZone</em>, but it’s used in other scripts in my router so it’s included for that purpose alone.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">######## Set and collect general variables #########</span><br><span class="line">:global hostname &quot;homelab.example.com&quot;</span><br><span class="line">:global resolvedIP &quot;&quot;</span><br><span class="line">:global externalIP &quot;&quot;</span><br><span class="line">:global WANInterface &quot;eth1-ext-internet&quot;</span><br><span class="line"></span><br><span class="line">######## Set CloudFlare variables #################</span><br><span class="line">:local CFemail &quot;&lt;same email as in the powershell script&quot;</span><br><span class="line">:local CFtkn &quot;&lt;your API key/token&gt;&quot;</span><br><span class="line">:local CFzone &quot;example.com&quot;</span><br><span class="line">:local CFid &quot;16606003&quot;</span><br><span class="line">:local CFtype &quot;A&quot;</span><br><span class="line">:local CFttl &quot;1&quot;</span><br><span class="line">:local CFservicemode &quot;0&quot;</span><br><span class="line">:local CFDomain &quot;homelab&quot;</span><br><span class="line">:local CFDebug &quot;true&quot;</span><br></pre></td></tr></table></figure><p>Take care to verify and compare the CFxx variables with the ones used in and received from the previous powershell script, but also the <em>$hostname</em> variable.</p><ul><li>hostname: Used in the script to lookup the currently set IP-address.</li><li>WANInterface: The list name of the external interface, used to find the external IP-address.</li><li>CFemail: Your CloudFlare Login email.</li><li>CFtkn: Your API Key/Token.</li><li>CFzone: Your DNS Zone.</li><li>CFid: The rec_id from the powershell script.</li><li>CFtype: A for IPv4 host records, AAAA for IPv6.</li><li>CFttl: Record time-to-live, use “1” for automatic.</li><li>CFservicemode: Use “0” for direct traffic or “1” to go through their CDN, Optimizations and Security features. I recommend “0” for anything but websites.</li><li>CFDomain: Subdomain or rather hostname for your router.</li><li>CFDebug: Use “True” to print some informational stuff to the router logs.</li></ul><h3 id="Resolve-IP-addresses"><a href="#Resolve-IP-addresses" class="headerlink" title="Resolve IP-addresses"></a>Resolve IP-addresses</h3><p>Next, we resolve two IP-addresses. First one, <em>$externalIP</em>, is the routers current external address. And the second, <em>$resolvedIP</em>, is the address currently set for our <em>$hostname</em>.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">######## Resolve and set IP-variables ##########</span><br><span class="line">:local currentIP [/ip address get [/ip address find interface=$WANInterface ] address];</span><br><span class="line">:set externalIP [:pick $currentIP 0 [:find $currentIP &quot;/&quot;]];</span><br><span class="line">:set resolvedIP [:resolve $hostname];</span><br></pre></td></tr></table></figure><h3 id="Build-CF-API-Request-and-log-debug-info"><a href="#Build-CF-API-Request-and-log-debug-info" class="headerlink" title="Build CF API Request and log debug info"></a>Build CF API Request and log debug info</h3><p>Now, build the URI for the API call from our variables.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">######## Build CF API Url #########################</span><br><span class="line">:local CFurl &quot;https://www.cloudflare.com/api_json.html\3F&quot;</span><br><span class="line">:set CFurl ($CFurl . &quot;a=rec_edit&amp;tkn=$CFtkn&amp;id=$CFid&quot;);</span><br><span class="line">:set CFurl ($CFurl . &quot;&amp;email=$CFemail&amp;z=$CFzone&amp;type=$CFtype&quot;);</span><br><span class="line">:set CFurl ($CFurl . &quot;&amp;name=$CFDomain&amp;service_mode=$CFservicemode&amp;ttl=$CFttl&quot;);</span><br></pre></td></tr></table></figure><p>And if the <em>$CFdebug</em> variable is set to “true”, write a little info to the router log.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">######## Write debug info to log #################</span><br><span class="line">:if ($CFDebug = &quot;true&quot;) do=&#123;</span><br><span class="line">:log info (&quot;CF: hostname = $hostname&quot;)</span><br><span class="line">:log info (&quot;CF: resolvedIP = $resolvedIP&quot;)</span><br><span class="line">:log info (&quot;CF: currentIP = $currentIP&quot;)</span><br><span class="line">:log info (&quot;CF: externalIP = $externalIP&quot;)</span><br><span class="line">:log info (&quot;CF: CFurl = $CFurl&amp;content=$externalIP&quot;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Compare-and-Update"><a href="#Compare-and-Update" class="headerlink" title="Compare and Update"></a>Compare and Update</h3><p>Last step is to compare <em>$externalIP</em> with <em>$resolvedIP</em>. If they don’t match, our external IP-address has been changed and we need to update the DNS record. To execute the HTTP GET request we use a RouterOS tool called <a href="http://wiki.mikrotik.com/wiki/Fetch" title="Mikrotik Manual: Fetch" target="_blank" rel="noopener">fetch</a> to which we pass the <em>$CFurl</em> variable. The reason this will not work before RouterOS v6+ is that before that there was no support for HTTPS, and CloudFlare does not accept unencrypted traffic for their APIs.</p><p>The script block is pretty straight-forward. Compare, update, flush local DNS-cache and write to the log.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">######## Compare and update CF if necessary #####</span><br><span class="line">:if ($resolvedIP != $externalIP) do=&#123;</span><br><span class="line">:log info (&quot;CF: Updating CF, setting $CFDomain = $externalIP&quot;)</span><br><span class="line">/tool fetch mode=https url=&quot;$CFurl&amp;content=$externalIP&quot; keep-result=no</span><br><span class="line">/ip dns cache flush</span><br><span class="line">&#125; else=&#123;</span><br><span class="line">:log info &quot;CF: No Update Needed!&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Permissions-Policies"><a href="#Permissions-Policies" class="headerlink" title="Permissions/Policies"></a>Permissions/Policies</h3><p>This part, I’m not entirely sure on. The script needs to do name resolution, read settings and set variables and it works for me with these policies configured:</p><ul><li>Read</li><li>Write</li><li>Test</li><li>Sniff</li><li>Sensitive</li></ul><p>It might be over-doing it a bit, but I have not had occasion to fiddle with them yet.</p><h3 id="Scheduling"><a href="#Scheduling" class="headerlink" title="Scheduling"></a>Scheduling</h3><p>I have this script scheduled to run once every 20 minutes. As it will only try to update the DNS records if there is a difference between them and the current external IP-address I feel fairly sure that I won’t be tagged as a spammer or something by CloudFlare.</p><p>The schedule is configured with:</p><ul><li>Start Time: startup</li><li>Interval: 00:20:00</li><li>On Event: <code>/system script run &lt;Name of your script&gt;</code></li><li>Policy: Read,Write, Test, Sniff, Sensitive</li></ul><p>This schedule is also a good place for a <a href="http://wiki.mikrotik.com/wiki/Hairpin_NAT" title="Mikrotik Wiki: Hairpin NAT" target="_blank" rel="noopener">hairpin</a> update if it’s needed.</p><h1 id="The-Copy-Paste-part"><a href="#The-Copy-Paste-part" class="headerlink" title="The Copy-Paste part"></a>The Copy-Paste part</h1><p>Now, obviously, at least make sure you proof-read the script before putting it into production. I am not a network dude, and I rarely dabble with ROS scripts. I am certain that anyone with a bit more experience could create a smarter, prettier version of this script, so <strong>use at your own risk</strong>. Anyway, here’s the script in it’s entirety.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">######## Set and collect general variables #########</span><br><span class="line">:global hostname &quot;homelab.example.com&quot;</span><br><span class="line">:global resolvedIP &quot;&quot;</span><br><span class="line">:global externalIP &quot;&quot;</span><br><span class="line">:global WANInterface &quot;eth1-ext-internet&quot;</span><br><span class="line"></span><br><span class="line">######## Set CloudFlare variables #################</span><br><span class="line">:local CFemail &quot;&lt;same email as in the powershell script&quot;</span><br><span class="line">:local CFtkn &quot;&lt;your API key/token&gt;&quot;</span><br><span class="line">:local CFzone &quot;example.com&quot;</span><br><span class="line">:local CFid &quot;16606003&quot;</span><br><span class="line">:local CFtype &quot;A&quot;</span><br><span class="line">:local CFttl &quot;1&quot;</span><br><span class="line">:local CFservicemode &quot;0&quot;</span><br><span class="line">:local CFDomain &quot;homelab&quot;</span><br><span class="line">:local CFDebug &quot;true&quot;</span><br><span class="line"></span><br><span class="line">######## Resolve and set IP-variables ##########</span><br><span class="line">:local currentIP [/ip address get [/ip address find interface=$WANInterface ] address];</span><br><span class="line">:set externalIP [:pick $currentIP 0 [:find $currentIP &quot;/&quot;]];</span><br><span class="line">:set resolvedIP [:resolve $hostname];</span><br><span class="line"></span><br><span class="line">######## Build CF API Url #########################</span><br><span class="line">:local CFurl &quot;https://www.cloudflare.com/api_json.html\3F&quot;</span><br><span class="line">:set CFurl ($CFurl . &quot;a=rec_edit&amp;tkn=$CFtkn&amp;id=$CFid&quot;);</span><br><span class="line">:set CFurl ($CFurl . &quot;&amp;email=$CFemail&amp;z=$CFzone&amp;type=$CFtype&quot;);</span><br><span class="line">:set CFurl ($CFurl . &quot;&amp;name=$CFDomain&amp;service_mode=$CFservicemode&amp;ttl=$CFttl&quot;);</span><br><span class="line"></span><br><span class="line">######## Write debug info to log #################</span><br><span class="line">:if ($CFDebug = &quot;true&quot;) do=&#123;</span><br><span class="line">:log info (&quot;CF: hostname = $hostname&quot;)</span><br><span class="line">:log info (&quot;CF: resolvedIP = $resolvedIP&quot;)</span><br><span class="line">:log info (&quot;CF: currentIP = $currentIP&quot;)</span><br><span class="line">:log info (&quot;CF: externalIP = $externalIP&quot;)</span><br><span class="line">:log info (&quot;CF: CFurl = $CFurl&amp;content=$externalIP&quot;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">######## Compare and update CF if necessary #####</span><br><span class="line">:if ($resolvedIP != $externalIP) do=&#123;</span><br><span class="line">:log info (&quot;CF: Updating CF, setting $CFDomain = $externalIP&quot;)</span><br><span class="line">/tool fetch mode=https url=&quot;$CFurl&amp;content=$externalIP&quot; keep-result=no</span><br><span class="line">/ip dns cache flush</span><br><span class="line">&#125; else=&#123;</span><br><span class="line">:log info &quot;CF: No Update Needed!&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/mikrotik/cloudflare-dynamic-dns-mikrotik/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Quick Demo - Add Windows Performance Collection Rule [#opsmgr, #mpauthoring]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/quick-demo-add-windows-performance-collection-rule-opsmgr-mpauthoring/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/quick-demo-add-windows-performance-collection-rule-opsmgr-mpauthoring/</guid>
      <pubDate>Thu, 21 Feb 2013 08:25:39 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;By request, I uploaded a short clip demonstrating how you would add a windows performance counter to a performance collection rule using 
        
      
      </description>
      
      <content:encoded><![CDATA[<p>By request, I uploaded a short clip demonstrating how you would add a windows performance counter to a performance collection rule using the Authoring Console.</p><p>It is a fairly simple task to complete but does require the <a href="http://www.microsoft.com/en-us/download/details.aspx?id=18222" title="System Center Operations Manager 2007 R2 Authoring Resource Kit" target="_blank" rel="noopener">Authoring Console</a>, obviously, and a better target class than what I use in the demo. The demo also assumes that this counter exist on all the targeted servers in your environment. It would be wise, when making your management pack, to check that it’s there on all targeted operating systems, and that’s what I use Performance Monitor for. (just search for <em>perfmon</em> in your start menu or run perfmon.exe)</p><p>Enjoy.</p><p><a href="http://www.youtube.com/watch?v=4G4aXslrjvQ" target="_blank" rel="noopener"><img src="http://img.youtube.com/vi/4G4aXslrjvQ/0.jpg" alt="IMAGE ALT TEXT HERE"></a></p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/quick-demo-add-windows-performance-collection-rule-opsmgr-mpauthoring/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2012 Agent Failover – A Faster Script with Wildcards [#opsmgr, #powershell]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/</guid>
      <pubDate>Thu, 28 Jun 2012 12:28:36 GMT</pubDate>
      <description>
      
        &lt;p&gt;Now we’re gonna make things even faster! In the &lt;a href=&quot;http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/&quot; title=&quot;OpsMgr 2012 Agent Failover – Simple Script with Wildcards [#opsmgr, #powershell]&quot;&gt;previous post&lt;/a&gt; on the subject of &lt;a href=&quot;http://www.teknoglot.se/series/om2012-failover-mgmt/&quot;&gt;Agent Fail-over in Operations Manager 2012&lt;/a&gt; we created a script that will go through a selection of agents and make sure that they all have up-to-date fail-over settings. We are doing the same thing in this one, but making it go faster. In my lab, it’s about five times faster in fact and I only have about 20 agents to play with. Not really a big deal, but scale it up a bit and add a few thousand agents and the pay-off will be very significant.&lt;/p&gt;
&lt;p&gt;As usual, the script will work as is, but it really is more to show the concept. You would have to add filtering to make sure you don’t mix agents behind gateway servers and agents behind management servers. Giving an agent behind a gateway a management servers as it’s fail-over server will likely not help you in any way.&lt;/p&gt;
&lt;p&gt;We will pretty quickly go “advanced” this time, so buckle up. ;)&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>Now we’re gonna make things even faster! In the <a href="http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/" title="OpsMgr 2012 Agent Failover – Simple Script with Wildcards [#opsmgr, #powershell]">previous post</a> on the subject of <a href="http://www.teknoglot.se/series/om2012-failover-mgmt/">Agent Fail-over in Operations Manager 2012</a> we created a script that will go through a selection of agents and make sure that they all have up-to-date fail-over settings. We are doing the same thing in this one, but making it go faster. In my lab, it’s about five times faster in fact and I only have about 20 agents to play with. Not really a big deal, but scale it up a bit and add a few thousand agents and the pay-off will be very significant.</p><p>As usual, the script will work as is, but it really is more to show the concept. You would have to add filtering to make sure you don’t mix agents behind gateway servers and agents behind management servers. Giving an agent behind a gateway a management servers as it’s fail-over server will likely not help you in any way.</p><p>We will pretty quickly go “advanced” this time, so buckle up. ;)</p><a id="more"></a><p>Being a slight modification of the script in the last post I am not going to go through those details. Use that post if you need references to the Inputs, the OpsMgr 2012 Modules, Management Group connection and gathering your agents and management servers.</p><h3 id="Why-Is-It-Faster"><a href="#Why-Is-It-Faster" class="headerlink" title="Why Is It Faster?"></a>Why Is It Faster?</h3><p>We are doing the same thing, on the same agents and with the same servers. And we already did some optimization by loading them all into memory and working from there. How do you make it faster? Basically, I’m cutting the over-head of the cmdlets and how they work. You may have noticed that in the “Do Stuff” section, we are actually calling the <code>Set-SCOMParentManagementServer</code> cmdlet twice! Once for the primary Management Server and once for the fail-over Management Servers. In effect, we connect, fire a command, wait for result, and disconnect two times for each agent. And pretty much only because the cmdlet does not offer support to set primary and fail-over management servers at the same time. Any attempt to do so will return an ambiguous parameter error.</p><p>I don’t like that. A brief look at the agent object class, <a href="http://msdn.microsoft.com/en-us/library/microsoft.enterprisemanagement.administration.agentmanagedcomputer.aspx" target="_blank" rel="noopener">Microsoft.EnterpriseManagement.Administration.AgentManagedComputer</a>, revealed a method called <a href="http://msdn.microsoft.com/en-us/library/microsoft.enterprisemanagement.administration.agentmanagedcomputer.setmanagementservers" title="AgentManagedComputer.SetManagementServers Method" target="_blank" rel="noopener">SetManagementServers</a>. This method takes, or actually “requires”, two parameters. One for primary and one for fail-over management servers. Yay!</p><p>Using this method saves us a bunch of over-head and a couple of round-trips to the SDK-service.</p><h3 id="The-Challenge"><a href="#The-Challenge" class="headerlink" title="The Challenge"></a>The Challenge</h3><p>Unfortunately, you cannot simply toss an array of management servers at the SetManagementServers method. With a bit of knowledge or keen eyes you will spot the problem right away. I didn’t and was pulling my hair for a while until I realized what caused the errors. Looking closer at how the method is defined we see this:</p><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetManagementServers</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"> ManagementServer managementServer,</span></span></span><br><span class="line"><span class="function"><span class="params"> IList failoverManagementServers</span></span></span><br><span class="line"><span class="function"><span class="params"> </span>)</span></span><br></pre></td></tr></table></figure><p>You see that <code>IList&lt;ManagementServer&gt;</code> part?<br>That’s the problem. When you run <code>Get-SCOMManagementServer</code> and save the result to a powershell variable, you will get a powershell “Enumerable”. In C#, that would be a class that implements the <code>IEnumerable</code> interface. Sad part is, it does not also implement <code>IList</code>. If you are thinking “IList… IEnumerable… Interface… Whaaaaa…???” right now, don’t worry. You don’t have to understand this to read the script later on, just think of it as different types of data.</p><p>To get around this, we create a new object based on the dotNET List type and populate it with the management servers in our $scomFailOverMS array.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$scomMSList</span> = <span class="built_in">New-Object</span> <span class="string">'Collections.Generic.List[Microsoft.EnterpriseManagement.Administration.ManagementServer]'</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$scomMS</span> <span class="keyword">in</span> <span class="variable">$scomFailOverMS</span>) &#123;</span><br><span class="line"> <span class="comment"># Loop through the array and add your failover MSs to the list</span></span><br><span class="line"> <span class="variable">$scomMSList</span>.Add(<span class="variable">$scomMS</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Note:We have to do that foreach loop since our $scomMSList object do not implement IEnumerable<br>Still with me?</p></blockquote><h3 id="Configuring-the-Agent"><a href="#Configuring-the-Agent" class="headerlink" title="Configuring the Agent"></a>Configuring the Agent</h3><p>As the method exist on that <code>AgentManagedComputer</code> class we will call it on our <code>$scomAgent</code> object, like this:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$scomAgent</span>.SetManagementServers(<span class="variable">$scomPrimaryMS</span>,<span class="variable">$scomMSList</span>)</span><br></pre></td></tr></table></figure><p>And we’re done!</p><p>I had some doubt that this would be an improvement at first since we have to create our own objects and run an extra foreach-loop, but as we only work on objects in memory and only speak to the SDK service once per agent, we cut a lot of over-head and delays from our execution. On 20-ish agents in a lab, I’ve measured the execution time drop to barely a fifth.</p><h3 id="The-Copy-Paste-Part"><a href="#The-Copy-Paste-Part" class="headerlink" title="The Copy/Paste Part"></a>The Copy/Paste Part</h3><p>And here’s the entire script with a few added comments for clarity. Read, adapt and try it. In a lab, preferably.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Input SCOM Management Server to connect to in this session</span></span><br><span class="line">[string]<span class="variable">$inputScomMS</span> = <span class="string">"scomms02.domain.local"</span></span><br><span class="line"><span class="comment"># Input an existing agent you want to modify</span></span><br><span class="line">[string]<span class="variable">$inputTargetAgent</span> = <span class="string">"*.domain.local"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Connect to SCOM 2012 Management Group ###</span></span><br><span class="line"><span class="keyword">If</span> (<span class="built_in">Get-Module</span> -Name <span class="string">"OperationsManager"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">Import-Module</span> -Name <span class="string">"OperationsManager"</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        echo <span class="string">"Could not load Operations Manager module"</span></span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">New-SCOMManagementGroupConnection -ComputerName <span class="variable">$inputScomMS</span></span><br><span class="line"><span class="comment">### END ###</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$scomAgents</span> = Get-SCOMAgent -DNSHostName <span class="variable">$inputTargetAgent</span> | Where &#123;<span class="variable">$_</span>.ManuallyInstalled <span class="nomarkup">-ne</span> <span class="literal">$true</span>&#125;</span><br><span class="line"><span class="comment"># Get all of the management servers</span></span><br><span class="line"><span class="comment"># It is ofcourse possible to search by hostname and wildcards using selected</span></span><br><span class="line"><span class="comment"># parameters to the cmdlet.</span></span><br><span class="line"><span class="variable">$scomManagementServers</span> = Get-SCOMManagementServer</span><br><span class="line"><span class="comment"># Switch to the following line to only get Gateway Servers</span></span><br><span class="line"><span class="comment">#$scomManagementServers = Get-SCOMGatewayManagementServer</span></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$scomAgent</span> <span class="keyword">in</span> <span class="variable">$scomAgents</span>) &#123;</span><br><span class="line">    <span class="comment"># Get the primary management server for the agent</span></span><br><span class="line">    <span class="variable">$scomPrimaryMS</span> = <span class="variable">$scomManagementServers</span> | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$scomAgent</span>.PrimaryManagementServerName&#125;</span><br><span class="line">    <span class="comment"># Remove the primary MS from "all MS" array to use it for FailOver servers</span></span><br><span class="line">    <span class="variable">$scomFailOverMS</span> = <span class="variable">$scomManagementServers</span> | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-ne</span> <span class="variable">$scomPrimaryMS</span>.Name&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create a new IList derived object for the failover MSs</span></span><br><span class="line">    <span class="comment"># You have to do this because the SetManagementServers() method requires an</span></span><br><span class="line">    <span class="comment"># IList and the MS-array is an IEnumerable type. So we basically create</span></span><br><span class="line">    <span class="comment"># a new IList object och the ManagementServer type.</span></span><br><span class="line">    <span class="variable">$scomMSList</span> = <span class="built_in">New-Object</span> <span class="string">'Collections.Generic.List[Microsoft.EnterpriseManagement.Administration.ManagementServer]'</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$scomMS</span> <span class="keyword">in</span> <span class="variable">$scomFailOverMS</span>) &#123;</span><br><span class="line">        <span class="comment"># Loop through the array and add your failover MSs to the list</span></span><br><span class="line">        <span class="variable">$scomMSList</span>.Add(<span class="variable">$scomMS</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$scomAgent</span>.SetManagementServers(<span class="variable">$scomPrimaryMS</span>, <span class="variable">$scomMSList</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>GLHF!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-a-faster-script-with-wildcards-opsmgr-powershell/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2012 Agent Failover - Simple Script with Wildcards [#opsmgr, #powershell]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/</guid>
      <pubDate>Thu, 21 Jun 2012 08:58:13 GMT</pubDate>
      <description>
      
        &lt;p&gt;In the last post, &lt;a href=&quot;http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-gateway-failover-the-basics/&quot; title=&quot;OpsMgr 2012 Agent &amp;amp; Gateway Failover – The Basics [#opsmgr, #powershell]&quot;&gt;OpsMgr 2012 Agent &amp;amp; Gateway Failover – The Basics&lt;/a&gt;, we looked at the basics of the Agent and Gateway fail-over configuration cmdlets and how to use them in a direct and interactive setting. This is absolutely useful when you got this specific agent that you need to configure with a specific fail-over management server.&lt;/p&gt;
&lt;p&gt;To spice it up a little, we are going to add a little intelligence to it and enable wild-card selections while at it. The scenario we are building this script for is that now and then you want to make sure that certain agents have fail-over management servers configured. You also want to make sure that all management servers that are not the primary management server of any selected agent will be in that list of fail-over servers. This would include any new management servers as well as exclude any removed ones. In short, make sure your agent fail-over settings are up-to-date with the current environment.&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>In the last post, <a href="http://www.teknoglot.se/code/powershell/opsmgr-2012-agent-gateway-failover-the-basics/" title="OpsMgr 2012 Agent &amp; Gateway Failover – The Basics [#opsmgr, #powershell]">OpsMgr 2012 Agent &amp; Gateway Failover – The Basics</a>, we looked at the basics of the Agent and Gateway fail-over configuration cmdlets and how to use them in a direct and interactive setting. This is absolutely useful when you got this specific agent that you need to configure with a specific fail-over management server.</p><p>To spice it up a little, we are going to add a little intelligence to it and enable wild-card selections while at it. The scenario we are building this script for is that now and then you want to make sure that certain agents have fail-over management servers configured. You also want to make sure that all management servers that are not the primary management server of any selected agent will be in that list of fail-over servers. This would include any new management servers as well as exclude any removed ones. In short, make sure your agent fail-over settings are up-to-date with the current environment.</p><a id="more"></a><h3 id="Inputs"><a href="#Inputs" class="headerlink" title="Inputs"></a>Inputs</h3><p>To use this script you need to know which management server you should connect your powershell session to and which agent, or agents, you want to check and configure.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Input SCOM Management Server to connect to in this session</span></span><br><span class="line">[string]<span class="variable">$inputScomMS</span> = <span class="string">"scomms01.domain.local"</span></span><br><span class="line"><span class="comment"># Input an existing agent you want to modify</span></span><br><span class="line">[string]<span class="variable">$inputTargetAgent</span> = <span class="string">"*.domain.local"</span></span><br></pre></td></tr></table></figure><blockquote><p>Note: If you are using load-balanced SDK-services, or “Data Access Services”, pointing <code>$inputScomMS</code> to that virtual host-name will work perfectly fine.<br>This example uses a wild-card for the agent selection and I guess it’s the most likely scenario for this script, but a single host-name obviously works fine as well. Supported wildcard selections are <a href="http://technet.microsoft.com/en-us/library/ee692793.aspx" target="_blank" rel="noopener">documented at TechNet</a>. An array of computer-names or a comma-separated list, however, will not work. You could easily add that functionality but it’s out of scope for this example.</p></blockquote><h3 id="Connect-to-Your-Management-Group"><a href="#Connect-to-Your-Management-Group" class="headerlink" title="Connect to Your Management Group"></a>Connect to Your Management Group</h3><p>To run any script against an Operations Manager 2012 Management Group we need a connection to one. To connect to a management group we have to load the OperationsManager module. Lets check for a loaded module, load it if necessary and connect to the Management Server from the <code>$inputScomMS</code> setting. If loading the module fails–maybe it is not installed–we will exit the script.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Check if OperationsManager module is loaded</span></span><br><span class="line"><span class="keyword">If</span> (<span class="built_in">Get-Module</span> -Name <span class="string">"OperationsManager"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># Try to load the module</span></span><br><span class="line">        <span class="built_in">Import-Module</span> -Name <span class="string">"OperationsManager"</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="comment"># Did not work, exit the script</span></span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">"Could not load Operations Manager module"</span></span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Module is loaded, connect to Management Group/Server</span></span><br><span class="line">New-SCOMManagementGroupConnection -ComputerName <span class="variable">$inputScomMS</span></span><br></pre></td></tr></table></figure><p>A good idea would, of course, be to first check if we already have an existing management group connection before creating a new one. But that’s up to you.</p><h3 id="Rally-Your-Agents-and-Management-Servers"><a href="#Rally-Your-Agents-and-Management-Servers" class="headerlink" title="Rally Your Agents (and Management Servers)"></a>Rally Your Agents (and Management Servers)</h3><p>Since we cannot manage manually installed agents–that would be AD-integrated or installed locally using Configuration Manager or maybe the wizard–through powershell we don’t even want to try. So we’ll exclude them.</p><p>We also need all the available management servers. <del>This will not handle Gateway servers as they have their own cmdlet, <code>Get-SCOMGatewayManagementServer</code>, in Operations Manager 2012.</del> Strike that! There is a specific cmdlet for Gateway Servers in OpsMgr 2012, but the regular <code>Get-SCOMManagementServer</code> actually don’t care whether it’s a normal Management Server or a Gateway Server. The <code>Get-SCOMGatewayManagementServer</code>, however, only return real Gateway Servers. That means that this script will not care if it is a Management Server or a Gateway Server, so be sure to add some kind of filtering before running it in a Management Group containing management servers.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Select matching remotely manageable agents</span></span><br><span class="line"><span class="variable">$scomAgents</span> = Get-SCOMAgent -DNSHostName <span class="variable">$inputTargetAgent</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.ManuallyInstalled <span class="nomarkup">-ne</span> <span class="literal">$true</span>&#125;</span><br><span class="line"><span class="comment"># Get all management servers</span></span><br><span class="line"><span class="variable">$scomManagementServers</span> = Get-SCOMManagementServer</span><br></pre></td></tr></table></figure><p>The reason I like to store all matching agents in a variable is that we will save ourselves a lot of trips to the Data Access Service later on, and we also get a nice collection to run our foreach-loop on. This method is much faster than running <code>Get-SCOMAgent</code> inline as we did in “The Basics”.</p><blockquote><p>Note: It would probably be a good idea to check that <code>$scomAgents</code> actually contains anything; checking for <code>$null</code> with a simple <code>if()</code>would be enough.</p></blockquote><h3 id="Do-Stuff"><a href="#Do-Stuff" class="headerlink" title="Do Stuff"></a>Do Stuff</h3><p>We have our connection to the management group, we have collected our agents, and we have our management servers. It’s time to loop through the agents and set their Primary and Fail-over management servers.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$scomAgent</span> <span class="keyword">in</span> <span class="variable">$scomAgents</span>) &#123;</span><br><span class="line">    <span class="comment"># Get the primary management server for the agent</span></span><br><span class="line">    <span class="variable">$scomPrimaryMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$scomAgent</span>.PrimaryManagementServerName&#125;</span><br><span class="line">    <span class="comment"># Remove the primary MS from "all MS" array to use it for FailOver servers</span></span><br><span class="line">    <span class="variable">$scomFailOverMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-ne</span> <span class="variable">$scomPrimaryMS</span>.Name&#125;</span><br><span class="line">    <span class="comment"># Set Primary Management Server</span></span><br><span class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -PrimaryServer <span class="variable">$scomPrimaryMS</span></span><br><span class="line">    <span class="comment"># Set Fail-over Management Server</span></span><br><span class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -FailoverServer <span class="variable">$scomFailOverMS</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The nice thing about loading the agents and the management servers into variables is that all the information you need for this script is pre-cached in memory. You don’t have to connect to the management group to find out which management server happens is the primary for each agent. And you don’t have to run <code>Get-SCOMManagementServer</code> for each agent to select which ones that will be fail-over management servers. All that information is in memory, and memory is fast.</p><h3 id="The-Copy-Paste-Part"><a href="#The-Copy-Paste-Part" class="headerlink" title="The Copy/Paste Part"></a>The Copy/Paste Part</h3><p>As usual, here’s the entire script for you to copy. Read it, try it, adapt it…</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Input SCOM Management Server to connect to in this session</span></span><br><span class="line">[string]<span class="variable">$inputScomMS</span> = <span class="string">"scomms02.domain.local"</span></span><br><span class="line"><span class="comment"># Input an existing agent you want to modify</span></span><br><span class="line">[string]<span class="variable">$inputTargetAgent</span> = <span class="string">"*.domain.local"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Connect to SCOM 2012 Management Group ###</span></span><br><span class="line"><span class="comment"># Check if OperationsManager module is loaded</span></span><br><span class="line"><span class="keyword">If</span> (<span class="built_in">Get-Module</span> -Name <span class="string">"OperationsManager"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment"># Try to load the module</span></span><br><span class="line">        <span class="built_in">Import-Module</span> -Name <span class="string">"OperationsManager"</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="comment"># Did not work, exit the script</span></span><br><span class="line">        <span class="built_in">Write-Output</span> <span class="string">"Could not load Operations Manager module"</span></span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Module is loaded, connect to Management Group/Server</span></span><br><span class="line">New-SCOMManagementGroupConnection -ComputerName <span class="variable">$inputScomMS</span></span><br><span class="line"><span class="comment">### END ###</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Select matching remotely manageable agents</span></span><br><span class="line"><span class="variable">$scomAgents</span> = Get-SCOMAgent -DNSHostName <span class="variable">$inputTargetAgent</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.ManuallyInstalled <span class="nomarkup">-ne</span> <span class="literal">$true</span>&#125;</span><br><span class="line"><span class="comment"># Get all management servers</span></span><br><span class="line"><span class="variable">$scomManagementServers</span> = Get-SCOMManagementServer</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$scomAgent</span> <span class="keyword">in</span> <span class="variable">$scomAgents</span>) &#123;</span><br><span class="line">    <span class="comment"># Get the primary management server for the agent</span></span><br><span class="line">    <span class="variable">$scomPrimaryMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$scomAgent</span>.PrimaryManagementServerName&#125;</span><br><span class="line">    <span class="comment"># Remove the primary MS from "all MS" array to use it for FailOver servers</span></span><br><span class="line">    <span class="variable">$scomFailOverMS</span> = <span class="variable">$scomManagementServers</span> | <span class="built_in">Where-Object</span> &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-ne</span> <span class="variable">$scomPrimaryMS</span>.Name&#125;</span><br><span class="line">    <span class="comment"># Set Primary Management Server</span></span><br><span class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -PrimaryServer <span class="variable">$scomPrimaryMS</span></span><br><span class="line">    <span class="comment"># Set Fail-over Management Server</span></span><br><span class="line">    Set-SCOMParentManagementServer -Agent <span class="variable">$scomAgent</span> -FailoverServer <span class="variable">$scomFailOverMS</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">### Done!</span></span><br></pre></td></tr></table></figure><p>GLHF!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-failover-simple-script-with-wildcards-opsmgr-powershell/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Menu Problems!</title>
      <link>https://www.teknoglot.se/tb/menu-problems/</link>
      <guid>https://www.teknoglot.se/tb/menu-problems/</guid>
      <pubDate>Thu, 21 Jun 2012 06:01:50 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;The menus are looking a bit off as you may have noticed.&lt;/p&gt;
&lt;p&gt;I guess it’s an issue with WordPress 3.4 and &lt;a href=&quot;http://users.tpg.co
        
      
      </description>
      
      <content:encoded><![CDATA[<p>The menus are looking a bit off as you may have noticed.</p><p>I guess it’s an issue with WordPress 3.4 and <a href="http://users.tpg.com.au/j_birch/plugins/superfish/" title="Superfish" target="_blank" rel="noopener">Superfish</a> and are trying to figure out where it goes haywire.</p><p>Sorry for the inconvenience.</p><h1 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h1><p>I switched the theme to at least get the navigation working while I try to figure out what the problem with the regular theme is.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/menu-problems/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2012 Agent &amp; Gateway Failover - The Basics [#opsmgr, #powershell]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-gateway-failover-the-basics/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-gateway-failover-the-basics/</guid>
      <pubDate>Wed, 30 May 2012 12:12:37 GMT</pubDate>
      <description>
      
        &lt;p&gt;I have &lt;a href=&quot;http://www.teknoglot.se/ms/opsmgr2007/replacechange-a-gateway-server/&quot; title=&quot;Replace/Change a Gateway Server&quot;&gt;previously&lt;/a&gt; posted a few &lt;a href=&quot;http://www.teknoglot.se/ms/opsmgr2007/change-gateway-powershell-script/&quot; title=&quot;Change Gateway Powershell Script&quot;&gt;scripts&lt;/a&gt; on managing and &lt;a href=&quot;http://www.teknoglot.se/ms/opsmgr2007/loadbalancing-ps-script-opsmgr/&quot; title=&quot;“Load Balancing” Powershell Script for Operations Manager&quot;&gt;configuring fail-over&lt;/a&gt; management servers on gateways and agents in System Center Operations Manager 2007 R2.&lt;/p&gt;
&lt;p&gt;Now that System Center 2012 Operations Manager is RTM and users are starting to explore the differences between the versions I see more and more questions on how you do, in OpsMgr 2012, what you did in OpsMgr 2007. In a few posts henceforth I will go through Agent and Gateway server fail-over configuration and management. In this first post I’ll look at the very basics of fail-over configuration, the cmdlets to use and some one-liners.&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>I have <a href="http://www.teknoglot.se/ms/opsmgr2007/replacechange-a-gateway-server/" title="Replace/Change a Gateway Server">previously</a> posted a few <a href="http://www.teknoglot.se/ms/opsmgr2007/change-gateway-powershell-script/" title="Change Gateway Powershell Script">scripts</a> on managing and <a href="http://www.teknoglot.se/ms/opsmgr2007/loadbalancing-ps-script-opsmgr/" title="“Load Balancing” Powershell Script for Operations Manager">configuring fail-over</a> management servers on gateways and agents in System Center Operations Manager 2007 R2.</p><p>Now that System Center 2012 Operations Manager is RTM and users are starting to explore the differences between the versions I see more and more questions on how you do, in OpsMgr 2012, what you did in OpsMgr 2007. In a few posts henceforth I will go through Agent and Gateway server fail-over configuration and management. In this first post I’ll look at the very basics of fail-over configuration, the cmdlets to use and some one-liners.</p><a id="more"></a><h3 id="The-cmdlet"><a href="#The-cmdlet" class="headerlink" title="The cmdlet"></a>The cmdlet</h3><p>First of all, the cmdlets of OpsMgr powershell have all got new names looking like <em>Verb</em>-SCOM<em>noun</em> and to list them all in the console you can execute the following command:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">get-command</span> *SCOM*</span><br></pre></td></tr></table></figure><p>The cmdlet we are looking for to set and manage primary and fail-over management servers is</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Get-SCOMParentManagementServer</span><br></pre></td></tr></table></figure><p>As usual, you can pass the cmdlet as a parameter to get-help for information about its parameters and a few use-cases.</p><blockquote><p><strong>SYNOPSIS</strong></p><p>Changes the primary and failover management servers for an agent or gateway management server.</p><p><strong>SYNTAX</strong></p><p>Set-SCOMParentManagementServer -Agent -PrimaryServer [-PassThru ] [-Confirm ] [-WhatIf ] []</p><p>Set-SCOMParentManagementServer -Agent -FailoverServer [-PassThru ] [-Confirm ] [-WhatIf ] []</p><p>Set-SCOMParentManagementServer -GatewayServer -FailoverServer [-PassThru ] [-Confirm ] [-WhatIf ] []</p><p>Set-SCOMParentManagementServer -GatewayServer -PrimaryServer [-PassThru] [-Confirm] [-WhatIf] []<br>But that’s so boring to read the manual is a bit sketchy on how it behaves and the limitations.</p></blockquote><h4 id="The-One-Liners"><a href="#The-One-Liners" class="headerlink" title="The One-Liners!"></a>The One-Liners!</h4><p>I have compiled a few examples for a few common tasks to better illustrate it’s uses.</p><h5 id="Set-Primary-Management-Server-on-Agent"><a href="#Set-Primary-Management-Server-on-Agent" class="headerlink" title="Set Primary Management Server on Agent"></a>Set Primary Management Server on Agent</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Set Primary Management Server on Agent</span></span><br><span class="line">Set-SCOMParentManagementServer -Agent (Get-SCOMAgent -DNSHostName <span class="string">"AGENT.domain.local"</span>) -PrimaryServer (Get-SCOMManagementServer -Name <span class="string">"SCOMMS01.domain.local"</span>)</span><br></pre></td></tr></table></figure><h5 id="Set-Fail-over-Management-Server-on-Agent"><a href="#Set-Fail-over-Management-Server-on-Agent" class="headerlink" title="Set Fail-over Management Server on Agent"></a>Set Fail-over Management Server on Agent</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Set Fail-over Management Server on Agent</span></span><br><span class="line">Set-SCOMParentManagementServer -Agent (Get-SCOMAgent -DNSHostName <span class="string">"AGENT.domain.local"</span>) -FailoverServer (Get-SCOMManagementServer -Name <span class="string">"SCOMMS02.domain.local"</span>)</span><br></pre></td></tr></table></figure><h5 id="Set-Primary-Management-Server-on-Gateway"><a href="#Set-Primary-Management-Server-on-Gateway" class="headerlink" title="Set Primary Management Server on Gateway"></a>Set Primary Management Server on Gateway</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Set Primary Management Server on Gateway</span></span><br><span class="line">Set-SCOMParentManagementServer -GatewayServer (Get-SCOMGatewayManagementServer -Name <span class="string">"SCOMGW01.domain.local"</span>) -PrimaryServer (Get-SCOMManagementServer -Name <span class="string">"SCOMMS01.domain.local"</span>)</span><br></pre></td></tr></table></figure><h5 id="Set-Fail-over-Management-Server-on-Gateway"><a href="#Set-Fail-over-Management-Server-on-Gateway" class="headerlink" title="Set Fail-over Management Server on Gateway"></a>Set Fail-over Management Server on Gateway</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Set Fail-over Management Server on Gateway</span></span><br><span class="line">Set-SCOMParentManagementServer -GatewayServer (Get-SCOMGatewayManagementServer -Name <span class="string">"SCOMGW01.domain.local"</span>) -FailoverServer (Get-SCOMManagementServer -Name <span class="string">"SCOMMS02.domain.local"</span>)</span><br></pre></td></tr></table></figure><h4 id="A-few-reflections"><a href="#A-few-reflections" class="headerlink" title="A few reflections"></a>A few reflections</h4><p>As you may notice, if you have used the OpsMgr 2007 <code>Set-ManagementServer</code> cmdlet you actually have to use separate parameters depending on whether you are configuring management servers on an agent or a gateway server. You probably also noticed that to get an object for a gateway server you also have to use <code>Get-SCOMGatewayManagementServer</code> in OpsMgr 2012.</p><p>For some reason, there’s different properties on agent objects compared to management and gateway servers. On an MS or GW, you use <code>-Name</code> to select by name, while on an agent you have to use <code>-DNSHostName</code>. Both of these parameters take wild-cards making it possible to find all the agents named “*.domain.local”.</p><p>While <code>-PrimaryServer</code> only takes a single object the <code>-Agent</code>, <code>-GatewayServer</code> and <code>-FailoverServer</code> can take an array or collection of objects.</p><p>One more “gotcha” I ran into is the fact that trying to set both<code>-PrimaryServer</code> and <code>-FailoverServer</code> in the same command will fail with an “AmbiguousParameterSet” error. You have to run it once for the Primary Management Server and once for your Fail-over Management Servers.</p><h3 id="Related-Snippets"><a href="#Related-Snippets" class="headerlink" title="Related Snippets"></a>Related Snippets</h3><p>Apart from setting your management servers you might also want to read your agent’s current configuration as well.</p><h5 id="Get-current-Primary-Management-Server-on-Agent"><a href="#Get-current-Primary-Management-Server-on-Agent" class="headerlink" title="Get current Primary Management Server on Agent"></a>Get current Primary Management Server on Agent</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Get current Primary MS on Agent</span></span><br><span class="line"><span class="variable">$agent</span> = Get-SCOMAgent -DNSHostName <span class="string">"AGENT.domain.local"</span></span><br><span class="line"><span class="variable">$primaryMS</span> = <span class="variable">$agent</span>.GetPrimaryManagementServer()</span><br><span class="line"><span class="built_in">write-host</span> <span class="string">"Current Primary ManagementServer: "</span><span class="variable">$primaryMS</span>.Name</span><br></pre></td></tr></table></figure><h5 id="Get-current-Failover-Management-Server-on-Agent"><a href="#Get-current-Failover-Management-Server-on-Agent" class="headerlink" title="Get current Failover Management Server on Agent"></a>Get current Failover Management Server on Agent</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Get current Failover MS on Agent</span></span><br><span class="line"><span class="variable">$agent</span> = Get-SCOMAgent -DNSHostName <span class="string">"AGENT.domain.local"</span></span><br><span class="line"><span class="variable">$failoverMSs</span> = <span class="variable">$agent</span>.GetFailoverManagementServers()</span><br><span class="line"><span class="built_in">write-host</span> <span class="string">"Got"</span><span class="variable">$failoverMSs</span>.Count<span class="string">"failover Management Servers"</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$failoverMS</span> <span class="keyword">in</span> <span class="variable">$failoverMSs</span>) &#123;</span><br><span class="line"> <span class="variable">$failoverMS</span>.Name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>I think that would be all for this post. Next one will touch on a little more intelligence and a few ways to automatically select “other” management servers as fail-over management servers.</p><p>Enjoy!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/opsmgr-2012-agent-gateway-failover-the-basics/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Load-balanced SCOM2012 SDK Services for Network Illiterates [#opsmgr, #nlb]</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/load-balanced-scom2012-sdk-services-for-network-illiterates-opsmgr-nlb/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/load-balanced-scom2012-sdk-services-for-network-illiterates-opsmgr-nlb/</guid>
      <pubDate>Fri, 18 May 2012 11:16:51 GMT</pubDate>
      <description>
      
        &lt;h1 id=&quot;Prelude&quot;&gt;&lt;a href=&quot;#Prelude&quot; class=&quot;headerlink&quot; title=&quot;Prelude&quot;&gt;&lt;/a&gt;Prelude&lt;/h1&gt;&lt;p&gt;Now that System Center Operations Manager no longer has that pesky Root Management Server role; a server role that in larger environments quickly became the choking point and made creating a fully Highly Available SCOM-environment both complex and frustrating to support and with little gain at that. With that gone and the SDK Service, or Data Access Service, thriving on all the Management Servers HA suddenly became pretty simple. All you have to do in SCOM2012 to make sure your management groups keep on kicking is to have at-least two Management Servers and your databases clustered.&lt;/p&gt;
&lt;p&gt;This new distributed architecture does not only give easy HA, it also makes it possible to connect to the SDK-service—be it using the Operations Console or powershell to name two options—on &lt;em&gt;any&lt;/em&gt; Management Server. This, in turn, provides for a completely new level of scalability. Choked on sessions? Deploy a new Management Server!&lt;/p&gt;
&lt;p&gt;Anyway… given all this scalability and HA, would it not be nice if you could load-balance all these SDK-sessions you will be running from System Center Virtual Machine Manager, System Center Service Manager, System Center Orchestrator, regular scheduled powershell scripts and what-not?&lt;/p&gt;
&lt;p&gt;Of course it would! And you can! The simple solution is to use the built-in Network Load Balancer (NLB for short) feature in Windows Server and that’s what we’re going to discuss in this post.&lt;br&gt;Before we go, I’d like to point to a &lt;a href=&quot;http://systemcentertech.com/2012/02/07/load-balance-scom-2012-operations-console-connections/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;great article&lt;/a&gt; written by &lt;a href=&quot;http://systemcentertech.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Justin Cook&lt;/a&gt; that is covering most bases but in a less for-dummies way. So, yeah… I suppose this is the for-dummies version then. ;)&lt;/p&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Prelude"><a href="#Prelude" class="headerlink" title="Prelude"></a>Prelude</h1><p>Now that System Center Operations Manager no longer has that pesky Root Management Server role; a server role that in larger environments quickly became the choking point and made creating a fully Highly Available SCOM-environment both complex and frustrating to support and with little gain at that. With that gone and the SDK Service, or Data Access Service, thriving on all the Management Servers HA suddenly became pretty simple. All you have to do in SCOM2012 to make sure your management groups keep on kicking is to have at-least two Management Servers and your databases clustered.</p><p>This new distributed architecture does not only give easy HA, it also makes it possible to connect to the SDK-service—be it using the Operations Console or powershell to name two options—on <em>any</em> Management Server. This, in turn, provides for a completely new level of scalability. Choked on sessions? Deploy a new Management Server!</p><p>Anyway… given all this scalability and HA, would it not be nice if you could load-balance all these SDK-sessions you will be running from System Center Virtual Machine Manager, System Center Service Manager, System Center Orchestrator, regular scheduled powershell scripts and what-not?</p><p>Of course it would! And you can! The simple solution is to use the built-in Network Load Balancer (NLB for short) feature in Windows Server and that’s what we’re going to discuss in this post.<br>Before we go, I’d like to point to a <a href="http://systemcentertech.com/2012/02/07/load-balance-scom-2012-operations-console-connections/" target="_blank" rel="noopener">great article</a> written by <a href="http://systemcentertech.com/" target="_blank" rel="noopener">Justin Cook</a> that is covering most bases but in a less for-dummies way. So, yeah… I suppose this is the for-dummies version then. ;)</p><p>Enjoy!</p><a id="more"></a><h1 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h1><p>We need to have the Network Load Balancing feature installed on all our targeted Management servers. The quick way to do this is using command-line (Windows Server 2008 R2 or later?).</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dism /online /enable-feature /featurename:NetworkLoadBalancingFullServer</span><br></pre></td></tr></table></figure><p>You also need a plan and some information about your new cluster. Make sure you have identified the following parameters before starting the configuration:</p><p><div></div></p><p><table style="border-collapse: collapse;" border="0"><colgroup> <col style="width: 307px;"> <col style="width: 307px;"></colgroup></table></p><p><tbody valign="top"></tbody></p><p><tr></tr></p><p><td style="padding-left: 7px; padding-right: 7px; border: solid 0.5pt;">A Dedicated Cluster IP-Address:</td></p><p><td style="padding-left: 7px; padding-right: 7px; border-top: solid 0.5pt; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;"></td><br></p><p><tr></tr></p><p><td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">A Dedicated Cluster DNS Name:</td></p><p><td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;"></td><br></p><p><tr></tr></p><p><td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">A list of SCOM2012 Management Servers:</td></p><p><td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;"></td><br><br><br><br><br>You can use this pre-flight table to take note of your IP-address, DNS Name and Server List.</p><h1 id="Create-a-New-Cluster"><a href="#Create-a-New-Cluster" class="headerlink" title="Create a New Cluster"></a>Create a New Cluster</h1><p>Open the Network Load Balancing Manager and create a new cluster.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance1.png" alt=""></p><p>In the “New Cluster” dialogue, connect to one of your Management Servers.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance2.png" alt=""></p><ol><li>Enter the name of a management server</li><li>Click Connect</li><li>Select the network interface to use</li><li>Click Next</li></ol><p>Select the settings on your first host in the cluster.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance3.png" alt=""></p><ol><li>Make sure it’s the correct IP-address.</li><li>Click Next</li></ol><p>Set the Cluster IP-address.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance4.png" alt=""></p><ol><li>Click Add</li><li>Enter your Dedicated Cluster IP-Address and Subnet mask</li><li>Click OK</li><li>Click Next</li></ol><p>If need additional IP-addresses, like an IPv6 address, you simply repeat step 1-3 before proceeding to step 4.</p><p>Edit DNS Names and Cluster Operation Mode.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance5.png" alt=""></p><ol><li>Select your Dedicated Cluster IP-address</li><li>Enter your chosen Dedicated Cluster DNS Name</li><li>Select Multicast mode</li><li>Click Next</li></ol><blockquote><p>Note: We are not going to delve into the Cluster Operation Mode in this guide, but this is what I use for Operations Manager 2012.</p><p>If you want to learn more about these settings, here’s the KB on the various settings: <a href="http://support.microsoft.com/kb/323437" target="_blank" rel="noopener">http://support.microsoft.com/kb/323437</a><br>Set your Port Rules and Affinity Settings.</p></blockquote><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance6.png" alt=""></p><ol><li>Verify that Affinity is set to “Single”. If not, Click “Edit…” and adjust.</li><li>Click Finish</li></ol><blockquote><p>Note: “Single” affinity tells the cluster to always direct the same client to the same host if possible. This is required to be able to support sessions.</p><p>In the world of NLB, a “client” is an IP-address.</p></blockquote><h2 id="Post-Configuration"><a href="#Post-Configuration" class="headerlink" title="Post-Configuration"></a>Post-Configuration</h2><p>Now that you have a cluster configured you have to make sure your SDK-clients are able to resolve the dedicated cluster DNS-name. The one you picked in the pre-flight table.</p><p>To enable name resolution you have to add your cluster DNS-name to your DNS-zone and point it to your dedicated cluster IP-address. Make it an A-record and it should work.</p><p>If you intend to use the cluster name from outside the local network or subnet—Operation Consoles or Powershell sessions for example—you would also need to verify that the router is able to handle the multicast packages. I am by no means a network guy, but asking the person behind that “Don’t blame the network” sign to help you access a NLB cluster on network _X _from network <em>Y</em> usually works. One way to troubleshoot this is to ping the cluster DNS-name from one of the hosts. If that works but you are still unable to ping from another network or subnet, then it might be a router setting.</p><!--more--><h1 id="Adding-Hosts-to-the-Cluster"><a href="#Adding-Hosts-to-the-Cluster" class="headerlink" title="Adding Hosts to the Cluster"></a>Adding Hosts to the Cluster</h1><p>With the cluster configured and up-and-running you need to add the rest of the Management Servers. Repeat this section for each Management Server you wish to add to the load-balancing cluster.</p><p>In the Network Load Balancing Manager, right-click your cluster and select “Add Host To Cluster”.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance7.png" alt=""></p><p>Connect to your next Management Server to be added</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance8.png" alt=""></p><ol><li>Enter the server name of the Management Server (“host” in cluster terminology)</li><li>Click Connect</li><li>Select the IP-address of the host</li><li>Click Next</li></ol><p>Verify your Host Parameters</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance9.png" alt=""></p><ol><li>Doublecheck the IP-address</li><li>Click Next</li></ol><p>Verify the Port Rules</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance10.png" alt=""></p><ol><li>Make sure that Load is Equal and Affinity is Single</li><li>Click Finish</li></ol><h1 id="Final-Verification"><a href="#Final-Verification" class="headerlink" title="Final Verification"></a>Final Verification</h1><p>After each added host it would be proper to check if it was added correctly. The easiest way is to check their statuses in the Network Load Balancing Manager. Green is generally considered good and you want your hosts to be “Converged”.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/05/051812_1216_Loadbalance11.png" alt=""></p><p>Another way to verify functionality is to point your Operations Manager console to the Cluster DNS-name instead and connect. If you are in a lab or in an environment where it is OK to shut down Management Servers you could try that as well.</p><p>Considering my note on routers in the Cluster Post-Configuration I guess it would be prudent to point out that you should try launching SDK-sessions from all networks you intend to connect from. Just to make sure that your routers are correctly configured to handle these kinds of sessions.</p><!--more--><h1 id="Postlude"><a href="#Postlude" class="headerlink" title="Postlude"></a>Postlude</h1><p>Now; as easy this may be I would personally argue that you should involve your network team <em>before</em> starting to deploy your load-balanced clusters. A little heads-up is always a good thing—I have noticed that network people rarely like surprises—and they might actually be able to help you all the way is you ask nicely. And maybe they’ll tell you right away that some configuration is required before-hand instead of giggling frantically in a corner at your feeble attempts to troubleshoot your fresh little cluster.</p><p>Soooo… have fun!</p><p>And remember; with great powers come great responsibility.</p><p><em>Sheesh! This post got out of hand!</em></p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/load-balanced-scom2012-sdk-services-for-network-illiterates-opsmgr-nlb/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Quick-Hack: Send SMS through Powershell [#powershell]</title>
      <link>https://www.teknoglot.se/code/posh/quick-hack-send-sms-through-powershell-powershell/</link>
      <guid>https://www.teknoglot.se/code/posh/quick-hack-send-sms-through-powershell-powershell/</guid>
      <pubDate>Tue, 15 May 2012 13:14:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Decided to do a quick-hack/fast-publish on this one as I have had a bit less time to create a nice clean production-ready version as of y
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Decided to do a quick-hack/fast-publish on this one as I have had a bit less time to create a nice clean production-ready version as of yet… and people has been asking about how far off the article is.</p><p>What this script does is to send a text message using a GSM/GPRS modem connected to a local (or LAN-connected with local drivers) serial port using Powershell.</p><h1 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer!"></a>Disclaimer!</h1><p>This script “works” but is not fit for production. See it as an example of the general concept to evolve and adapt into something worthy of production use.</p><p>What’s missing in the latest iteration is:</p><ul><li>A working Event-Handler to deal with asynchronous call-backs.</li><li>Support for AT+MSGW (write to modem memory)</li><li>Reusing messages in modem memory for multiple recipients.</li><li>Various error- and exeption-handlers.</li><li>Actually verifying that the modem is AT-capable.</li><li>Querying the system for available modems and their ports.</li></ul><h1 id="The-Script"><a href="#The-Script" class="headerlink" title="The Script"></a>The Script</h1><p>So, a short note before digging into the script. Prerequisites for this script is that you have identified which COM-port to use and it’s supported baud-rates and whether it supports DTR or not. If you do not know what the hell I am talking about, you could probably have it work with my preconfigured settings anyway. If you are unsure about if your modem supports AT commands you could open a serial connection to the modem using Hyperterminal or PuTTY and run AT+CMGF=1. If supported, the return should be OK. If it is not supported (you get ERROR instead) you would have to use PDU-mode which require a bit of hex-encoding of your messages. This is nothing I have had to do yet and will not be including in this script. Maybe in the future. Maybe.</p><p>So, looking a some powershelling then. First thing would be to connect to the modem.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Create your instance of the SerialPort Class</span></span><br><span class="line"><span class="variable">$serialPort</span> = <span class="built_in">new-Object</span> System.IO.Ports.SerialPort</span><br><span class="line"><span class="comment"># Set various COM-port settings</span></span><br><span class="line"><span class="variable">$serialPort</span>.PortName = <span class="string">"COM1"</span></span><br><span class="line"><span class="variable">$serialPort</span>.BaudRate = <span class="number">19200</span></span><br><span class="line"><span class="variable">$serialPort</span>.WriteTimeout = <span class="number">500</span></span><br><span class="line"><span class="variable">$serialPort</span>.ReadTimeout = <span class="number">3000</span></span><br><span class="line"><span class="variable">$serialPort</span>.DtrEnable = <span class="string">"true"</span></span><br><span class="line"><span class="comment"># Open the connection</span></span><br><span class="line"><span class="variable">$serialPort</span>.Open()</span><br></pre></td></tr></table></figure><p>With the connection established, you the set to modem in AT-mode and start sending the message to the modem.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Tell the modem you want to use AT-mode</span></span><br><span class="line"><span class="variable">$serialPort</span>.Write(<span class="string">"AT+CMGF=1`r`n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Start feeding message data to the modem</span></span><br><span class="line"><span class="comment"># Begin with the phone number, international</span></span><br><span class="line"><span class="comment"># style and a &lt;CL&gt;... that's the `r`n part</span></span><br><span class="line"><span class="variable">$serialPort</span>.Write(<span class="string">"AT+CMGS=`"+46888888888`"`r`n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now, write the message to the modem</span></span><br><span class="line"><span class="variable">$serialPort</span>.Write(<span class="string">"This is a test!`r`n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Send a Ctrl+Z to end the message.</span></span><br><span class="line"><span class="variable">$serialPort</span>.Write($([char] <span class="number">26</span>))</span><br></pre></td></tr></table></figure><p>As you may notice, the message is only stored in the modems memory until you send a Ctrl+z which will end the message and send it. It is possible to add more text to the message before sending it if you would like. Personally, I prefer to store the message into a regular powershell variable and pass that one to the script. The SerialPort library is sort of clever and a local phone number will probably work. For safety, I always use international number with country code as it will work every time.</p><p>Only thing left now is to close the serial port connection and end the script. Like this.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$serialPort</span>.Close()</span><br></pre></td></tr></table></figure><h2 id="The-Copy-Paste-part"><a href="#The-Copy-Paste-part" class="headerlink" title="The Copy/Paste part"></a>The Copy/Paste part</h2><p>Here’s the entire script with some added control-features and check to avoid trying to send text messages with no serial connection.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">### DISCLAIMER ###</span></span><br><span class="line"><span class="comment">## This script is a quick-hack to demonstrate</span></span><br><span class="line"><span class="comment">## the basics of sending an SMS using an AT-</span></span><br><span class="line"><span class="comment">## compatible GSM modem connected a local</span></span><br><span class="line"><span class="comment">## serial port through PowerShell.</span></span><br><span class="line"><span class="comment">## No error-handling is implemented and this</span></span><br><span class="line"><span class="comment">## is NOT a script fit for production.</span></span><br><span class="line"><span class="comment">##################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your instance of the SerialPort Class</span></span><br><span class="line"><span class="variable">$serialPort</span> = <span class="built_in">new-Object</span> System.IO.Ports.SerialPort</span><br><span class="line"><span class="comment"># Set various COM-port settings</span></span><br><span class="line"><span class="variable">$serialPort</span>.PortName = <span class="string">"COM1"</span></span><br><span class="line"><span class="variable">$serialPort</span>.BaudRate = <span class="number">19200</span></span><br><span class="line"><span class="variable">$serialPort</span>.WriteTimeout = <span class="number">500</span></span><br><span class="line"><span class="variable">$serialPort</span>.ReadTimeout = <span class="number">3000</span></span><br><span class="line"><span class="variable">$serialPort</span>.DtrEnable = <span class="string">"true"</span></span><br><span class="line"><span class="comment"># Open the connection</span></span><br><span class="line"><span class="variable">$serialPort</span>.Open()</span><br><span class="line"><span class="comment"># Add variables for phone number and the message.</span></span><br><span class="line"><span class="variable">$phoneNumber</span> = <span class="string">"+46888888888"</span></span><br><span class="line"><span class="variable">$textMessage</span> = <span class="string">"This is a test message!"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="variable">$serialPort</span>.Open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> &#123;</span><br><span class="line"> <span class="comment"># Wait for 5s and try again</span></span><br><span class="line"> <span class="comment"># Told you this is a quick-hack, right?</span></span><br><span class="line"> <span class="built_in">Start-Sleep</span> -Seconds <span class="number">5</span></span><br><span class="line"> <span class="variable">$serialPort</span>.Open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">If</span> (<span class="variable">$serialPort</span>.IsOpen <span class="nomarkup">-eq</span> <span class="literal">$true</span>) &#123;</span><br><span class="line"> <span class="comment"># Tell the modem you want to use AT-mode</span></span><br><span class="line"> <span class="variable">$serialPort</span>.Write(<span class="string">"AT+CMGF=1`r`n"</span>)</span><br><span class="line"> <span class="comment"># Start feeding message data to the modem</span></span><br><span class="line"> <span class="comment"># Begin with the phone number, international</span></span><br><span class="line"> <span class="comment"># style and a &lt;CL&gt;... that's the `r`n part</span></span><br><span class="line"> <span class="variable">$serialPort</span>.Write(<span class="string">"AT+CMGS=`"<span class="variable">$phoneNumber</span>`"`r`n"</span>)</span><br><span class="line"> <span class="comment"># Give the modem some time to react...</span></span><br><span class="line"> <span class="built_in">Start-Sleep</span> -Seconds <span class="number">1</span></span><br><span class="line"> <span class="comment"># Now, write the message to the modem</span></span><br><span class="line"> <span class="variable">$serialPort</span>.Write(<span class="string">"<span class="variable">$textMessage</span>`r`n"</span>)</span><br><span class="line"> <span class="comment"># Send a Ctrl+Z to end the message.</span></span><br><span class="line"> <span class="variable">$serialPort</span>.Write($([char] <span class="number">26</span>))</span><br><span class="line"> <span class="comment"># Wait for modem to send it</span></span><br><span class="line"> <span class="built_in">Start-Sleep</span> -Seconds <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Close the Serial Port connection</span></span><br><span class="line"><span class="variable">$serialPort</span>.Close()</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$serialPort</span>.IsOpen <span class="nomarkup">-eq</span> <span class="literal">$false</span>) &#123;</span><br><span class="line"> echo <span class="string">"Port Closed!"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># That's all folks</span></span><br><span class="line"><span class="comment"># Now, add call-backs, event-handlers, and return-</span></span><br><span class="line"><span class="comment"># message handling.</span></span><br></pre></td></tr></table></figure><p>Enjoy!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/code/posh/quick-hack-send-sms-through-powershell-powershell/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Rant - The Concept of Booth-Babes</title>
      <link>https://www.teknoglot.se/tb/rant-the-concept-of-booth-babes/</link>
      <guid>https://www.teknoglot.se/tb/rant-the-concept-of-booth-babes/</guid>
      <pubDate>Tue, 08 May 2012 16:18:05 GMT</pubDate>
      <description>
      
        &lt;h1 id=&quot;Background&quot;&gt;&lt;a href=&quot;#Background&quot; class=&quot;headerlink&quot; title=&quot;Background&quot;&gt;&lt;/a&gt;Background&lt;/h1&gt;&lt;p&gt;Having visited a few conferences in the last years I have spotted a trend I didn’t think I would see in the IT-Pro sphere. You could probably call me naïve for that but logically we should not encourage this trend. This is my appeal to all exhibitors of future conferences to re-evaluate the concept of booth-babes.&lt;/p&gt;
&lt;p&gt;I will not go into the genus-political part of this discussion as of now–others are more eloquent and fit to handle that–but rather some of the more pragmatic sides to ditch the BB (short for Booth-Babe) and how that would gain us visitors as well as the exhibitors. I will also keep a pretty frank, and perhaps impolite, tone in this rant of mine.&lt;/p&gt;
&lt;p&gt;So, here’s my top reasons, in no particular order, to give up the BBs.&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>Having visited a few conferences in the last years I have spotted a trend I didn’t think I would see in the IT-Pro sphere. You could probably call me naïve for that but logically we should not encourage this trend. This is my appeal to all exhibitors of future conferences to re-evaluate the concept of booth-babes.</p><p>I will not go into the genus-political part of this discussion as of now–others are more eloquent and fit to handle that–but rather some of the more pragmatic sides to ditch the BB (short for Booth-Babe) and how that would gain us visitors as well as the exhibitors. I will also keep a pretty frank, and perhaps impolite, tone in this rant of mine.</p><p>So, here’s my top reasons, in no particular order, to give up the BBs.</p><a id="more"></a><h2 id="Reason-1-BBs-is-disrupting-the-purpose-of-the-exhibition"><a href="#Reason-1-BBs-is-disrupting-the-purpose-of-the-exhibition" class="headerlink" title="Reason #1 - BBs is disrupting the purpose of the exhibition"></a>Reason #1 - BBs is disrupting the purpose of the exhibition</h2><p>When I go to a conference, I am there for the tech, to network and shake paws with the people I collaborate with on-line. It is also a good place to meet the actual corporations that I do business with and discuss their products between four eyes.<br>I do not want to plow through a crowd of great white whales [Oops! I meant “males”] ogling the BBs to get to someone with actual knowledge about the products and solutions at hand.</p><h2 id="Reason-2-BBs-are-alienating-the-visitors"><a href="#Reason-2-BBs-are-alienating-the-visitors" class="headerlink" title="Reason #2 - BBs are alienating the visitors"></a>Reason #2 - BBs are alienating the visitors</h2><p>If you are a heterosexual male or a homosexual female, the BBs can actually make you embarrassed, shy and unwilling to approach the exhibitor for that sole reason.<br>If you are not, you might find an exhibitor with BBs appalling and take another route for that sole reason.</p><h2 id="Reason-3-BBs-are-intimidating-the-female-visitors"><a href="#Reason-3-BBs-are-intimidating-the-female-visitors" class="headerlink" title="Reason #3 - BBs are intimidating the female visitors"></a>Reason #3 - BBs are intimidating the female visitors</h2><p>There is, of course, exceptions to this, but I actually discussed this matter with a couple of gentlewomen in the alumni lounge and they did say that they are both appalled and intimidated to the slightly clad BBs at one particular booth at this years MMS. They even used terms like “ridiculous” and “waste of space” to describe the phenomena.<br>Now, I believe I can hear some of you readers thinking “what? Nice addition to the boring screens and …”. But imaging the opposite for a while. Imagine a whole bunch of Booth-Hunks instead. You know, Brad Pitt in Fight Club and the likes. I know I would be intimidated by that kind of display.</p><h2 id="Reason-4-BBs-makes-it-hard-to-know-who-to-talk-to"><a href="#Reason-4-BBs-makes-it-hard-to-know-who-to-talk-to" class="headerlink" title="Reason #4 - BBs makes it hard to know who to talk to"></a>Reason #4 - BBs makes it hard to know who to talk to</h2><p>Because of the BBs, it can at time be hard to know if the lady at the booth just happen to be a nice-looking knowledgeable tech-specialist or simply someone there for eye-candy. Too many times have I had a conversation like this:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- &quot;Hi! So, tell me about [SystemX]. It looks kinda interesting on paper.&quot;</span><br><span class="line">- &quot;Hi! Uh, oh! Yeah! You should probably be talking to that guy over there. I don&apos;t really know anything about their stuff.&quot;</span><br></pre></td></tr></table></figure><p>I hate it. I want to be able to pick anyone in the booth and get a cohesive answer. You cannot be expert on everything and some people are more marketing focused, but at least they can give you the big picture before calling some techy fellow. Last year I had a really nice discussion with a nice lady from EMC that later led to get access to to some beta code. Unfortunately, I had by then grown tired of the BBs and merely approached her since there were lines to the male exhibitors. Which brings me to…</p><h2 id="Reason-5-Having-BBs-is-disrespecting-your-female-colleagues"><a href="#Reason-5-Having-BBs-is-disrespecting-your-female-colleagues" class="headerlink" title="Reason #5 - Having BBs is disrespecting your female colleagues."></a>Reason #5 - Having BBs is disrespecting your female colleagues.</h2><p>There you are. You most certainly have some very talented women in your development teams–my experience is that’s where you’ll find most of them, as architects and lead developers–but for some reason your decide to hire a bunch of BBs to “spice it up a little”, “draw a little crowd”, “get the attention” and so forth. Do you really think your female colleagues appreciate that? Isn’t that diminishing their talent a bit? I am sure that those who attend conferences for technical reasons and to do a bit of networking would take a nice technical discussion with anyone, however geeky she/he might be, rather than side-stepping a crowd or some figure-head on my way there.</p><p>I don’t know. Maybe I am alone in this matter, but I’d really like to see this change. I would really like to see vendors and exhibitors trying to dazzle the visitors with great displays, clever uses of software and mind-blowing products and not scantily clad women.</p><p>Ah, well. Thanks for your time.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/rant-the-concept-of-booth-babes/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Parameter Replacement in AlertName</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/parameter-replacement-in-alertname/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/parameter-replacement-in-alertname/</guid>
      <pubDate>Mon, 09 Apr 2012 20:04:48 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;…and-why-you-should-not-use-it&quot;&gt;&lt;a href=&quot;#…and-why-you-should-not-use-it&quot; class=&quot;headerlink&quot; title=&quot;…and why you should not use it&quot;&gt;
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="…and-why-you-should-not-use-it"><a href="#…and-why-you-should-not-use-it" class="headerlink" title="…and why you should not use it"></a>…and why you should not use it</h1><h2 id="A-Disclaimer"><a href="#A-Disclaimer" class="headerlink" title="A Disclaimer"></a>A Disclaimer</h2><p>I have had serious doubts about actually writing this article for almost a year now for reasons that I will explain further on. But as others have discovered this “feature” as well–maybe “hack” would be a better name for it–I feel the need to explain how it works and also why you should not use it. Knowledge is power, and even if I advice against using this technique it is also a good way to understand how SCOM uses display-strings in management packs.</p><h2 id="The-Good-News"><a href="#The-Good-News" class="headerlink" title="The Good News"></a>The Good News</h2><p>Yes, you can use parameter replacement in you AlertName.</p><p>With “parameter replacement” i mean using some kind of substitute text, or mnemonic if you like, that at run-time get translated into something useful. If you have written any kind of alert generating rules or monitors, you most like included something like <em>$Data/Context/Property[@Name=’SomeDataFromAPropertyBag’]$</em> into your alert description.</p><p>In this dialog, you also have the possibility to set the Alert Name. And if you are lazy, like I am, you probably also noticed that it is impossible to insert any kind of dynamic data into that field as well. This is especially annoying when you are writing a management pack that needs to look different in the Alert Views in the console, and you want to monitor 50 different Events or Performance counters or Log entries that are pretty much the same apart from a Name or ID.<br>Of course I could not refrain from copy-pasting a <em>$Data/Context…$</em> into the alert name only to realize that it simply is not being parsed and translated into the value of the specified parameter. Over time I have settled for a stand-point that it’s probably a performance issue and I have also used that as an argument for this apparent lack of simplicity that some of my customers have been questioning.</p><p>Two, maybe three, years later. Microsoft releases an update to the core agent monitoring packs. Much to my surprise, one performance monitor suddenly generated alerts with a dynamic performance value in the Alert Name. You know, that field that is not gettingt parsed I was mentioning in the earlier paragraph. It actually looked pretty bad and made it very much impossible to practice any kind of alert supression, but still. It actually had a parsed value in the Alert Name.<br>As the lack of this feature had me irked before, I exported the core MP and started reading through the XML to find out how they did it. To my surprise, it was actually pretty simple if you ditched the Authoring Console and used your trusty text-editor instead.</p><h2 id="How-To-Do-It"><a href="#How-To-Do-It" class="headerlink" title="How To Do It"></a>How To Do It</h2><p>In simple terms, if you know your SCOM XML out-side-in, you add the parameters to your “Alert” and modify your DisplayString, the one under LanguagePacks, to call that parameter by it’s relative ID.</p><p>Just in case you happen to be a regular mortal, here’s the step-by-step guide. ;)</p><p>In this example I have created a silly-simple Alert Generating EventLog rule in wich I have added some parameters to the description. It pretty much looks like this:</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2012/04/ParamReplacement_AlertDescriptionDialog.png" alt="Alert Description Dialog"></p><p>Saving the MP at this point I will have a new WriteAlert action with a bunch of parameters and a displaystring with a unique ID.<br>The resulting XML-code for the WriteAlert action looks like this:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">[xml highlight="7,8,9,10,11,12,13"]</span><br><span class="line"><span class="tag">&lt;<span class="name">WriteAction</span> <span class="attr">ID</span>=<span class="string">"Alert"</span> <span class="attr">TypeID</span>=<span class="string">"Health!System.Health.GenerateAlert"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Priority</span>&gt;</span>1<span class="tag">&lt;/<span class="name">Priority</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Severity</span>&gt;</span>2<span class="tag">&lt;/<span class="name">Severity</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AlertName</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AlertDescription</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AlertOwner</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AlertMessageId</span>&gt;</span>$MPElement[Name="TestMP.MyEventlogAlertRule.AlertMessage"]$<span class="tag">&lt;/<span class="name">AlertMessageId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AlertParameters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AlertParameter1</span>&gt;</span>$Data/EventDescription$<span class="tag">&lt;/<span class="name">AlertParameter1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AlertParameter2</span>&gt;</span>$Data/LoggingComputer$<span class="tag">&lt;/<span class="name">AlertParameter2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AlertParameter3</span>&gt;</span>$Data/UserName$<span class="tag">&lt;/<span class="name">AlertParameter3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">AlertParameter4</span>&gt;</span>$Data/EventNumber$<span class="tag">&lt;/<span class="name">AlertParameter4</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">AlertParameters</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Suppression</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom1</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom2</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom3</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom4</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom5</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom6</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom7</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom8</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom9</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Custom10</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">WriteAction</span>&gt;</span></span><br></pre></td></tr></table></figure><p>In this slab of code, you’ve got the Parameters, their “relative ID” (the number in the Tag), and also the which is what you would need to search for among the displaystrings. Take note of the you want to use in your AlertName since you are going to need it later. A quick search for “TestMP.MyEventlogAlertRule.AlertMessage” will lead you to the actual message, which should looke similar to this:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">DisplayString</span> <span class="attr">ElementID</span>=<span class="string">"TestMP.MyEventlogAlertRule.AlertMessage"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Name</span>&gt;</span>I want Parameter Replacement here:<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Description</span>&gt;</span>Event Description: &#123;0&#125;</span><br><span class="line">&#123;1&#125;</span><br><span class="line">&#123;2&#125;</span><br><span class="line">&#123;3&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">Description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DisplayString</span>&gt;</span></span><br></pre></td></tr></table></figure><p>You should have one of these for every language you have configured in your management pack.<br>As you may notice, the Description does not contain any XPaths of any kind but rather references to the parameters defined in the WriteAction. That would be the {X} thingies within the description tags. You may also notice that the AlertParameters starts from “1” while the parameter references begin with “0”. In practice, that means that <em>{0}</em> in the displaystring definition equals to <em>AlertParameter1</em> and so forth.</p><p>Now, with this in mind, adding a Parameter to AlertName if very simple and straight-forward. Simply decide which parameter your want to use and add it’s reference to the Name definition.<br>So, let’s say I have the above alert message and I want to include <em>UserName</em> in the Alert Name, I would change the <name> tag to:</name></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Name</span>&gt;</span>I want Parameter Replacement here:&#123;2&#125;<span class="tag">&lt;/<span class="name">Name</span>&gt;</span></span><br></pre></td></tr></table></figure><p>That’s it folks!<br>Save the XML, make sure you verify it and import it into your Operations Manager LAB and watch the magic. Just make sure you continue reading this post as the next part about the downsides is pretty important.</p><h2 id="The-Downside"><a href="#The-Downside" class="headerlink" title="The Downside"></a>The Downside</h2><p>The negative effects of using Parameter Replacement in AlertName really boils down to two main perspectives. These are, if I may say to, pretty major and is the reason I have been reluctant on posting this, sort of, how-to.</p><h3 id="You-are-breaking-your-subscriptions-and-connectors"><a href="#You-are-breaking-your-subscriptions-and-connectors" class="headerlink" title="You are breaking your subscriptions and connectors"></a>You are breaking your subscriptions and connectors</h3><p>Apparently, parameter replacement is not working in subscriptions and connectors, be it 3:rd-party, Universal, Orchestrator IPs et.c. Basically anything other than the Operations Console will not be able to handle your parameters in AlertName. This will give you a <em>“{1} in {2} has received an error”</em> instead of <em>“veryimportant.log in C:\Logs\ImportantSystem\ has received an error”</em> in anything except the Operations Console. Now, this might not be a bad thing if the Operations Console is your only interface to Operations Manager, but if you would like to forward these alerts to a mobile phone, IM user or a mail recipient it will be utterly useless. I have not verified this, but I am not sure if Alert Suppression is actually parsing the parameters as well. Also. If you, by means of connectors or System Center Orchestrator, are generating incidents from alerts the AlertName forwarded will be equally useless for anyone receiving it.</p><h3 id="It’s-killing-your-health-perspective"><a href="#It’s-killing-your-health-perspective" class="headerlink" title="It’s killing your health perspective"></a>It’s killing your health perspective</h3><p>Might sound drastic, but I’m quite serious about this. Using Parameter Replacement in AlertName might be useful for alert generating rules, but should never be used in a monitor. The reason is pretty simple actually. If you are using a monitor, you are without a doubt interested in it’s state. Otherwise, you would not use a monitor, am I right? I cannot see how it would make sense to create a monitor that does not reflect the health of a specific checkpoint. Much less having a monitor generating alerts that might confuse any service desk operator about what monitor that caused the alert. Also–I have not tested this–I assume that a monitor would not update it’s AlertName once the alert are generated making it more difficult to troubleshoot. Alert generating rules are, to me, something I tend to use only when all other options fail for some reason and I do not like to monitor things to cannot have health. And since parameters in AlertName is nothing for monitors I also question whether it actually is usable at all.</p><h2 id="The-Conclusion"><a href="#The-Conclusion" class="headerlink" title="The Conclusion"></a>The Conclusion</h2><p>While this is an interesting techique and a good way to enjoy MP Authoring and learn about the behaviour of display strings and languages in you Management Packs, I would definitely consider it a mostly academical exercise. Only in <span style="text-decoration: underline;">extreme</span> use-cases and situations would I consider it a viably option and while it might look good in the console, do be aware of the limitations. I have also not seen anything about it on MSDN, and I have serious doubts about it being a supported feature. I have personally been using it in transition to a “better” management pack to get alerting running quickly, yet a prefered solution would actually be using a custom datasouce and a decent macro-enabled text-editor–not to mention snippets–to bulk-generate your monitors and/or rules.</p><blockquote><p>MP Authoring</p><p>is fun and powerful</p><p>– be resposible</p></blockquote>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/parameter-replacement-in-alertname/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Virtual OpenVPN Server at Home</title>
      <link>https://www.teknoglot.se/Linux/virtual-openvpn-server-at-home/</link>
      <guid>https://www.teknoglot.se/Linux/virtual-openvpn-server-at-home/</guid>
      <pubDate>Wed, 28 Sep 2011 06:37:39 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;I was going to write a post on how to install and configure your own virtual SSL-VPN server as I had in mind to make one myself as a mean
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I was going to write a post on how to install and configure your own virtual SSL-VPN server as I had in mind to make one myself as a means to surf safely while on hotspots and to access my System Center lab at home.</p><p>I’m not gonna do that. Instead I just want to point to this free, already pre-configured, <a href="http://www.vmware.com/appliances/directory/va/320963" title="Free OpenVPN Appliance" target="_blank" rel="noopener">OpenVPN Virtual Appliance</a>. Just follow its instructions and it will work quite nicely.</p><p>Have fun.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Linux/virtual-openvpn-server-at-home/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2007 R2 Documentation</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/opsmgr-2007-r2-documentation/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/opsmgr-2007-r2-documentation/</guid>
      <pubDate>Mon, 08 Aug 2011 20:52:27 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Here a link to the &lt;a href=&quot;http://www.microsoft.com/download/en/details.aspx?id=4561&quot; title=&quot;System Center Operations Manager 2007 R2 Do
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Here a link to the <a href="http://www.microsoft.com/download/en/details.aspx?id=4561" title="System Center Operations Manager 2007 R2 Documentation" target="_blank" rel="noopener">System Center Operations Manager 2007 R2 Documentation</a> for those of you out there who keeps asking of its whereabouts and then tell me to not tell you to <a href="http://www.google.se/search?q=opsmgr+2007+r2+documentation" title="opsmgr 2007 r2 documentation" target="_blank" rel="noopener">google for it</a>.</p><p>So now I can direct you to my site, tell you to click on “OpsMgr 2007” to the left and browse through my posts instead of wasting precious time on googling and pretend being more helpful.<br>To the rest of the world, sorry for wasting your time!</p><p>Happy now, eh?</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/opsmgr-2007-r2-documentation/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Bulk disable ACS Forwarders (with wildcards)</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/bulk-disable-acs-forwarders-with-wildcards/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/bulk-disable-acs-forwarders-with-wildcards/</guid>
      <pubDate>Thu, 07 Jul 2011 08:59:24 GMT</pubDate>
      <description>
      
        &lt;p&gt;Here’s a little something-something for the wicked.&lt;/p&gt;
&lt;p&gt;Me and my apprentice is currently decommissioning an entire Management Group with a thousand (-ish) agents. Long story short, we got a new Management Group, migrated all the agents, added a couple of hundreds more, deployed a bunch of gateways and now we are shutting down the old one.&lt;/p&gt;
&lt;p&gt;Now, uninstalling the old Management Group from all the agents is a breeze using SCCM and handling the few 20-ish servers that are left is not a biggie either. Shutting down ACS, however, is a different matter.&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>Here’s a little something-something for the wicked.</p><p>Me and my apprentice is currently decommissioning an entire Management Group with a thousand (-ish) agents. Long story short, we got a new Management Group, migrated all the agents, added a couple of hundreds more, deployed a bunch of gateways and now we are shutting down the old one.</p><p>Now, uninstalling the old Management Group from all the agents is a breeze using SCCM and handling the few 20-ish servers that are left is not a biggie either. Shutting down ACS, however, is a different matter.</p><a id="more"></a><p>Although you do configure your forwarders using Operations Manager, removing the management group you were running ACS in does not mean the agents will shut down and disable the AdtAgent service or stop trying to forward audit events to your collector. Now, selecting 10 agents at the time and running the “Disable Audit Collection” task–in case you did not know, there’s a limitation on how many agents you can run a task on in the Operations Console–is not my idea of a jolly good day and since Powershell is a bucket of joy in comparison; here’s a script for you all!</p><p><a href="http://teknoglotse.nfshost.com/wp-content/uploads/2011/07/DisableACSForwarders.zip" target="_blank" rel="noopener">DisableACSForwarders</a></p><p>It is zipped to avoid security alerts, but as with any script found on the internet I implore to to read the code before actually running it.</p><p>Anyway, you can use it in a couple of ways.</p><p>To run it interactively, just go to the directory where you unpacked it and run it. You will be requested to enter the FQDN of you Root Management Server and a wildcard search for ACS Forwarders.<br>For example:</p><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="function">C:\..\<span class="title">Scripts</span>&gt; .\<span class="title">DisableACSForwarders.ps1</span></span></span><br><span class="line"><span class="function"><span class="title">Root</span> <span class="title">Management</span> <span class="title">Server</span>: <span class="title">rms.teknoglot.local</span></span></span><br><span class="line"><span class="function"><span class="title">ACS</span> <span class="title">Forwarder</span> <span class="title">name</span> (<span class="title">wildcard</span>): *.<span class="title">teknoglot.local</span></span></span><br></pre></td></tr></table></figure><p>You can also run it with parameters (for scheduling?) like this:</p><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="function">C:\..\<span class="title">Scripts</span>&gt; .\<span class="title">DisableACSForwarders.ps1</span> <span class="title">rms.teknoglot.local</span> *.<span class="title">teknoglot.local</span></span></span><br></pre></td></tr></table></figure><p>If you need to run the task with different credentials there’s a switch for that. Just add -UseCredentials to the command and you will be prompted for it.<br>Like this:</p><figure class="highlight bat"><table><tr><td class="code"><pre><span class="line"><span class="function">C:\..\<span class="title">Scripts</span>&gt; .\<span class="title">DisableACSForwarders.ps1</span> -<span class="title">UseCredentials</span></span></span><br></pre></td></tr></table></figure><p>As you might already have realized, the wildcard search does not require actual wildcards. If you only want to disable the ACS forwarder on a single machine, just enter it’s FQDN. As for what wildcards it will accept; <a href="http://msdn.microsoft.com/en-us/library/aa717088%28VS.85%29.aspx" title="Supporting Wildcard Characters in Cmdlet Parameters" target="_blank" rel="noopener">anything supported by the powershell -like operator</a> is valid.</p><p>[UPDATE!] You might get false failures when running the script on clustered machines because of a <a href="https://connect.microsoft.com/OpsMgr/feedback/details/523453/bug-with-microsoft-audit-collection-services-management-pack" title="Bug with Microsoft Audit Collection Services Management Pack" target="_blank" rel="noopener">bug in the AC Management Pack</a></p><p>For the source code, read on!</p><!--more--><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment">## Using parameters for RMS and wildcard search</span></span><br><span class="line"><span class="keyword">param</span>(</span><br><span class="line">    [string]<span class="variable">$rootManagementServer</span> = $(<span class="built_in">Read-Host</span> -Prompt <span class="string">"Root Management Server"</span> ),</span><br><span class="line">    [string]<span class="variable">$filterAgents</span> = $(<span class="built_in">Read-Host</span> -Prompt <span class="string">"ACS Forwarder name (wildcard)"</span> ),</span><br><span class="line">    [switch]<span class="variable">$UseCredentials</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## Make sure the $rootManagementServer variable is defined</span></span><br><span class="line"><span class="keyword">while</span> (<span class="nomarkup">-not</span> <span class="variable">$rootManagementServer</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`nRoot Management Server MUST be defined!"</span> -ForegroundColor Red</span><br><span class="line">    [string]<span class="variable">$rootManagementServer</span> = $(<span class="built_in">Read-Host</span> -Prompt <span class="string">"Root Management Server"</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$UseCredentials</span> <span class="nomarkup">-eq</span> <span class="literal">$true</span>) &#123;</span><br><span class="line">    <span class="variable">$taskCredentials</span> = <span class="built_in">Get-Credential</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$startLocation</span> = <span class="built_in">Get-Location</span></span><br><span class="line"><span class="variable">$checkPSSnapin</span> = <span class="built_in">Get-PSSnapin</span> | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="string">"Microsoft.EnterpriseManagement.OperationsManager.Client"</span> &#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$checkPSSnapin</span> <span class="nomarkup">-eq</span> <span class="literal">$null</span>) &#123;</span><br><span class="line">    <span class="built_in">Add-PSSnapin</span> <span class="string">"Microsoft.EnterpriseManagement.OperationsManager.Client"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$result</span> = <span class="built_in">Set-Location</span> <span class="string">"OperationsManagerMonitoring::"</span></span><br><span class="line"><span class="variable">$result</span> = New-ManagementGroupConnection -ConnectionString:<span class="variable">$rootManagementServer</span></span><br><span class="line"><span class="variable">$result</span> = <span class="built_in">Set-Location</span> <span class="variable">$rootManagementServer</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$acsForwarderClass</span> = Get-MonitoringClass -Name <span class="string">"Microsoft.SystemCenter.ACS.Forwarder"</span></span><br><span class="line"><span class="variable">$agentNames</span> = Get-MonitoringObject -monitoringclass:<span class="variable">$acsForwarderClass</span> | where &#123;<span class="variable">$_</span>.Path <span class="nomarkup">-like</span> <span class="variable">$filterAgents</span>&#125; | Select Path</span><br><span class="line"><span class="variable">$successfulTasks</span> = @()</span><br><span class="line"><span class="variable">$skippedTasks</span> = @()</span><br><span class="line"><span class="variable">$failedTasks</span> = @()</span><br><span class="line"></span><br><span class="line"><span class="variable">$monitoringClass</span> = Get-MonitoringClass -Name <span class="string">"Microsoft.SystemCenter.Agent"</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$agentNames</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`nFound"</span> <span class="variable">$agentNames</span>.Count<span class="string">"ACS forwarders with wildcard <span class="variable">$filterAgents</span>"</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`n`nWaiting for 5 seconds to give you a chance to abort!`n"</span></span><br><span class="line">    <span class="built_in">Start-Sleep</span> -Seconds <span class="number">5</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"Time's UP!`n`n"</span></span><br><span class="line">    <span class="variable">$agentNames</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">        <span class="variable">$agentName</span> = <span class="variable">$_</span>.Path</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">"Disabling Audit Collection on"</span> <span class="variable">$agentName</span></span><br><span class="line">        <span class="variable">$monitoringObject</span> = Get-MonitoringObject -monitoringclass:<span class="variable">$monitoringClass</span> | where &#123;<span class="variable">$_</span>.DisplayName <span class="nomarkup">-like</span> <span class="variable">$agentName</span>&#125;</span><br><span class="line">        <span class="variable">$agentTask</span> = <span class="variable">$monitoringObject</span> | Get-Task | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="string">"Microsoft.SystemCenter.DisableAuditCollectionService"</span> &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$monitoringObject</span>.IsAvailable <span class="nomarkup">-eq</span> <span class="literal">$true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$credentials</span> <span class="nomarkup">-eq</span> <span class="literal">$null</span>) &#123;</span><br><span class="line">                <span class="variable">$result</span> = Start-Task -Task <span class="variable">$agentTask</span> -TargetMonitoringObject <span class="variable">$monitoringObject</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$result</span> = Start-Task -Task <span class="variable">$agentTask</span> -TargetMonitoringObject <span class="variable">$monitoringObject</span> -Credential <span class="variable">$taskCredentials</span></span><br><span class="line">            &#125;</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$result</span>.Status <span class="nomarkup">-eq</span> <span class="string">"Succeeded"</span> ) &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">"Operation Successful!"</span> -ForegroundColor Green</span><br><span class="line">                <span class="built_in">Write-Host</span> `n</span><br><span class="line">                <span class="variable">$successfulTasks</span> += <span class="variable">$agentName</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="string">"Operation failed."</span> -ForegroundColor Red</span><br><span class="line">                <span class="built_in">Write-Host</span> <span class="variable">$result</span>.ErrorMessage</span><br><span class="line">                <span class="built_in">Write-Host</span> `n</span><br><span class="line">                <span class="variable">$failedTasks</span> += <span class="variable">$agentName</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">Write-Host</span> <span class="string">"The agent is unavailable, Skipping!"</span></span><br><span class="line">            <span class="built_in">Write-Host</span> `n</span><br><span class="line">            <span class="variable">$skippedTasks</span> += <span class="variable">$agentName</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"Summary"</span></span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`tSuccessful:`t"</span> <span class="variable">$successfulTasks</span>.count</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`tFailed:`t`t"</span> <span class="variable">$failedTasks</span>.count</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`tSkipped:`t"</span> <span class="variable">$skippedTasks</span>.count</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">"`nNo ACS Forwarders found using wildcard <span class="variable">$filterAgents</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-Location</span> <span class="variable">$startLocation</span></span><br></pre></td></tr></table></figure><p>Enjoy!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/bulk-disable-acs-forwarders-with-wildcards/#disqus_thread</comments>
    </item>
    
    <item>
      <title>OpsMgr 2007 Connectivity Map</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/opsmgr-2007-connectivity-map/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/opsmgr-2007-connectivity-map/</guid>
      <pubDate>Tue, 17 May 2011 09:47:18 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;&lt;a href=&quot;http://teknoglotse.nfshost.com/wp-content/uploads/2011/05/SCOM_Connectivity_Map.png&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;img src=&quot;ht
        
      
      </description>
      
      <content:encoded><![CDATA[<p><a href="http://teknoglotse.nfshost.com/wp-content/uploads/2011/05/SCOM_Connectivity_Map.png" target="_blank" rel="noopener"><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2011/05/SCOM_Connectivity_Map-300x279.png" alt="SCOM Connectivity Map" title="SCOM Connectivity Map"></a>I’ve had this little visio drawing lying around on my desktop for a while now and I thought that it might be a nice thing to share.</p><p>It is nothing ground breaking at all and all the information is available at the <a href="http://technet.microsoft.com/en-us/library/bb309428.aspx" title="Operations Manager 2007 R2 Supported Configurations" target="_blank" rel="noopener">Operations Manager 2007 R2 Supported Configurations</a> page on Technet, but I find the visual map easier to read and I use it personally to quickly look up all port openings for the most common components in Operations Manager.</p><p>It is missing a few components like ACS, AEM and XPlat, but I usually just look them up when needed.</p><p>Have fun!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/opsmgr-2007-connectivity-map/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Introduction to TG WinAutoSvc v1</title>
      <link>https://www.teknoglot.se/ms/opsmgr2012/introduction-to-tg-winautosvc-v1/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2012/introduction-to-tg-winautosvc-v1/</guid>
      <pubDate>Fri, 29 Apr 2011 09:35:47 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;Background&quot;&gt;&lt;a href=&quot;#Background&quot; class=&quot;headerlink&quot; title=&quot;Background&quot;&gt;&lt;/a&gt;Background&lt;/h1&gt;&lt;p&gt;For quite some time now I’ve had this 
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h1><p>For quite some time now I’ve had this idea spinning around in my head to write a couple of blog-posts about some of the more useful techniques available when building management packs. Many of these techniques are already described on MSDN and Technet- or other blogs as well as on various forums, but often no more than small bits and pieces of them and I have yet to see some humanly readable information about how to tie them together into a useful management pack. I say “humanly readable” because the information you do find online so far may be clear and somewhat easy to understand for someone with a system development background and a pretty good idea of how object oriented development models tend to work. But the real life System Center Operations Manager engineer–you know the one who get those <em>“do you think we could monitor our …-system too?”</em> questions a couple of times a week, you know… you (most likely, being here)–tend to have a completely different background. Yet as their OpsMgr environment grows, so does the demand for custom monitoring and all of a sudden the former server engineer are now also a developer. A developer who has never before had the need to grasp such abstract concepts as classes, instances, inheritance and who probably never before have had any reason whatsoever to write any XML code.</p><h1 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h1><p>My idea for this series of posts is to shed some light into the world of the authoring console and modules and cookdown and so forth. I am by no means an accredited author, but I will do my best to stay human in this venture and in plain english try to explain why and how you do certain things when going from Management Pack templates, rules, monitors and the safe haven that is authoring in the Operations Console into making your scripts resuable, easy to extend and prime for cookdown using the Authoring Console and XML.</p><h1 id="The-TG-WinAutoSvc-Management-Pack"><a href="#The-TG-WinAutoSvc-Management-Pack" class="headerlink" title="The TG WinAutoSvc Management Pack"></a>The TG WinAutoSvc Management Pack</h1><p>To give the series some kind of context and at the same time not only be a matter of examples I will base them on a fully functional management pack that discovers and monitors all Windows services that are set to automatic startup. I know there is other similar management packs out there but I haven’t fancied any one of them yet, and since I had the idea of writing this series I decided that building a new one would be a good way to go. Some of the interesting features with this management pack is:</p><ul><li>You will get an instance of the service classes for each and every service.</li><li>It uses different classes for Own Process services and Shared Process services (svchost for example).</li><li>Every service have a health state (you can use them in distributed applications).</li><li>The service state monitors are inherited from their base classes, no coding neccesary.</li><li>There is only one discovery script for all kinds of windows services.</li><li>Extending the discovery to include different kinds of windows services, like kernel processes, is a matter of filtering.</li><li>It is Open Source and licensed under the <a href="http://tg-winautosvc.googlecode.com/svn/trunk/LICENSE.TXT" title="Eclipse Public License v1" target="_blank" rel="noopener">Eclipse Public License v1</a>.</li></ul><p>Most of these features will be described thoroughly in later posts in the series and as development of it progresses I will document what I do, how I do it and why I do it in certain ways. Hopefully you will learn something new through this and get closer to becoming that MP Dev the organization asks for.<br>In the mean time, feel free to download, look at the source code (which it by no means perfect) and try it out.</p><p>The TG WinAutoSvc monitoring management pack is available for download here:<br><a href="http://code.google.com/p/tg-winautosvc/downloads/detail?name=TG.WinAutoSvc.xml" target="_blank" rel="noopener">http://code.google.com/p/tg-winautosvc/downloads/detail?name=TG.WinAutoSvc.xml</a></p><p>The latest revision of the source code is located here:<br><a href="http://code.google.com/p/tg-winautosvc/source/browse/trunk/TG.WinAutoSvc.xml" target="_blank" rel="noopener">http://code.google.com/p/tg-winautosvc/source/browse/trunk/TG.WinAutoSvc.xml</a></p><p>A small word of advice though. If you implement this in your environment, remember that you probably have alot more automatic services than you would expect. Because of this, discovery is disabled by default.</p><p>Best of luck, and enjoy!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2012/introduction-to-tg-winautosvc-v1/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Server problems fixed! (hopefully)</title>
      <link>https://www.teknoglot.se/tb/server-problems-fixed-hopefully/</link>
      <guid>https://www.teknoglot.se/tb/server-problems-fixed-hopefully/</guid>
      <pubDate>Wed, 27 Apr 2011 19:50:12 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;I think I got the server running ok now.&lt;/p&gt;
&lt;p&gt;I’ve been fiddling about quite alot and unfortunately don’t know which one action that fi
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I think I got the server running ok now.</p><p>I’ve been fiddling about quite alot and unfortunately don’t know which one action that fixed the problem. If I do figure it out, I will post it here.</p><p>Site performance should be a bit better now.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/server-problems-fixed-hopefully/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Sluggish performance on teknoglot</title>
      <link>https://www.teknoglot.se/tb/sluggish-performance-on-teknoglot/</link>
      <guid>https://www.teknoglot.se/tb/sluggish-performance-on-teknoglot/</guid>
      <pubDate>Tue, 19 Apr 2011 20:14:02 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;I, as well as others, have noticed some slow performance from my blog lately and I just wanted to let you know that the root cause have b
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I, as well as others, have noticed some slow performance from my blog lately and I just wanted to let you know that the root cause have been identified as a bug in on of the crypto libs on the server.</p><p>I haven’t found a working solution yet but are trying to keep an eye on the site regularly to be able to bounce the problematic services when they start to act up.</p><p>Hopefully there will be a fix available soon.</p><p>Sorry for any inconvenience in the meantime.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/sluggish-performance-on-teknoglot/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Move complete, welcome to teknoglot.se!</title>
      <link>https://www.teknoglot.se/tb/move-complete-welcome-to-teknoglot-se/</link>
      <guid>https://www.teknoglot.se/tb/move-complete-welcome-to-teknoglot-se/</guid>
      <pubDate>Fri, 04 Feb 2011 13:07:41 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Oh my God, I actually moved my blog for real. I think I’ve been putting this upp for nearly half a year now and even though I actually we
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Oh my God, I actually moved my blog for real. I think I’ve been putting this upp for nearly half a year now and even though I actually went and bought a “real” domain-name for it.</p><p>But now it’d done. The server is now self-hosted and self-maintained. Now, that obviously gives me a bit more to do, but on the other hand. I can fix any problems myself and not have to create tickets and hope someone responding to them knows what they’re talking about.</p><p>The design is mostly borrowed, for now, but it works and I hope I did all the HTACCESS rules on the old server correct so that they forward all the old links to the same post on the new one.</p><p>So, welcome!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/move-complete-welcome-to-teknoglot-se/#disqus_thread</comments>
    </item>
    
    <item>
      <title>I&#39;m moving (finally)</title>
      <link>https://www.teknoglot.se/tb/im-moving-finally/</link>
      <guid>https://www.teknoglot.se/tb/im-moving-finally/</guid>
      <pubDate>Tue, 01 Feb 2011 11:10:52 GMT</pubDate>
      <description>
      
        &lt;p&gt;If you’re seeing this, the move went OK. :P&lt;/p&gt;
&lt;p&gt;Anyway, I have tried to make sure that all the links, images and urls are still intact and that people are automatically redirected to the correct address on the new site too. I think I got it right, but who knows?&lt;/p&gt;
&lt;p&gt;Still fiddling with the themes thought.&lt;/p&gt;
&lt;p&gt;Sorry for the inconvenience!&lt;/p&gt;
&lt;p&gt;ps. Post from the old site is a jump ahead.&lt;/p&gt;
      
      </description>
      
      <content:encoded><![CDATA[<p>If you’re seeing this, the move went OK. :P</p><p>Anyway, I have tried to make sure that all the links, images and urls are still intact and that people are automatically redirected to the correct address on the new site too. I think I got it right, but who knows?</p><p>Still fiddling with the themes thought.</p><p>Sorry for the inconvenience!</p><p>ps. Post from the old site is a jump ahead.</p><a id="more"></a><p>Hi all,</p><p>I’m finally getting my <a href="http://en.wikipedia.org/wiki/Donkey" title="aka. ass" target="_blank" rel="noopener">male donkey</a> out of the wagon and has started moving this blog to a new self-hosted server.</p><p>The current host is cheap and delivers quite the good service, but since I already have servers running 24/7 at home, with attached electric bills, and more than enough bandwidth for a couple of websites I find it silly paying for yet-another hosting solution.</p><p>Also, it is a good time to do some spring-cleaning and actually start using that teknoglot.se domain i bought some time ago. :P</p><p>Hopefully, the transition will go mostly unnoticed apart from the automatic redirect (301 - Permanently moved) to the new domain.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/tb/im-moving-finally/#disqus_thread</comments>
    </item>
    
    <item>
      <title>SNMP GET Errors in OpsMgr EventLog</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/snmp-get-errors-in-eventlog/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/snmp-get-errors-in-eventlog/</guid>
      <pubDate>Thu, 02 Sep 2010 20:28:07 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;I’ve been building a little SNMP Management Pack in the past few days to discover and monitor a bunch of PowerWare UPS’s, which turned ou
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I’ve been building a little SNMP Management Pack in the past few days to discover and monitor a bunch of PowerWare UPS’s, which turned out to take quite a lot more energy and time than expected. Mostly due to the facts that I am really bad with SNMP and how it works, I’ve never really looked into the inner working of building an SNMP management pack and also because we ran into a couple of errors preventing the discovery process to work alright.</p><p>To make it clear right away, this is not going to be a “Building an SNMP Management Pack Tutorial” since there’s plentiful good ones out there already, and to be extra helpful I’m gonna include a few links right away:</p><ul><li><a href="http://www.systemcentercentral.com/BlogDetails/tabid/143/IndexID/66140/Default.aspx" title="SNMP Setup and Simple Custom SNMP Discovery" target="_blank" rel="noopener">SNMP Setup and Simple Custom SNMP Discovery</a> - Pretty much the basics</li><li><a href="http://www.systemcentercentral.com/BlogDetails/tabid/143/IndexID/58919/Default.aspx" title="SNMP Management Pack Example: NetApp Management Pack for SCOM 2007 R2 part 4" target="_blank" rel="noopener">SNMP Management Pack Example: NetApp Management Pack</a> - Part 4 actually, but has the links to the other parts</li><li><a href="http://www.systemcentercentral.com/Details/tabid/147/IndexID/58815/Default.aspx" title="Creating SNMP Probe Based Monitors" target="_blank" rel="noopener">Creating SNMP Probe Based Monitors</a> - No custom discovery, but a good and simple guide to SNMP Probes</li></ul><p>It’s the second, the NetApp one, I’ve used as a guide to building the UPS management pack since it goes through the process of building your own filtered discovery using SystemOID to identify your hardware-classes and then building the monitors on top of those.</p><h1 id="Let’s-get-to-it"><a href="#Let’s-get-to-it" class="headerlink" title="Let’s get to it"></a>Let’s get to it</h1><p>When building the discovery of my hardware classes I ran into problems. The discovery simply did not work. At first I got some strange errors about “invalid queries”, something that turned out to be related to me reading two guides–seriously though, pick one guide that is closest to what you want to achieve and stick to it–and mixing up the XPathQuery variables. Silly me.<br>I got those errors to go away and I was able to get a few objects to my base-class, but none of the hardware classes who was populated through the return value of an SNMP OID got discovered.<br>The only error I got this time was the following:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Log Name:      Operations Manager</span><br><span class="line">Source:        Health Service Modules</span><br><span class="line">Date:          2010-09-02 11:19:12</span><br><span class="line">Event ID:      11001</span><br><span class="line">Task Category: None</span><br><span class="line">Level:         Error</span><br><span class="line">Keywords:      Classic</span><br><span class="line">User:          N/A</span><br><span class="line">Computer:      CENSORED</span><br><span class="line">Description:</span><br><span class="line">Error sending an SNMP GET message to IP Address XX.XX.XX.XX, Community String:=CENSORED, Status 0x6c.</span><br><span class="line"></span><br><span class="line">One or more workflows were affected by this.</span><br><span class="line"></span><br><span class="line">Workflow name: CENSORED.MP.CLASS.DISCOVERY</span><br><span class="line">Instance name: CENSORED_DEVICENAME</span><br><span class="line">Instance ID: &#123;5C7EFB30-D885-8843-0DD7-EA86B4FD2311&#125;</span><br><span class="line">Management group: CENSORED</span><br></pre></td></tr></table></figure><p>I went through all the other logical steps of troubleshooting an error like that which include double-checking firewall settings, OIDs, IP-addresses, allowed hosts and so forth. It wasn’t until I loaded the <a href="http://www.networkupstools.org/protocols/eaton/" title="EATON Protocol Library" target="_blank" rel="noopener">PowerMIB</a> into a MIB Browser installed on the proxy machine (in this case a Management Server) I realized that there was no problem sending an SNMP GET to the UPS from that server. I launched Wireshark and had it listen to SNMP traffic between the UPS and the Management Server. The thing that struck me right-away was the fact that I could see the a bunch of “SNMP Get-Request” but no “SNMP Get-Response” which means that Operations Manager did send an SNMP GET but there was no response.</p><p>After a bit of intense staring i noticed what you see in the screenshot.</p><p><img src="http://teknoglotse.nfshost.com/wp-content/uploads/2010/09/snmp_error_wireshark.png" alt="SNMP Error in Wireshark" title="SNMP Error in Wireshark"></p><p>For some reason Operations Manager does not care about what SNMP version you configure when you do the initial discovery of a network device. Even if you do specify SNMP v1, you probes may very well be using SNMP v2c instead and in many cases that will result in these SNMP GET errors in the Operations Manager event log.</p><p>To avoid this, you haves to specify which SNMP version to use in your System.SnmpProbe according to the information provided here: <a href="http://msdn.microsoft.com/en-us/library/ee809331.aspx" target="_blank" rel="noopener">http://msdn.microsoft.com/en-us/library/ee809331.aspx</a></p><p>Since I am such a nice guy, here’s an example of the working probe with the added line highlighted.</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IsWriteAction</span>&gt;</span>false<span class="tag">&lt;/<span class="name">IsWriteAction</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">IP</span>&gt;</span>$Config/IP$<span class="tag">&lt;/<span class="name">IP</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CommunityString</span>&gt;</span>$Config/CommunityString$<span class="tag">&lt;/<span class="name">CommunityString</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Version</span>&gt;</span>1<span class="tag">&lt;/<span class="name">Version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SnmpVarBinds</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SnmpVarBind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">OID</span>&gt;</span>1.3.6.1.4.1.534.1.1.1.0<span class="tag">&lt;/<span class="name">OID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Syntax</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Syntax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Value</span> <span class="attr">VariantType</span>=<span class="string">"8"</span>&gt;</span><span class="tag">&lt;/<span class="name">Value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SnmpVarBind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SnmpVarBind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">OID</span>&gt;</span>1.3.6.1.4.1.534.1.1.2.0<span class="tag">&lt;/<span class="name">OID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Syntax</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Syntax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Value</span> <span class="attr">VariantType</span>=<span class="string">"8"</span>&gt;</span><span class="tag">&lt;/<span class="name">Value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SnmpVarBind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SnmpVarBind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">OID</span>&gt;</span>1.3.6.1.4.1.534.1.1.3.0<span class="tag">&lt;/<span class="name">OID</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Syntax</span>&gt;</span>0<span class="tag">&lt;/<span class="name">Syntax</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Value</span> <span class="attr">VariantType</span>=<span class="string">"8"</span>&gt;</span><span class="tag">&lt;/<span class="name">Value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SnmpVarBind</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SnmpVarBinds</span>&gt;</span></span><br></pre></td></tr></table></figure><p>That’s it. Working perfectly now.</p><p>Best of luck!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/snmp-get-errors-in-eventlog/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Installing Linux Integration Services v2.1 on Red Hat ES 5</title>
      <link>https://www.teknoglot.se/Linux/rhes/install-linuxis21-rhes5/</link>
      <guid>https://www.teknoglot.se/Linux/rhes/install-linuxis21-rhes5/</guid>
      <pubDate>Tue, 31 Aug 2010 10:06:04 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Ok, so I got the task to install the Linux Integration Service for Hyper-V R2 on a RedHat Enterprise Server 5. Something that turned out 
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Ok, so I got the task to install the Linux Integration Service for Hyper-V R2 on a RedHat Enterprise Server 5. Something that turned out to be a bit more to handle than I would have thought. So here’s a little How-To.</p><h1 id="Preparations"><a href="#Preparations" class="headerlink" title="Preparations"></a>Preparations</h1><p>Read the documentation provided in the Linux Integration Services download. Much of the information in this article is in there, but some parts are not. Otherwise I would not have bothered writing about it. ;)</p><p>I’m not going to go through the OS installation process here, but make sure to select the “Software Development” packages since you will be needing it. In case you missed it, you can install them later by running these commands.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yum groupinstall "Development Tools"</span></span><br><span class="line"><span class="comment"># yum install kernel-headers</span></span><br></pre></td></tr></table></figure><p>I’m not actually sure that you need to run the kernel-headers install manually or if it’s included in the “Development Tools” package.</p><p>The first gotcha i ran into was the fact that the link to the Linux Integration Services–previously known as Linux Integration Components or LinuxIC–on RedHat’s information pages gave me a 404 and a redirect to a bing-search that returned the exact same 404. The page have simply been removed by Microsoft without any form of redirection to the new page. Anyway, a search on <a href="http://download.microsoft.com" target="_blank" rel="noopener">http://download.microsoft.com</a> for “Linux Integration Components” do return the new page, and that’s where I learned about the new name.<br>Thank you for making it easy for us Microsoft!</p><ul><li>Here’s a <a href="http://www.microsoft.com/downloads/en/results.aspx?freetext=linux+integration+services&amp;displaylang=en&amp;stype=s_basic" target="_blank" rel="noopener">direct link to the search on the current name.</a></li><li>And here’s a <a href="http://www.microsoft.com/downloads/details.aspx?displaylang=en&amp;FamilyID=eee39325-898b-4522-9b4c-f4b5b9b64551" target="_blank" rel="noopener">direct link to the actual download page.</a></li></ul><p>This download contains an ISO file that you can mount using the Hyper-V- or VMM-console, or you can do as I did and download the ISO to the virtual machine, mount it locally, copy the files and unmount it. Like this.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mkdir /mnt/ISO</span></span><br><span class="line"><span class="comment"># mount -o loop /root/LinuxIC v21.iso /mnt/ISO</span></span><br><span class="line"><span class="comment"># mkdir /opt/linux_ic_v21_rtm</span></span><br><span class="line"><span class="comment"># cp /mnt/ISO/* -R /opt/linux_ic_v21_rtm/</span></span><br><span class="line"><span class="comment"># umount /mnt/ISO</span></span><br></pre></td></tr></table></figure><p>You probably have to be root to do this by the way.<br>With that done, let’s get to the installation.</p><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>As root, do the following:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># export PATH=$PATH:/sbin</span></span><br><span class="line"><span class="comment"># cd /opt/linux_ic_v21_rtm/</span></span><br><span class="line"><span class="comment"># make</span></span><br><span class="line"> make install</span><br><span class="line"><span class="comment"># reboot</span></span><br></pre></td></tr></table></figure><p>Why the export PATH command? Apparently, on RHES5, /sbin is not in the PATH by default and this is something that the make scripts are completely unaware of. The <code>make install</code> will try to run <code>depmod</code> which will fail since it’s not in the default path.<br>You could also add <code>PATH=$PATH/sbin</code> to the root users ~/.bashrc which will put it back in the PATH but only for the root user, but I don’t know if that’s recommended.<br>And, yes. You DO have to reboot after the install.</p><p>If you are running RHES5 64bit you also have to install the <code>adjtimex</code> package. It is in the RHN repository but also on the RHES5 Installation CD in case you have no internet connection. Install it with yum like this:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yum install adjtimex</span></span><br></pre></td></tr></table></figure><p>And from the CD (mount it first) like this:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rpm –ivh /mnt/cdrom/Server/adjtimex-1.20-2.1.x86_64.rpm</span></span><br></pre></td></tr></table></figure><p>And that’s basically it for the installation.</p><h1 id="Verification"><a href="#Verification" class="headerlink" title="Verification"></a>Verification</h1><p>How do you know that the driver are installed?</p><p>Aftr the reboot, try running <code>modinfo vmbus</code> which should return something like this:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># modinfo vmbus</span></span><br><span class="line">filename:       /lib/modules/2.6.18-194.11.1.el5/kernel/drivers/vmbus/vmbus.ko</span><br><span class="line">verion:        2.1.25</span><br><span class="line">licnse:        GPL</span><br><span class="line">srcversion:     3C1899C419665CB2514F2D0</span><br><span class="line">depends:</span><br><span class="line">vermagic:       2.6.18-194.11.1.el5 SMP mod_unload gcc-4.1</span><br><span class="line">parm:           vmbus_irq:int</span><br><span class="line">par:           vmbus_loglevel:int</span><br></pre></td></tr></table></figure><p>Try that with netvsc, storvsc and blkvsc too (replace the <em>vmbus</em> part) and you should get something similar. If you don’t, the installation did not succeed.<br>The documentation also tells us to check that the components are running with <code>/sbin/lsmod | grep vsc</code> which should return:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># /bin/lsmod | grep vsc</span></span><br><span class="line">blkvsc                 70184  3</span><br><span class="line">storvsc                64264  0</span><br><span class="line">netvsc                 73504  0</span><br><span class="line">vmbus                  88304  3 blkvsc,storvsc,netvsc</span><br><span class="line">scs_mod              196953  6 scsi_dh,sg,blkvsc,storvsc,libata,sd_mod</span><br></pre></td></tr></table></figure><p>The numbers will probably differ from installation to installation depending on blocksizes and allocation.</p><h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><p>Configuration is pretty straight-forward so I’ll keep this short.</p><p>When you install the drivers you will get a new network card called <code>seth0</code>, which I presume stands for <strong>S</strong>ynthetic <strong>ETH</strong>ernet. There’s nothing magic about it regarding configuration and <code>system-configuration-network</code> will work just fine.<br>The drivers will also give you a couple of SCSI-devices (if you have one attached) with the regular <code>/dev/sd*</code> naming. Simply configure these using fdisk or whatever GUI you might prefer.</p><p>There is also a note in the documentation about changing the grub configuration in the “Additional Information…” section. Do read that section.</p><h1 id="Additional-Comments"><a href="#Additional-Comments" class="headerlink" title="Additional Comments"></a>Additional Comments</h1><p>One thing I tend to do now that disk space is dirt cheap is to copy all ISO-files I use locally instead of mounting them when needed through Hyper-V. Simply because you can bet your insert-shorter-word-for-buttocks that the day you need it again, someone has been kind enough to have done som spring-cleaning or it’s locked by another machine in the cluster. If you have it locally and followed my instructions in the “Preparation” section, you will allready have a /mnt/ISO directory. Only thing you’ll have to do is</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># mount -o loop /path/to/your.iso /mnt/ISO</span></span><br></pre></td></tr></table></figure><p>And there you have it. Just remember to unmount it when you’re done.</p><p>I also almost never use the Hyper-V remote connection interface thingy since it will give you a GUI and the mouse just won’t work. If you haven’t configured a network card yet though, you could connect through Hyper-V and hit <em>Ctrl+Alt+F1</em> to get a command prompt. Unfortunatly cut/paste don’t work here, but you could run <code>system-configuration-network</code>, assign an IP-address and then connect with an SSH client. I prefer PuTTY to a degree that I usually install the ported version on my Linux desktops as well.</p><p>And I never logon using root. People should know this, but it should be stressed anyway. Always logon as regular user and <code>su</code> or <code>sudo</code> when needed. I can’t understand why RHES has root-login enabled by default in the SSH-server config.</p><p>Good luck!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Linux/rhes/install-linuxis21-rhes5/#disqus_thread</comments>
    </item>
    
    <item>
      <title>MSMQ 4 and MSMQ 5 MP for OpsMgr Released! (finally)</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/msmq-4-and-msmq-5-mp-for-opsmgr-released-finally/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/msmq-4-and-msmq-5-mp-for-opsmgr-released-finally/</guid>
      <pubDate>Tue, 06 Apr 2010 10:09:57 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;After a long wait (definitely more than 90 days) the management packs for MSMQ 4 (Windows 2008) and MSMQ 5 (Windows 2008 R2) are finally 
        
      
      </description>
      
      <content:encoded><![CDATA[<p>After a long wait (definitely more than 90 days) the management packs for MSMQ 4 (Windows 2008) and MSMQ 5 (Windows 2008 R2) are finally released.</p><p>Both seem to be fully Cluster aware and pretty much holds the same monitoring as the the latest MSMQ 3 MP.</p><h3 id="Message-Queuing-4-0-Management-Pack-for-Operations-Manager-2007"><a href="#Message-Queuing-4-0-Management-Pack-for-Operations-Manager-2007" class="headerlink" title="Message Queuing 4.0 Management Pack for Operations Manager 2007"></a>Message Queuing 4.0 Management Pack for Operations Manager 2007</h3><pre><code>&gt; **Quick Details**</code></pre><blockquote><p>Version: 6.0.6700.83</p><p>Date Published: 4/5/2010</p><p>Language: English  </p></blockquote><p>Download here: <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=cfc103b8-7185-4721-8098-110885fe9e9e&amp;displaylang=en" target="_blank" rel="noopener">http://www.microsoft.com/downloads/details.aspx?FamilyID=cfc103b8-7185-4721-8098-110885fe9e9e&amp;displaylang=en</a></p><h3 id="Message-Queuing-5-0-Management-Pack-for-Operations-Manager-2007"><a href="#Message-Queuing-5-0-Management-Pack-for-Operations-Manager-2007" class="headerlink" title="Message Queuing 5.0 Management Pack for Operations Manager 2007"></a>Message Queuing 5.0 Management Pack for Operations Manager 2007</h3><blockquote><p><strong>Quick Details</strong></p><p>Version: 6.0.6700.88</p><p>Date Published: 4/5/2010</p><p>Language: English  </p></blockquote><p>Download here: <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=28349b78-8329-44aa-8a1f-81f4e3f84d0c&amp;displaylang=en" target="_blank" rel="noopener">http://www.microsoft.com/downloads/details.aspx?FamilyID=28349b78-8329-44aa-8a1f-81f4e3f84d0c&amp;displaylang=en</a></p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/msmq-4-and-msmq-5-mp-for-opsmgr-released-finally/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Change Gateway Powershell Script</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/change-gateway-powershell-script/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/change-gateway-powershell-script/</guid>
      <pubDate>Wed, 31 Mar 2010 13:27:08 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;This script has pretty much already been covered in my previous post about &lt;a href=&quot;http://www.teknoglot.se/ms/opsmgr2007/replacechange-a
        
      
      </description>
      
      <content:encoded><![CDATA[<p>This script has pretty much already been covered in my previous post about <a href="http://www.teknoglot.se/ms/opsmgr2007/replacechange-a-gateway-server/">Changing or Replacing an Operations Manager Gateway Server</a>.</p><p>This time I’ve basically put parameter support in it to make it easier to use.</p><p>Here’s the script anyway.</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Param</span>(<span class="variable">$OldGW</span>,<span class="variable">$NewGW</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable">$OldMS</span>= Get-ManagementServer | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$OldGW</span>&#125;</span><br><span class="line"><span class="variable">$NewMS</span> = Get-ManagementServer | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="variable">$NewGW</span>&#125;</span><br><span class="line"><span class="variable">$agents</span> = Get-Agent | where &#123;<span class="variable">$_</span>.PrimaryManagementServerName <span class="nomarkup">-eq</span> <span class="variable">$OldGW</span>&#125;</span><br><span class="line"><span class="variable">$agents</span> = <span class="variable">$agents</span></span><br><span class="line"><span class="string">"Moving "</span> + <span class="variable">$agents</span>.count + <span class="string">" agents from "</span> + <span class="variable">$OldMS</span>.Name + <span class="string">" to "</span> + <span class="variable">$NewMS</span>.Name</span><br><span class="line"><span class="built_in">Start-Sleep</span> -m <span class="number">200</span></span><br><span class="line">Set-ManagementServer -AgentManagedComputer: <span class="variable">$agents</span> -PrimaryManagementServer: <span class="variable">$NewMS</span> -FailoverServer: <span class="variable">$OldMS</span></span><br></pre></td></tr></table></figure><p>To use it, create a textfile called ChangeGW.ps1 and paste the code into it. Save the file somewhere neat (maybe C:Scripts) for easy access. If you don’t feel like copy/pasting, you can <a href="http://www.teknoglot.se/ms/opsmgr2007/change-gateway-powershell-script/attachment/changegw/">download the script here</a>.</p><p>To use it, open the Operations Manager Command Shell and type:<br><code>C:\ScriptsChangeGW.ps1 &lt;old.gatewayserver.dns.name&gt; &lt;new.gatewayserver.dns.name&gt;</code></p><p>For example:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">C:\ScriptsChangeGW.ps1 gwserver01.domainname.local gwserver02.domainname.local</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/change-gateway-powershell-script/#disqus_thread</comments>
    </item>
    
    <item>
      <title>ESENT Error When Modifying OpsMgr Agent</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/esent-error-when-modifying-opsmgr-agent/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/esent-error-when-modifying-opsmgr-agent/</guid>
      <pubDate>Fri, 19 Mar 2010 09:34:17 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Getting &lt;code&gt;ESENT Kerys are required to install this application&lt;/code&gt; when you are trying to modify/change an agent installation?&lt;/p&gt;
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Getting <code>ESENT Kerys are required to install this application</code> when you are trying to modify/change an agent installation?</p><p><img src="/wp-content/uploads/2010/03/image_thumb.png" alt="ESENT Error Dialog" title="ESENT Error Dialog"></p><p>This seems to be  most common on Windows 2008 and i guess it’s because of the UAC and the fact that opening the Control Panel isn’t running in administrative mode.</p><p>To work around this you need to run the msiexec command on the correct installation GUID from an administrative command prompt.</p><p>Besides running through the registry to find the GUID, one of the easier ways is this:</p><ol><li>Open an administrative command prompt.</li><li>run <code>wmic product</code></li><li>Locate your product by its name, the GUID (looks a bit like this <code>{25097770-2B1F-49F6-AB9D-1C708B96262A}</code>) directly after that is the one you want. Copy it.</li><li>run <code>msiexec /i &lt;PASTEYOURGUIDHERE&gt;</code></li><li>Modify the agent as pleased</li></ol><p>That’s pretty much it. Good luck.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/esent-error-when-modifying-opsmgr-agent/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Updated MSMQ Management Pack v6.0.6615.0!</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/updated-msmq-management-pack/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/updated-msmq-management-pack/</guid>
      <pubDate>Wed, 23 Dec 2009 08:57:38 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Microsoft has released an update to the MSMQ (version 3) management pack.&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;code&quot;
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Microsoft has released an update to the MSMQ (version 3) management pack.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">System Center Pack for: Message Queuing 3.0</span><br><span class="line">Version:      6.0.6615.0</span><br><span class="line">Released on:  12/14/2009</span><br><span class="line"></span><br><span class="line">Message Queuing (also known as MSMQ) is a server application that enables applications to communicate across heterogeneous networks and systems that may be temporarily offline or otherwise inaccessible. Instead of an application communicating with a service on another computer, it sends its information to Message Queuing, which sends the information to a Message Queuing service on the target computer where it is made available to the other application. Message Queuing provides guaranteed delivery, efficient routing, security, and priority based messaging.</span><br></pre></td></tr></table></figure><p>Now, what’s really interesting is what you will find in the MP Guide under “Supported Configurations”.</p><blockquote><p>The Message Queuing Management Pack for Operations Manager 2007 is designed to monitor Message Queuing version 3 only.</p><p>The Message Queuing Management Pack supports the following platforms:</p><ul><li>Windows Server 2003</li><li>Windows XP</li></ul><p><strong><em>The Message Queuing Management Pack also supports monitoring clustered MSMQ components</em></strong></p></blockquote><p>Emphasis by me.</p><p>Finally, MSMQ monitoring seems to be cluster aware, which might mean that the home-made pack i did to have those (numerous) queues covered could be passed on to the scrap-heap. This is also confirmed under “Changes in This Update”.</p><blockquote><p>The December 2009 update to this management pack includes the following change:</p><ul><li>Fixed a problem when working with an instance of MSMQ in a Cluster. The MP is now able to discover and monitor public and private queues in a cluster.</li><li>Fixed a problem when discovering the local and cluster instance of MSMQ. The MP is now able to discover and monitor both instances.</li></ul></blockquote><p>The confusing double RunAs profiles seems to have been cleaned up too (you only have to worry about one now) as well as fixing some sloppy mistakes in the previous scripts (no Option Explicit? C’mon Microsoft! You <em>write</em> the best practices, try to stick to them.) and generally improving display and documentation.</p><p>Gonna import this to our staging environment today and let it roll during the holidays.</p><p>Download and documentation:<br><a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=1D2B4398-8BC2-4A43-850C-852EBB0D983B&amp;displaylang=en&amp;displaylang=en" title="http://www.microsoft.com/downloads/details.aspx?FamilyId=1D2B4398-8BC2-4A43-850C-852EBB0D983B&amp;displaylang=en&amp;displaylang=en" target="_blank" rel="noopener">http://www.microsoft.com/downloads/details.aspx?FamilyId=1D2B4398-8BC2-4A43-850C-852EBB0D983B&amp;displaylang=en&amp;displaylang=en</a></p><p>Cheers! Oh, and happy holidays!</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/updated-msmq-management-pack/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Linux Discovery – Not Enough Entropy</title>
      <link>https://www.teknoglot.se/Linux/sles/linux-discovery-not-enough-entropy/</link>
      <guid>https://www.teknoglot.se/Linux/sles/linux-discovery-not-enough-entropy/</guid>
      <pubDate>Wed, 02 Dec 2009 11:37:08 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;Error-Description&quot;&gt;&lt;a href=&quot;#Error-Description&quot; class=&quot;headerlink&quot; title=&quot;Error Description&quot;&gt;&lt;/a&gt;Error Description&lt;/h1&gt;&lt;p&gt;Here’s a l
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Error-Description"><a href="#Error-Description" class="headerlink" title="Error Description"></a>Error Description</h1><p>Here’s a little trouble-shooting guide for discovering Linux systems from OpsMgr R2 when getting the following error from the wizard:</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">stdout</span>&gt;</span>Generating certificate with hostname="COMPUTERNAME"</span><br><span class="line"></span><br><span class="line">[/home/serviceb/TfsCoreWrkSpcRedhat/source/code/tools/scx_ssl_config/scxsslcert.cpp:198]</span><br><span class="line"></span><br><span class="line">Failed to allocate resource of type random data: Failed to get random data - not enough entropy</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">stdout</span>&gt;</span><span class="tag">&lt;<span class="name">stderr</span>&gt;</span>error: %post(scx-1.0.4-248.i386) scriptlet failed, exit status 1</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">stderr</span>&gt;</span><span class="tag">&lt;<span class="name">returnCode</span>&gt;</span>1<span class="tag">&lt;/<span class="name">returnCode</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">DataItem</span> <span class="attr">type</span>=<span class="string">"Microsoft.SSH.SSHCommandData"</span> <span class="attr">time</span>=<span class="string">"2009-08-05T11:15:01.5800358-04:00"</span> <span class="attr">sourceHealthServiceId</span>=<span class="string">"0EB1D6DA-202C-7FC5-3D46-BDBB9208547D"</span>&gt;</span><span class="tag">&lt;<span class="name">SSHCommandData</span>&gt;</span><span class="tag">&lt;<span class="name">stdout</span>&gt;</span>Generating certificate with hostname="COMPUTERNAME"</span><br><span class="line"></span><br><span class="line">[/home/serviceb/TfsCoreWrkSpcRedhat/source/code/tools/scx_ssl_config/scxsslcert.cpp:198]</span><br><span class="line"></span><br><span class="line">Failed to allocate resource of type random data: Failed to get random data - not enough entropy</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">stdout</span>&gt;</span><span class="tag">&lt;<span class="name">stderr</span>&gt;</span>error: %post(scx-1.0.4-248.i386) scriptlet failed, exit status 1</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">stderr</span>&gt;</span><span class="tag">&lt;<span class="name">returnCode</span>&gt;</span>1<span class="tag">&lt;/<span class="name">returnCode</span>&gt;</span><span class="tag">&lt;/<span class="name">SSHCommandData</span>&gt;</span><span class="tag">&lt;/<span class="name">DataItem</span>&gt;</span></span><br></pre></td></tr></table></figure><p>But first, a little background on the actual “problem”. To generate the certificate, the <em>entropy</em> needs to be high enough to generate random data for the certificate creation. Without the certificate, the OpsMgr agent won’t be able to open up communications with the <acronym title="Management Server">MS</acronym>. So, what creates this entropy we need? Bluntly put, a selection of hardware components that are likely to produce non-predictable data. Like a keyboard, mouse and a monitor or videocard. Of course, there’s a lot more to it, but we really don’t need to know this. What <em>we</em> need to know is that there has to be a “bit bucket” of more than 256bytes of entropy for the certificate creation process to succeed. We also need to know that more enterprise-ish servers, like rack- or blade-servers tend to be void of things like directly attached keyboards, mouses and monitors that the linux kernel needs to be able to generate entropy. And herein lies the problem. If you have a new server that is not in full service (likely since we are trying to deploy the monitoring on it) which means that there’s not much random data flowing through the hardware and there’s no keyboard or mouse or monitor connected to it there is quite the risk that the system entropy is going to be very low. Of the linux systems that I have been deploying OpsMgr agents to, about half have failed because of “Not enough entropy”. So, here’s the steps I usually takes to ensure that discovery works. I use <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html" target="_blank" rel="noopener">PuTTY</a> to connect to the soon-to-be-monitored servers. This guide also assumes that you have SU rights on the system since all of these steps (except #1) needs it.</p><h1 id="Workaround"><a href="#Workaround" class="headerlink" title="Workaround"></a>Workaround</h1><h2 id="1-Check-you-current-entropy"><a href="#1-Check-you-current-entropy" class="headerlink" title="1. Check you current entropy"></a>1. Check you current entropy</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat /proc/sys/kernel/random/entropy_avail</span><br></pre></td></tr></table></figure><p>Is it less than, or close to, 256? It probably is. If you don’t feel like connecting a mouse and start wiggling it around—not really feasible in a data center—and see if the entropy increases, you can generate your own random data.</p><h2 id="2-Generate-you-own-random-data"><a href="#2-Generate-you-own-random-data" class="headerlink" title="2. Generate you own random data."></a>2. Generate you own random data.</h2><p>Be advised that this forced entropy will not be as random as the system-created on and thus not as secure. How much more insecure it is, I don’t know, and quite frankly I prefer to have my systems monitored yet slightly less secure than not monitored at all. Anyway, you can force your own random data by running:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dd if=/dev/urandom of=~/.rnd bs=1 count=1024</span><br></pre></td></tr></table></figure><p>This creates a .rnd file with 1024B of random data that the certificate creation process will use instead of the system entropy if the file exists.</p><h2 id="3-Uninstall-and-re-discover"><a href="#3-Uninstall-and-re-discover" class="headerlink" title="3. Uninstall and re-discover"></a>3. Uninstall and re-discover</h2><p>The first failed attempt of discovery will most likely leave a non-working agent installation that we have to remove. Otherwise we will just be stuck with an “Access Denied” error. Run:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rpm –e scx</span><br></pre></td></tr></table></figure><p>Now, try to discover the system again.</p><h2 id="4-Failed-again"><a href="#4-Failed-again" class="headerlink" title="4. Failed again?"></a>4. Failed again?</h2><p>Try generating the certificate manually by running:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/opt/microsoft/scx/bin/tools/scxsslconfig -f –v</span><br><span class="line">/opt/microsoft/scx/bin/tools/scxadmin –restart</span><br></pre></td></tr></table></figure><p>Retry discovery again.</p><h2 id="5-Still-fails"><a href="#5-Still-fails" class="headerlink" title="5. Still fails?"></a>5. Still fails?</h2><p>Uninstall the agent once more as instructed in step 3.<br>Stese steps have solved my problems 100% on both SUSE and RedHat and hopefully they will help you too.</p><p>Interestingely enough, these problems seems to be connected to some changes in the 2.6 kernel and basically everything that uses SSL-ish certificates will be affected. Even though the symptoms may be a bit more subtle, like time-outs and disconnects. For “headless” servers like those I usually to administer where the random data tend to be much lower, there’s even specialised hardware whose sole purpose is to generate random data, like the <a href="http://www.entropykey.co.uk/" target="_blank" rel="noopener">Entropy Key</a>. I have also been told that new servers is likely to be equipped with entropy chipsets to make sure that there’s chaos enough to avoid these new-found oddities.</p><blockquote><p>Sources:<br><a href="http://social.technet.microsoft.com/Forums/en-US/crossplatformsles/thread/f94ec905-23ac-4444-b9f8-644fec3ae357" title="http://social.technet.microsoft.com/Forums/en-US/crossplatformsles/thread/f94ec905-23ac-4444-b9f8-644fec3ae357" target="_blank" rel="noopener">http://social.technet.microsoft.com/Forums/en-US/crossplatformsles/thread/f94ec905-23ac-4444-b9f8-644fec3ae357</a></p><p><a href="http://www.askrenzo.com/oracle/SCOM/SCOM_discovering_nodes.html" title="http://www.askrenzo.com/oracle/SCOM/SCOM_discovering_nodes.html" target="_blank" rel="noopener">http://www.askrenzo.com/oracle/SCOM/SCOM_discovering_nodes.html</a></p></blockquote>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Linux/sles/linux-discovery-not-enough-entropy/#disqus_thread</comments>
    </item>
    
    <item>
      <title>(re)Gain sysadmin access to SQL2005 or SQL2008</title>
      <link>https://www.teknoglot.se/ms/sql/regain-sysadmin-access-to-sql2005-or-sql2008/</link>
      <guid>https://www.teknoglot.se/ms/sql/regain-sysadmin-access-to-sql2005-or-sql2008/</guid>
      <pubDate>Thu, 19 Nov 2009 13:08:10 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;In SQL Server 2005 and 2008 the local Administrators account is not sysadmin by default. This makes it even more important that the one s
        
      
      </description>
      
      <content:encoded><![CDATA[<p>In SQL Server 2005 and 2008 the local Administrators account is not sysadmin by default. This makes it even more important that the one setting up the Database also remembers to add a SQL Server admins group to the sysadmin role. If this step is forgotten, the user installing the database server is the only one that will ever be sysadmin.</p><p>In some extreme cases I’ve seen situations where no one except some dude on vacation is sysadmin and I need to install or upgrade a bunch of applications and services. In these cases I have also been assigned Local Administrator rights on the server, but since the local Administrators group isn’t sysadmin either I still cannot login to the SQL server.<br>What to do!?</p><p>Thanks to <a href="http://blogs.msdn.com/raulga/archive/2007/07/12/disaster-recovery-what-to-do-when-the-sa-account-password-is-lost-in-sql-server-2005.aspx" target="_blank" rel="noopener">Raul Carcia’s blog post</a> it’s not that a big deal. The instructions are written for SQL Server 2005 but works equally fine on SQL Server 2008 and the only pre-requirement is that you are a local server administrator.<br>Here’s what to do:</p><ol><li>Open the <em>SQL Server Configuration Manager.</em></li><li>In <em>SQL Server Services</em>, open the properties for the SQL Server instance you need access to.</li><li>In the <em>Advanced</em> tab, find <em>Startup Parameters</em>.</li><li>Add “;-m” to the end of that line.</li><li>Press OK and restart the SQL Server into “Maintenance Mode” or “Single User Mode” if you like. (check that a restart is OK first ;))</li><li>Open a command prompt (right-click, “Run as Administrator” in Windows 2008) and go to C:\Program Files\Microsoft SQL Server\100\Tools\Binn<br>(C:\Program Files\Microsoft SQL Server_90_\Tools\Binn for SQL2005)</li><li>Execute <code>sqlcmd /A /E /S &lt;INSTANCE&gt;</code><br>(use . for local default instance and .INSTANCE for local named instance)</li><li><p>In the CLI, execute:</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">EXEC sp_addsrvrolemember 'DOMAIN\yourusername', 'sysadmin';</span><br><span class="line">GO</span><br></pre></td></tr></table></figure></li><li><p>Return to the <em>SQL Server Configuration Manager</em> and restore the <em>Startup Parameters</em> to it’s previous settings.</p></li><li>Restart the SQL Server instance to allow users to get access to it again.</li></ol><p>Now, you should be able to login to the SQL server with sysadmin rights using your current user. This would also be a good time to actually set up a SQL Server Admins group (local or domain) to add to the sysadmin role to avoid having others to the above steps when you, yourself, are on vacation. ;)</p><p>As Raul Carcia point out in his original post, this is really a disaster recovery procedure and there’s definitely nothing sneaky about it since it leaves a lot of trails in the event logs.</p><p>All in all, a Great article by <a href="http://blogs.msdn.com/raulga/" target="_blank" rel="noopener">Raul</a> and all credit should go his way.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/sql/regain-sysadmin-access-to-sql2005-or-sql2008/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Updated: MP for System Center Configurations Manager 2007 SP2 on x64</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/updated-mp-for-system-center-configurations-manager-2007-sp2-on-x64/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/updated-mp-for-system-center-configurations-manager-2007-sp2-on-x64/</guid>
      <pubDate>Tue, 03 Nov 2009 11:13:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Microsoft has released an updated &lt;acronym title=&quot;Management Pack&quot;&gt;MP&lt;/acronym&gt; for &lt;acronym title=&quot;System Center Configurations Manager&quot;
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Microsoft has released an updated <acronym title="Management Pack">MP</acronym> for <acronym title="System Center Configurations Manager">SCCM </acronym>SP2 (v6.0.6000.2, released on 10/28/2009) for OpsMgr R2.</p><p>The update basically contains support for x64 that was missing in the previous release.</p><blockquote><p>The Configuration Manager 2007 SP2 Management Pack adds support for monitoring Configuration Manager 2007 SP2 in a 64-bit environment with Operations Manager 2007 R2 or Operations Manager 2007 SP1 with hotfix (KB971541) installed. This enables the Configuration Manager 2007 SP2 Management Pack to work with either the 32-bit or the 64-bit Operations Manager 2007 agent. <strong>Except for the 64-bit support, the other features and guidance for Configuration Manager 2007 Management Packs remain intact</strong>.</p></blockquote><p>Emphasis is mine.</p><p>Read more and download here:<br><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=a8443173-46c2-4581-b3b8-ce67160f627b" title="http://www.microsoft.com/downloads/details.aspx?FamilyID=a8443173-46c2-4581-b3b8-ce67160f627b" target="_blank" rel="noopener">http://www.microsoft.com/downloads/details.aspx?FamilyID=a8443173-46c2-4581-b3b8-ce67160f627b</a></p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/updated-mp-for-system-center-configurations-manager-2007-sp2-on-x64/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Installing SQL Reporting Services 2005 on Windows 2008 x64</title>
      <link>https://www.teknoglot.se/ms/sql/installing-sql-reporting-services-2005-on-windows-2008-x64/</link>
      <guid>https://www.teknoglot.se/ms/sql/installing-sql-reporting-services-2005-on-windows-2008-x64/</guid>
      <pubDate>Mon, 02 Nov 2009 13:33:27 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Let’s say you have followed this guide: &lt;a href=&quot;http://support.microsoft.com/kb/938245/&quot; title=&quot;http://support.microsoft.com/kb/938245/&quot;
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Let’s say you have followed this guide: <a href="http://support.microsoft.com/kb/938245/" title="http://support.microsoft.com/kb/938245/" target="_blank" rel="noopener">http://support.microsoft.com/kb/938245/</a></p><p>Still not working? The one thing I forgot, or rather did not find in any of the guides, was to change the website application pool to “Classic .NET AppPool”. It is actually noted in <a href="http://support.microsoft.com/kb/938245/" target="_blank" rel="noopener">KB938245</a> but only after the installation, during the configuration. For some reason I have not been able to install Reporting Services 2005 on Windows 2008 without changing this prior to the installation.</p><p>Maybe I am doing it wrong but this seems to be working all right for me.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/sql/installing-sql-reporting-services-2005-on-windows-2008-x64/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Cannot Delete Files with Long Paths?</title>
      <link>https://www.teknoglot.se/ms/windows/cannot-delete-files-with-long-paths/</link>
      <guid>https://www.teknoglot.se/ms/windows/cannot-delete-files-with-long-paths/</guid>
      <pubDate>Wed, 21 Oct 2009 07:39:17 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;What do you do when you cannot delete a file or folder on a windows server?&lt;/p&gt;
&lt;p&gt;Check the file permissions! And if that doesn’t help?&lt;
        
      
      </description>
      
      <content:encoded><![CDATA[<p>What do you do when you cannot delete a file or folder on a windows server?</p><p>Check the file permissions! And if that doesn’t help?</p><p>Check the share permissions! Yes, if it is a shared folder. And if that doesn’t help?</p><p>Check the file ownership! Great! But then what?</p><p>Well, the file could be in use, and then you would have to shut the locking process down and perhaps kick a user out. In a really bad scenario it could also be a symptom of a broken filesystem, a reserved filename (like “lpt1” or “PRN”) or even an invalid name (silly things like a space in the beginning or the end of a filename).<br>Another possible reason could actually be that the path to the file or folder is too long. You won’t actually get an error telling you that the filepath exceeds the 255 characters Windows can handle but a simple “Acces Denied”.</p><p>There are some, more or less tedious, work-arounds for the problem. Like renaming, starting from the root, all the directories to shorter ones or using the old DOS (8.3, like “dokume~1.doc”) names that windows can auto-generate for you. Personally, I have two favourite ways of handling this.</p><ol><li>Map the parent-directory of the file/folder you are trying to access/delete as a network drive and access your files that way.<br>This is particularly useful if the folder you are trying to access a <abbr title="Distributed File System">DFS</abbr>-share or perhaps a share on the central fileserver filepaths like <code>\\servername01\Central Projects\Central Services\IT Department\Develop Methods for Automatically Deploying New Central Servers\2.2.1 Auto-Deploying SQL-Server 2005 Cluster\Documents\Preparations\Whitepapers\SQL Server 2005 Failover Clustering White Paper.doc</code></li><li>Create a new share to a folder further down the hierarchy.<br>This works locally too if you are logged on to, say, SRV01, you create a new share on <code>D:\\Central Projects\Central Services\IT Department\Develop Methods for Automatically Deploying New Central Servers\</code> called <code>Autodeploymethods</code> and access it from <code>\\SRV01\Autodeploymethods</code>. That way the filepath doesn’t exceed 255 characters.</li></ol><p>Now. When designing fileservers, you really should think about how deep the filepaths may get. This is especially true on <abbr title="Distributed File System">DFS</abbr>-shares since you might have to deal with the full <abbr title="Fully Qualified Domain Name">FQDN</abbr> too, and not only the actual folder structure. Many big corporations I know uses “codes” for departments and assign a project ID (quite simply a number or maybe an abbreviation) to each project and uses theese for the fileshares too. Another scenario that could lead to similar problems are intranet sites where users can create and manage their own subsites and where filenames and folders are not stored in a database.</p><p>I have only seen this phenomena on Windows systems so far, and I’ve actually used a linux Live-CD on occasion when admin access is denied.</p><blockquote><p>Read More:<br><a href="http://support.microsoft.com/kb/320081" target="_blank" rel="noopener">http://support.microsoft.com/kb/320081</a></p></blockquote>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/windows/cannot-delete-files-with-long-paths/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Microsoft Adds support for SUSE 11 in OpsMgr R2</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/microsoft-adds-support-for-suse-11-in-opsmgr-r2/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/microsoft-adds-support-for-suse-11-in-opsmgr-r2/</guid>
      <pubDate>Fri, 16 Oct 2009 05:59:10 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;This update hasn’t showed up in the &lt;acronym title=&quot;Management Pack&quot;&gt;MP&lt;/acronym&gt; Catalog yet, but the &lt;a href=&quot;http://www.microsoft.com/
        
      
      </description>
      
      <content:encoded><![CDATA[<p>This update hasn’t showed up in the <acronym title="Management Pack">MP</acronym> Catalog yet, but the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=4a41a8be-0a37-4bd2-b5b1-026468b317fb" target="_blank" rel="noopener">System Center Operations Manager 2007 R2 Cross Platform Update can be downloaded here</a>.</p><p>Besides SUSE 11 support, here’s the short overview.</p><blockquote><p>The System Center Operations Manager 2007 R2 Cross Platform Update adds fixes for a defunct process issue on Unix/Linux Servers, as well as, adds support for SUSE Linux Enterprise Server 11 (both 32-bit and 64-bit versions) and Solaris Zone support.<br><strong>Feature Summary:</strong><br>The System Center Operations Manager 2007 R2 Cross Platform Update supports the monitoring of Unix/Linux Servers including:</p><ul><li>Monitoring of SUSE Linux Enterprise Server 11 servers (both 32-bit and 64-bit versions)<em> Support of Solaris Zones</em> Fix for defunct Process issue<em> The Cross Platform Agent may not discover soft partitions on Solaris systems. Therefore, the disk provider may be unloaded, and the Cross Platform Agent may stop collecting information from the system disks.</em> The Cross Platform Agent may not restart after the AIX server reboots.</li></ul><p>The latest versions of all the Operations Manager 2007 R2 Unix/Linux agents are included in this update.</p></blockquote><p>Perfect timing, I must say, since I really need this today. :D</p><p><strong><em>Update:</em></strong><br>This is no small MP-update, which probably is the reason that we do not find it in the MP Catalog, but a ~250MB OpsMgr R2 Software Update. You need to run this on all Operations Manager Servers (RMS/MS, GW?) since it actually updates many of the agent Cross Platform binaries. It does add a new MP för SUSE 11 that you have to import from disk if you need it.</p><p>So, the installation goes somewhat like this:</p><ol><li>Install the Software Update (pick the right Architecture) on all OpsMgr R2 Servers</li><li>Import the SUSE 11 MP if necessary</li><li>Re-discover your Unix/Linux machines.</li></ol><p>Files updated in this update for R2:</p><ul><li>.Microsoft.Enterprisemanagement.UI.Administration.dll (Version 6.1.7043.1)</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.aix.5.ppc.lpp.gz</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.aix.6.ppc.lpp.gz</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.hpux.11iv2.ia64.depot.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.hpux.11iv2.parisc.depot.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.hpux.11iv3.ia64.depot.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.hpux.11iv3.parisc.depot.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.rhel.4.x64.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.rhel.4.x86.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.rhel.5.x64.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.rhel.5.x86.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.sles.10.x64.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.sles.10.x86.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.sles.9.x86.rpm</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.solaris.10.sparc.pkg.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.solaris.10.x86.pkg.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.solaris.8.sparc.pkg.Z</li><li>.AgentManagementUnixAgentsscx-1.0.4-248.solaris.9.sparc.pkg.Z</li></ul><p>Files added:</p><ul><li>Microsoft.Linux.SLES.11.MP</li></ul><p>All in all, the update contains the following fixes:</p><ul><li>KB969342</li><li>KB973583</li><li>Q954049</li><li>Q956240</li></ul>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/microsoft-adds-support-for-suse-11-in-opsmgr-r2/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Health Rollup not working in Exchange Management Pack</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/health-rollup-not-working-in-exchange-management-pack/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/health-rollup-not-working-in-exchange-management-pack/</guid>
      <pubDate>Wed, 14 Oct 2009 10:17:08 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;I’ve wrestled a bit with a critical status on one of the Organization States at a clients site that wont go back to green despite all the
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I’ve wrestled a bit with a critical status on one of the Organization States at a clients site that wont go back to green despite all the underlying monitors have gone back to green. And apparently I am not alone on this one. Others, like me, has read and re-read the MP-guide i search for a monitor/rule/discovery for overrides forgotten, and I don’t know how many times I’ve made a small change and tried resetting the health once again. Anyhow.<br><a href="http://social.technet.microsoft.com/Profile/en-US/?user=Marius%20Sutara&amp;referrer=http%3a%2f%2fsocial.technet.microsoft.com%2fForums%2fen-US%2foperationsmanagergeneral%2fthread%2f6ad11b81-3304-40db-ae47-0f36add6e1e1&amp;rh=EQRzBI2S0js0uB72HghHQFW%2bBWkNhiVEQ9pGFs3h9c0%3d&amp;sp=forums" target="_blank" rel="noopener">Marius Sutara</a> posted an <a href="http://social.technet.microsoft.com/Forums/en-US/operationsmanagergeneral/thread/6ad11b81-3304-40db-ae47-0f36add6e1e1" target="_blank" rel="noopener">answer on TechNet forums</a> last week with a “fix” (-ish), or rather the acknowledgement that the problem is not a <acronym title="AKA. Human Error, 40cm from the screen">40c</acronym>. The problem might be related to other MP as well, but I’ve only seen it on the new Exchange MP so far. In that same post, Pete Zerger provided some links to two nifty little tools that will help you reset the health of the monitor.</p><p>In case you wonder why on earth I post when there’s allready a “solution” out there; Pagerank, baby!<br>Not for me, but for the forum post making it show up earlier on google.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/health-rollup-not-working-in-exchange-management-pack/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Updated: Operations Manager 2007 R2 Management Pack</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/updated-operations-manager-2007-r2-management-pack/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/updated-operations-manager-2007-r2-management-pack/</guid>
      <pubDate>Wed, 14 Oct 2009 09:29:00 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Microsoft released an updated &lt;acronym title=&quot;Management Pack&quot;&gt;MP&lt;/acronym&gt; (v6.1.7533.0, released on 10/8/2009) for monitoring the healt
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Microsoft released an updated <acronym title="Management Pack">MP</acronym> (v6.1.7533.0, released on 10/8/2009) for monitoring the health the Operations Manager components.</p><p>Most significant updates, according to me, would seem to be:</p><blockquote><p>Fixed an issue that was previously preventing all rules related to agentless exception monitoring from generating alerts.<br>Added the rule “Collects Opsmgr <acronym title="Software Development Kit">SDK</acronym> ServiceClient Connections” to collect the number of connected clients for a given management group. This data is shown in the view “Console and SDK Connection Count” under the folder “Operations ManagerManagement Server Performance”.<br>Updated a number of monitors and rules to ensure that data is reported to the correct management group for multihomed agents.<br>Fixed the configuration of the rule “IIS Discovery Probe Module Execution Failure” to so that the parameter replacement will now work correctly for alert suppression and generating the details of the alert’s description.</p></blockquote><p>The rest is mostly polishing, fine-tuning and complementary updates. Nothing really ground-breaking here, but still a welcome update.</p><p>Download at: <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=61365290-3c38-4004-b717-e90bb0f6c148" title="http://www.microsoft.com/downloads/details.aspx?FamilyID=61365290-3c38-4004-b717-e90bb0f6c148" target="_blank" rel="noopener">http://www.microsoft.com/downloads/details.aspx?FamilyID=61365290-3c38-4004-b717-e90bb0f6c148</a></p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/updated-operations-manager-2007-r2-management-pack/#disqus_thread</comments>
    </item>
    
    <item>
      <title>SQL ManagementPack Survey – Make your voice heard</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/sql-managementpack-survey-make-your-voice-heard/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/sql-managementpack-survey-make-your-voice-heard/</guid>
      <pubDate>Wed, 07 Oct 2009 12:24:37 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;According to the &lt;a href=&quot;http://blogs.technet.com/momteam/archive/2009/09/25/sql-management-pack-survey-live-on-connect.aspx&quot; target=&quot;_b
        
      
      </description>
      
      <content:encoded><![CDATA[<p>According to the <a href="http://blogs.technet.com/momteam/archive/2009/09/25/sql-management-pack-survey-live-on-connect.aspx" target="_blank" rel="noopener">OpsMgr Team blog</a>, Microsoft wants to know what you think about their SQL Server MP. It’s really hard to come by a better opportunity to express your feelings and desires about monitoring SQL Server, so don’t miss this one out.</p><p><a href="http://blogs.technet.com/momteam/archive/2009/09/25/sql-management-pack-survey-live-on-connect.aspx" title="http://blogs.technet.com/momteam/archive/2009/09/25/sql-management-pack-survey-live-on-connect.aspx" target="_blank" rel="noopener">http://blogs.technet.com/momteam/archive/2009/09/25/sql-management-pack-survey-live-on-connect.aspx</a></p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/sql-managementpack-survey-make-your-voice-heard/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Replace/Change a Gateway Server</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/replacechange-a-gateway-server/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/replacechange-a-gateway-server/</guid>
      <pubDate>Thu, 24 Sep 2009 10:32:35 GMT</pubDate>
      <description>
      
        
        
          &lt;h1 id=&quot;Description-of-problem&quot;&gt;&lt;a href=&quot;#Description-of-problem&quot; class=&quot;headerlink&quot; title=&quot;Description of problem&quot;&gt;&lt;/a&gt;Description of probl
        
      
      </description>
      
      <content:encoded><![CDATA[<h1 id="Description-of-problem"><a href="#Description-of-problem" class="headerlink" title="Description of problem"></a>Description of problem</h1><p>If you are looking into replacing an (or just switching to another primary) Operations Manager 2007 Gateway Server for any reason, there’s a little more to consider than just right-clicking the clients and selecting “Change Primary Management Server” in the Operations Console.<br>You could end up with agents not being able to connect to the Management Group at all due to a small problem with the order in which Operations Manager do things.</p><p>Here’s basically what happens:</p><ol><li>You tell Operations Manager to change Primary Management Server for AGENTX from GW1 to GW2.</li><li>The SDK Service (i guess) tells GW1 that “You’re no longer the Primary Management Server for AGENTX”</li><li>GW1 acknowledges this and stops talking to AGENTX.  And I mean <em>Completely</em> stops talking to AGENTX.</li><li>OpsMgr then tells GW2 to start accepting communication from AGENTX.</li><li>OpsMgr tries to tell AGENTX that it should talk to GW2 since GW1 won’t listen.</li></ol><p>Spotted the problem?<br>This modus operandi probably works when agents are on the same network and in the same domain where fail-over is sort of automatic.  The problem we are facing now is that the server are telling the Gateway to stop accepting communications to and from the agent <em>before</em> the agent is notified that there is a new Gateway server to talk to. The agent will continue to talk to GW1 but will be completely ignored and you will probably start seeing events in the Operations Manager eventlog on GW1 with EventID 20000.</p><p>How do I get around this little <em>feature</em> then?</p><p>No matter if you found this article after running into the mentioned troubles or if you are googling ahead of time to be prepared, the fix is the same and consists of a few powershell scripts. These scripts are <a href="http://www.systemcentercentral.com/Forums/tabid/60/IndexID/19305/Default.aspx#vwcComments19305" title="System Center Central" target="_blank" rel="noopener">out there</a> allready, but in different contexts, hence this post.</p><h2 id="First-step-Install-the-new-Gateway"><a href="#First-step-Install-the-new-Gateway" class="headerlink" title="First step:  Install the new Gateway"></a>First step:  Install the new Gateway</h2><p><a href="http://technet.microsoft.com/en-us/library/bb432149.aspx" title="Deploying Gateway Server in the Multiple Server, Single Management Group Scenario" target="_blank" rel="noopener">Documentation on this</a> from Microsoft is good enough, but here’s the short version.</p><ol><li>Verify name resolution to and from Gateway server and Management Server</li><li><a href="http://technet.microsoft.com/en-us/library/bb735408.aspx" title="Authentication and Data Encryption for Windows Computers in Operations Manager 2007" target="_blank" rel="noopener">Create certificate</a> for the Gateway server</li><li>Approve the Gateway server</li><li>Install Gateway server</li><li>Import certificates on Windows system</li><li>Run MOMCertImport.exe on Gateway server to add the certificate into Gateway server configuration</li><li>Wait</li></ol><p>The wait is for the gateway server to get all needed configuration from RMS and to download all neccesary management packs, run all the discovery scripts and so on. When the Operations Manager event log has calmed down a bit, move to step two.</p><h2 id="Second-step-Configure-Agent-Failover"><a href="#Second-step-Configure-Agent-Failover" class="headerlink" title="Second step: Configure Agent Failover"></a>Second step: Configure Agent Failover</h2><p>Connect to an Operations Manager Command Shell. Any will do, as long as it’s connected to the correct Management Group.<br>Then run the following script:</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$primaryGW</span>= Get-ManagementServer | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="string">'GW2.domain.local'</span>&#125;</span><br><span class="line"><span class="variable">$failoverGw</span> = Get-ManagementServer | where &#123;<span class="variable">$_</span>.Name <span class="nomarkup">-eq</span> <span class="string">'GW1.domain.local'</span>&#125;</span><br><span class="line"><span class="variable">$agents</span> = Get-Agent | where &#123;<span class="variable">$_</span>.primarymanagementservername <span class="nomarkup">-eq</span> <span class="string">'GW1.domain.local'</span>&#125;</span><br><span class="line">Set-ManagementServer -AgentManagedComputer: <span class="variable">$agents</span> -PrimaryManagementServer: <span class="variable">$primaryGW</span> -FailoverServer: <span class="variable">$failoverGw</span></span><br></pre></td></tr></table></figure><p>Remember to change “GW1.domain.local” to you OLD Gateway servername and “GW2.domain.local” to your NEW Gateway servername.</p><p>If you don’t know powershell, this script basically configures all agents using the old Gateway to use the new one as primare, but keep the old one as a fail-over server. The Gateways will still get to know the changes before the agents, but since the old on is still listening to the agents (though, as the fail-over host) it will be able to tell them to go to the new one, GW2.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/replacechange-a-gateway-server/#disqus_thread</comments>
    </item>
    
    <item>
      <title>My impression of EXT4 -- WTH!?</title>
      <link>https://www.teknoglot.se/Linux/my-impression-of-ext4-wth/</link>
      <guid>https://www.teknoglot.se/Linux/my-impression-of-ext4-wth/</guid>
      <pubDate>Thu, 17 Sep 2009 17:43:47 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Ok, so I reinstalled my linux partition with Ubuntu 9.04 x64 and decided to try EXT4 on the root partition. Like, yesterday.&lt;br&gt;Managed t
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Ok, so I reinstalled my linux partition with Ubuntu 9.04 x64 and decided to try EXT4 on the root partition. Like, yesterday.<br>Managed to get the Citrix client running (way more easy on Ubuntu than Fedora, I’ll be back on that) and all without too much fuzz.</p><p>First reboot gave me a “let’s FSCK!”. So I FSCK-ed and booted up to the desktop.</p><p>Second reboot gave me a “let’s FSCK!”. And I did. Booted to the desktop.</p><p>Third boot went smoothly, but all of a sudden all the icons decided to go AWOL. Rebooted again.</p><p>Fourth boot gave me a “let’s FSCK!”. I replied with “Well FSCK You!”</p><p>Fifth boot gave me a “let’s FSCK!”. I rebooted back to Windows 7.</p><p>Tonight I am reinstalling Ubuntu 9.04 x64 with EXT3.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/Linux/my-impression-of-ext4-wth/#disqus_thread</comments>
    </item>
    
    <item>
      <title>The TCP Port Check: Use with caution!</title>
      <link>https://www.teknoglot.se/ms/opsmgr2007/tcp-port-check-use-with-caution/</link>
      <guid>https://www.teknoglot.se/ms/opsmgr2007/tcp-port-check-use-with-caution/</guid>
      <pubDate>Thu, 27 Aug 2009 12:39:43 GMT</pubDate>
      <description>
      
        
        
          &lt;p&gt;Just wanted to raise a word of caution about the TCP Port Check in Operations Manager 2007.&lt;/p&gt;
&lt;p&gt;Some customers have notices the the sy
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Just wanted to raise a word of caution about the TCP Port Check in Operations Manager 2007.</p><p>Some customers have notices the the system-logs on some Unix machines are completely swamped with “connection error”, “TCP Connect failed”, “TCP Session Lost” and similar and after a bit och research the problematic servers were narrowed down to those monitored by Operations Manager. Specifically, those who are targeted by a TCP Port Check.</p><p>It would seem like the TCP-connection never fully initializes on the target server. Kind of like knocking on your neighbours door and then hiding. Then when the door opens, no one is there causing your friendly neighbour to hang around waiting for something to happen.</p><p>Maybe there’s a setting somewhere to modify how “deep” a Port Check should go before closing. Perhaps fully initializing and then sending a proper “Close” instead of just cutting the connection. In a few extreme cases we have noticed that the target server even goes so far as to start a session, but never ending it since there’s no closure and finally having no sessions to spare for the real users. But on most servers it’s just an annoyance since the “real” errors is very hard to be found in all the connection related logs.</p><p>Anyway. Just a good thing to keep in mind when running TCP Port Checks from Operations Manager 2007. Keep an eye on the logs when implementing the port checks.</p>]]></content:encoded>
      
      <comments>https://www.teknoglot.se/ms/opsmgr2007/tcp-port-check-use-with-caution/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
